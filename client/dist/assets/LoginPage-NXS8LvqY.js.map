{"version":3,"file":"LoginPage-NXS8LvqY.js","sources":["../../src/pages/LoginPage.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { useNavigate, useSearchParams } from 'react-router-dom';\r\nimport { useAppDispatch } from '../hooks/useAppDispatch';\r\nimport { useAppSelector } from '../hooks/useAppSelector';\r\nimport { checkSession } from '../store/slices/authSlice';\r\nimport api from '../services/api';\r\nimport './LoginPage.css';\r\n\r\n/**\r\n * –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Telegram Login Widget\r\n * –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Ö–æ–¥–∏—Ç –æ–¥–Ω–∏–º –∫–ª–∏–∫–æ–º —á–µ—Ä–µ–∑ –≤–∏–¥–∂–µ—Ç Telegram\r\n */\r\nfunction LoginPage() {\r\n  const [searchParams] = useSearchParams();\r\n  const navigate = useNavigate();\r\n  const dispatch = useAppDispatch();\r\n  \r\n  const { isAuthenticated, loading } = useAppSelector((state) => state.auth);\r\n  const [authError, setAuthError] = useState(null);\r\n  const [isAuthenticating, setIsAuthenticating] = useState(false);\r\n\r\n  useEffect(() => {\r\n    // –ï—Å–ª–∏ —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é\r\n    if (isAuthenticated) {\r\n      navigate('/', { replace: true });\r\n      return;\r\n    }\r\n\r\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–± –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤ –±–æ—Ç–µ)\r\n    const token = searchParams.get('token') || searchParams.get('session');\r\n    const userId = searchParams.get('userId');\r\n\r\n    if (token) {\r\n      console.log('üì• –û–±–Ω–∞—Ä—É–∂–µ–Ω —Ç–æ–∫–µ–Ω –≤ URL, –∞–≤—Ç–æ—Ä–∏–∑—É–µ–º—Å—è...');\r\n      \r\n      // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω –≤ localStorage\r\n      localStorage.setItem('authToken', token);\r\n      \r\n      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ—Å—Å–∏—é (–æ–±–Ω–æ–≤–ª—è–µ—Ç Redux store)\r\n      dispatch(checkSession())\r\n        .unwrap()\r\n        .then(() => {\r\n          console.log('‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ URL —É—Å–ø–µ—à–Ω–∞');\r\n          navigate('/', { replace: true });\r\n        })\r\n        .catch((error) => {\r\n          console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ URL:', error);\r\n          setAuthError('–ù–µ —É–¥–∞–ª–æ—Å—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram.');\r\n          localStorage.removeItem('authToken');\r\n        });\r\n      \r\n      return;\r\n    }\r\n\r\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ—Å—Å–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–µ—Å–ª–∏ —Ç–æ–∫–µ–Ω —É–∂–µ –µ—Å—Ç—å –≤ localStorage)\r\n    const existingToken = localStorage.getItem('authToken');\r\n    if (existingToken) {\r\n      dispatch(checkSession());\r\n    }\r\n  }, [isAuthenticated, navigate, dispatch, searchParams]);\r\n\r\n  // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–≤–µ—Ç–∞ –æ—Ç Telegram Widget\r\n  useEffect(() => {\r\n    window.onTelegramAuth = async (user) => {\r\n      console.log('üì• –ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –æ—Ç Telegram:', user);\r\n      setIsAuthenticating(true);\r\n      setAuthError(null);\r\n\r\n      try {\r\n        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ backend\r\n        const response = await api.post('/auth/telegram-widget', user);\r\n        \r\n        const { token, user: userData } = response.data;\r\n\r\n        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω\r\n        localStorage.setItem('authToken', token);\r\n\r\n        console.log('‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞:', userData.displayName);\r\n\r\n        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ—Å—Å–∏—é (–æ–±–Ω–æ–≤–ª—è–µ—Ç Redux store)\r\n        await dispatch(checkSession()).unwrap();\r\n\r\n        // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é\r\n        navigate('/', { replace: true });\r\n      } catch (error) {\r\n        console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);\r\n        setAuthError(error.response?.data?.error || '–ù–µ —É–¥–∞–ª–æ—Å—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è');\r\n        setIsAuthenticating(false);\r\n      }\r\n    };\r\n\r\n    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–∫—Ä–∏–ø—Ç Telegram Widget\r\n    const script = document.createElement('script');\r\n    script.src = 'https://telegram.org/js/telegram-widget.js?22';\r\n    script.setAttribute('data-telegram-login', import.meta.env.VITE_TELEGRAM_BOT_USERNAME || 'watchRebel_bot');\r\n    script.setAttribute('data-size', 'large');\r\n    script.setAttribute('data-radius', '8');\r\n    script.setAttribute('data-onauth', 'onTelegramAuth(user)');\r\n    script.setAttribute('data-request-access', 'write');\r\n    script.async = true;\r\n\r\n    const container = document.getElementById('telegram-login-container');\r\n    if (container) {\r\n      container.appendChild(script);\r\n    }\r\n\r\n    return () => {\r\n      // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏\r\n      if (container && script.parentNode === container) {\r\n        container.removeChild(script);\r\n      }\r\n      delete window.onTelegramAuth;\r\n    };\r\n  }, [dispatch, navigate]);\r\n\r\n  // –ï—Å–ª–∏ –∏–¥–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞ –∏–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è\r\n  if (loading || isAuthenticating) {\r\n    return (\r\n      <div className=\"login-page\">\r\n        <div className=\"login-container\">\r\n          <div className=\"login-card\">\r\n            <div className=\"login-logo\">\r\n              <h1>watchRebel</h1>\r\n              <p className=\"login-subtitle\">–°–æ—Ü–∏–∞–ª—å–Ω–∞—è —Å–µ—Ç—å –¥–ª—è –ª—é–±–∏—Ç–µ–ª–µ–π –∫–∏–Ω–æ –∏ —Å–µ—Ä–∏–∞–ª–æ–≤</p>\r\n            </div>\r\n            <div className=\"login-loading\">\r\n              <div className=\"spinner\"></div>\r\n              <p>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è...</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ Telegram\r\n  return (\r\n    <div className=\"login-page\">\r\n      <div className=\"login-container\">\r\n        <div className=\"login-card\">\r\n          <div className=\"login-logo\">\r\n            <h1>watchRebel</h1>\r\n            <p className=\"login-subtitle\">–°–æ—Ü–∏–∞–ª—å–Ω–∞—è —Å–µ—Ç—å –¥–ª—è –ª—é–±–∏—Ç–µ–ª–µ–π –∫–∏–Ω–æ –∏ —Å–µ—Ä–∏–∞–ª–æ–≤</p>\r\n          </div>\r\n          \r\n          <div className=\"login-content\">\r\n            <div className=\"login-icon\">\r\n              <img src=\"/images/logo-animation.png\" alt=\"watchRebel\" />\r\n            </div>\r\n            <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>\r\n            <p className=\"login-description\">\r\n              –í–µ–¥–∏—Ç–µ —É—á–µ—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö —Ñ–∏–ª—å–º–æ–≤ –∏ —Å–µ—Ä–∏–∞–ª–æ–≤, –¥–µ–ª–∏—Ç–µ—Å—å –æ—Ç–∑—ã–≤–∞–º–∏ \r\n              –∏ –Ω–∞—Ö–æ–¥–∏—Ç–µ –¥—Ä—É–∑–µ–π —Å –ø–æ—Ö–æ–∂–∏–º–∏ –≤–∫—É—Å–∞–º–∏\r\n            </p>\r\n            \r\n            <div className=\"login-telegram-widget\">\r\n              <p className=\"widget-label\">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram:</p>\r\n              <div id=\"telegram-login-container\"></div>\r\n            </div>\r\n\r\n            {authError && (\r\n              <div className=\"login-error-message\">\r\n                <span className=\"error-icon\">‚ö†Ô∏è</span>\r\n                <p>{authError}</p>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default LoginPage;\r\n"],"names":["LoginPage","searchParams","useSearchParams","navigate","useNavigate","dispatch","useAppDispatch","isAuthenticated","loading","useAppSelector","state","authError","setAuthError","useState","isAuthenticating","setIsAuthenticating","useEffect","token","checkSession","error","user","response","api","userData","_b","_a","script","container","jsx","jsxs"],"mappings":"+EAYA,SAASA,GAAY,CACnB,KAAM,CAACC,CAAY,EAAIC,EAAA,EACjBC,EAAWC,EAAA,EACXC,EAAWC,EAAA,EAEX,CAAE,gBAAAC,EAAiB,QAAAC,CAAA,EAAYC,EAAgBC,GAAUA,EAAM,IAAI,EACnE,CAACC,EAAWC,CAAY,EAAIC,EAAAA,SAAS,IAAI,EACzC,CAACC,EAAkBC,CAAmB,EAAIF,EAAAA,SAAS,EAAK,EAiG9D,OA/FAG,EAAAA,UAAU,IAAM,CAEd,GAAIT,EAAiB,CACnBJ,EAAS,IAAK,CAAE,QAAS,EAAA,CAAM,EAC/B,MACF,CAGA,MAAMc,EAAQhB,EAAa,IAAI,OAAO,GAAKA,EAAa,IAAI,SAAS,EAGrE,GAFeA,EAAa,IAAI,QAAQ,EAEpCgB,EAAO,CACT,QAAQ,IAAI,2CAA2C,EAGvD,aAAa,QAAQ,YAAaA,CAAK,EAGvCZ,EAASa,GAAc,EACpB,OAAA,EACA,KAAK,IAAM,CACV,QAAQ,IAAI,iCAAiC,EAC7Cf,EAAS,IAAK,CAAE,QAAS,EAAA,CAAM,CACjC,CAAC,EACA,MAAOgB,GAAU,CAChB,QAAQ,MAAM,kCAAmCA,CAAK,EACtDP,EAAa,6DAA6D,EAC1E,aAAa,WAAW,WAAW,CACrC,CAAC,EAEH,MACF,CAGsB,aAAa,QAAQ,WAAW,GAEpDP,EAASa,GAAc,CAE3B,EAAG,CAACX,EAAiBJ,EAAUE,EAAUJ,CAAY,CAAC,EAGtDe,EAAAA,UAAU,IAAM,CACd,OAAO,eAAiB,MAAOI,GAAS,SACtC,QAAQ,IAAI,kCAAmCA,CAAI,EACnDL,EAAoB,EAAI,EACxBH,EAAa,IAAI,EAEjB,GAAI,CAEF,MAAMS,EAAW,MAAMC,EAAI,KAAK,wBAAyBF,CAAI,EAEvD,CAAE,MAAAH,EAAO,KAAMM,CAAA,EAAaF,EAAS,KAG3C,aAAa,QAAQ,YAAaJ,CAAK,EAEvC,QAAQ,IAAI,yBAA0BM,EAAS,WAAW,EAG1D,MAAMlB,EAASa,GAAc,EAAE,OAAA,EAG/Bf,EAAS,IAAK,CAAE,QAAS,EAAA,CAAM,CACjC,OAASgB,EAAO,CACd,QAAQ,MAAM,wBAAyBA,CAAK,EAC5CP,IAAaY,GAAAC,EAAAN,EAAM,WAAN,YAAAM,EAAgB,OAAhB,YAAAD,EAAsB,QAAS,2BAA2B,EACvET,EAAoB,EAAK,CAC3B,CACF,EAGA,MAAMW,EAAS,SAAS,cAAc,QAAQ,EAC9CA,EAAO,IAAM,gDACbA,EAAO,aAAa,sBAAuB,gBAA8D,EACzGA,EAAO,aAAa,YAAa,OAAO,EACxCA,EAAO,aAAa,cAAe,GAAG,EACtCA,EAAO,aAAa,cAAe,sBAAsB,EACzDA,EAAO,aAAa,sBAAuB,OAAO,EAClDA,EAAO,MAAQ,GAEf,MAAMC,EAAY,SAAS,eAAe,0BAA0B,EACpE,OAAIA,GACFA,EAAU,YAAYD,CAAM,EAGvB,IAAM,CAEPC,GAAaD,EAAO,aAAeC,GACrCA,EAAU,YAAYD,CAAM,EAE9B,OAAO,OAAO,cAChB,CACF,EAAG,CAACrB,EAAUF,CAAQ,CAAC,EAGnBK,GAAWM,QAEV,MAAA,CAAI,UAAU,aACb,SAAAc,EAAAA,IAAC,MAAA,CAAI,UAAU,kBACb,SAAAC,EAAAA,KAAC,MAAA,CAAI,UAAU,aACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,aACb,SAAA,CAAAD,EAAAA,IAAC,MAAG,SAAA,aAAU,QACb,IAAA,CAAE,UAAU,iBAAiB,SAAA,gDAA6C,CAAA,EAC7E,EACAC,EAAAA,KAAC,MAAA,CAAI,UAAU,gBACb,SAAA,CAAAD,EAAAA,IAAC,MAAA,CAAI,UAAU,UAAU,EACzBA,EAAAA,IAAC,KAAE,SAAA,iBAAc,CAAA,EACnB,CAAA,CAAA,CACF,CAAA,CACF,EACF,QAMD,MAAA,CAAI,UAAU,aACb,SAAAA,EAAAA,IAAC,MAAA,CAAI,UAAU,kBACb,SAAAC,EAAAA,KAAC,MAAA,CAAI,UAAU,aACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,aACb,SAAA,CAAAD,EAAAA,IAAC,MAAG,SAAA,aAAU,QACb,IAAA,CAAE,UAAU,iBAAiB,SAAA,gDAA6C,CAAA,EAC7E,EAEAC,EAAAA,KAAC,MAAA,CAAI,UAAU,gBACb,SAAA,CAAAD,EAAAA,IAAC,MAAA,CAAI,UAAU,aACb,SAAAA,EAAAA,IAAC,OAAI,IAAI,6BAA6B,IAAI,YAAA,CAAa,EACzD,EACAA,EAAAA,IAAC,MAAG,SAAA,oBAAiB,QACpB,IAAA,CAAE,UAAU,oBAAoB,SAAA,uGAGjC,EAEAC,EAAAA,KAAC,MAAA,CAAI,UAAU,wBACb,SAAA,OAAC,IAAA,CAAE,UAAU,eAAe,SAAA,wBAAqB,EACjDD,EAAAA,IAAC,MAAA,CAAI,GAAG,2BAA2B,CAAA,EACrC,EAECjB,GACCkB,EAAAA,KAAC,MAAA,CAAI,UAAU,sBACb,SAAA,OAAC,OAAA,CAAK,UAAU,aAAa,SAAA,KAAE,EAC/BD,EAAAA,IAAC,KAAG,SAAAjB,EAAU,CAAA,EAChB,CAAA,EAEJ,CAAA,CAAA,CACF,CAAA,CACF,EACF,CAEJ"}