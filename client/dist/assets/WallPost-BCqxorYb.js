import{r as l,j as e,a as V,b as ae,c as ie,M as oe,N as ce,e as H,f as G}from"./index-DPQ5xN5C.js";import{u as re}from"./useConfirm-ByNQs_z1.js";import{u as de}from"./useAlert-C1sBKQSI.js";const le="_reactionPicker_wifv9_3",ue="_pickerHeader_wifv9_57",me="_pickerTitle_wifv9_75",_e="_closeButton_wifv9_87",he="_emojiGrid_wifv9_133",fe="_emojiButton_wifv9_145",x={reactionPicker:le,pickerHeader:ue,pickerTitle:me,closeButton:_e,emojiGrid:he,emojiButton:fe},xe=({onSelect:t,onClose:c})=>{const m=l.useRef(null),[h,v]=l.useState([]),r=["â¤ï¸","ðŸ‘","ðŸ˜‚","ðŸ˜Š","ðŸ˜®","ðŸ˜¢","ðŸ˜¡","ðŸ”¥","ðŸ‘","ðŸŽ‰","ðŸ’¯","ðŸ¤”","ðŸ˜","ðŸ¤©","ðŸ˜Ž","ðŸ¥³","ðŸ˜±","ðŸ¤¯","ðŸ‘€","ðŸ’©","ðŸ¤¡","ðŸ¤®","ðŸ˜¤","ðŸ™„","ðŸ˜’","ðŸ‘Ž","ðŸ’€","ðŸ¤¬","ðŸ˜ˆ"];l.useEffect(()=>{const i=JSON.parse(localStorage.getItem("emojiUsage")||"{}"),u=[...r].sort((p,g)=>{const N=i[p]||0;return(i[g]||0)-N});v(u)},[]),l.useEffect(()=>{const i=u=>{m.current&&!m.current.contains(u.target)&&c()};return document.addEventListener("mousedown",i),()=>{document.removeEventListener("mousedown",i)}},[c]),l.useEffect(()=>{const i=u=>{u.key==="Escape"&&c()};return document.addEventListener("keydown",i),()=>{document.removeEventListener("keydown",i)}},[c]);const d=i=>{const u=JSON.parse(localStorage.getItem("emojiUsage")||"{}");u[i]=(u[i]||0)+1,localStorage.setItem("emojiUsage",JSON.stringify(u)),t(i)};return e.jsxs("div",{className:x.reactionPicker,ref:m,children:[e.jsxs("div",{className:x.pickerHeader,children:[e.jsx("span",{className:x.pickerTitle,children:"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ€ÐµÐ°ÐºÑ†Ð¸ÑŽ"}),e.jsx("button",{className:x.closeButton,onClick:c,"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ",children:"Ã—"})]}),e.jsx("div",{className:x.emojiGrid,children:h.map(i=>e.jsx("button",{className:x.emojiButton,onClick:()=>d(i),title:i,children:i},i))})]})},je="_tooltip_15kfh_1",ve="_tooltipContent_15kfh_25",pe="_userItem_15kfh_37",Ne="_avatar_15kfh_65",ge="_avatarPlaceholder_15kfh_93",Te="_userName_15kfh_117",j={tooltip:je,tooltipContent:ve,userItem:pe,avatar:Ne,avatarPlaceholder:ge,userName:Te},we=({users:t,position:c,onMouseEnter:m,onMouseLeave:h})=>{const v=V(),r=(d,i)=>{i.stopPropagation(),v(`/profile/${d}`)};return e.jsx("div",{className:j.tooltip,style:{left:(c==null?void 0:c.x)||0,top:(c==null?void 0:c.y)||0},onMouseEnter:m,onMouseLeave:h,children:e.jsx("div",{className:j.tooltipContent,children:t.map(d=>e.jsxs("div",{className:j.userItem,onClick:i=>r(d.id,i),children:[e.jsx("div",{className:j.avatar,children:d.avatarUrl?e.jsx("img",{src:d.avatarUrl,alt:d.name}):e.jsx("div",{className:j.avatarPlaceholder,children:d.name.charAt(0).toUpperCase()})}),e.jsx("span",{className:j.userName,children:d.name})]},d.id))})})},Ce="_wallPost_1dsun_3",ke="_postActions_1dsun_29",ye="_postContent_1dsun_39",Be="_textContent_1dsun_49",Ie="_actionText_1dsun_69",be="_mediaInfo_1dsun_83",De="_mediaDetails_1dsun_127",Ee="_mediaTitle_1dsun_143",Re="_mediaType_1dsun_159",Se="_ratingValue_1dsun_171",Le="_ratingStars_1dsun_185",Me="_ratingNumber_1dsun_195",Pe="_reviewText_1dsun_209",Ae="_postFooter_1dsun_245",$e="_postFooterLeft_1dsun_261",Ue="_postDate_1dsun_273",Fe="_editedLabel_1dsun_283",He="_editButton_1dsun_309",Ge="_deleteButton_1dsun_311",Ve="_reactionsContainer_1dsun_367",We="_reactionsList_1dsun_379",Je="_reactionBadge_1dsun_391",Oe="_userReaction_1dsun_427",Ye="_addReactionContainer_1dsun_443",qe="_addReactionButton_1dsun_451",ze="_editMode_1dsun_547",Ke="_editTextarea_1dsun_559",Qe="_editButtons_1dsun_597",Xe="_saveButton_1dsun_607",Ze="_cancelButton_1dsun_609",s={wallPost:Ce,postActions:ke,postContent:ye,textContent:Be,actionText:Ie,mediaInfo:be,mediaDetails:De,mediaTitle:Ee,mediaType:Re,ratingValue:Se,ratingStars:Le,ratingNumber:Me,reviewText:Pe,postFooter:Ae,postFooterLeft:$e,postDate:Ue,editedLabel:Fe,editButton:He,deleteButton:Ge,reactionsContainer:Ve,reactionsList:We,reactionBadge:Je,userReaction:Oe,addReactionContainer:Ye,addReactionButton:qe,editMode:ze,editTextarea:Ke,editButtons:Qe,saveButton:Xe,cancelButton:Ze},nt=({post:t,isOwnProfile:c,onReactionChange:m})=>{var A,$;const h=ae(),v=V(),r=ie(n=>n.auth.user),{confirmDialog:d,showConfirm:i}=re(),{alertDialog:u,showAlert:p}=de(),[g,N]=l.useState(!1),[w,R]=l.useState(!1),[C,k]=l.useState(null),f=l.useRef(null),[S,y]=l.useState(!1),[B,I]=l.useState(t.content||""),[T,L]=l.useState(!1),M=async n=>{try{await h(ce({postId:t.id,emoji:n})).unwrap(),N(!1),m&&m()}catch(a){console.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ñ€ÐµÐ°ÐºÑ†Ð¸Ð¸:",a)}},W=async n=>{try{await H.delete(`/wall/${t.id}/reactions/${n}`),h(G(t.userId)),m&&m()}catch(a){console.error("ÐžÑˆÐ¸Ð±ÐºÐ° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ Ñ€ÐµÐ°ÐºÑ†Ð¸Ð¸:",a)}},J=async n=>{var o;if(!r)return;const a=(o=t.reactions)==null?void 0:o.find(_=>_.userId===r.id&&_.emoji===n.emoji);a?await W(a.id):await M(n.emoji)},O=(n,a)=>{f.current&&clearTimeout(f.current);const o=n.currentTarget.getBoundingClientRect();k({users:a,position:{x:o.left,y:o.bottom+5}})},Y=()=>{f.current=setTimeout(()=>{k(null)},300)},q=()=>{f.current&&clearTimeout(f.current)},z=()=>{k(null)};l.useEffect(()=>()=>{f.current&&clearTimeout(f.current)},[]);const K=async()=>{if(await i({title:"Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð·Ð°Ð¿Ð¸ÑÑŒ?",message:"Ð’Ñ‹ ÑƒÐ²ÐµÑ€ÐµÐ½Ñ‹, Ñ‡Ñ‚Ð¾ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÑ‚Ñƒ Ð·Ð°Ð¿Ð¸ÑÑŒ? Ð­Ñ‚Ð¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ð½ÐµÐ»ÑŒÐ·Ñ Ð¾Ñ‚Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ.",confirmText:"Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ",cancelText:"ÐžÑ‚Ð¼ÐµÐ½Ð°",confirmButtonStyle:"danger"})){R(!0);try{await h(oe(t.id)).unwrap()}catch(a){console.error("ÐžÑˆÐ¸Ð±ÐºÐ° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ Ð¿Ð¾ÑÑ‚Ð°:",a),await p({title:"ÐžÑˆÐ¸Ð±ÐºÐ°",message:"ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ Ð·Ð°Ð¿Ð¸ÑÑŒ. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÐµÑ‰Ðµ Ñ€Ð°Ð·.",type:"error"}),R(!1)}}},Q=()=>{y(!0),I(t.content||"")},X=async()=>{var n,a;if(!B.trim()){await p({title:"ÐžÑˆÐ¸Ð±ÐºÐ°",message:"ÐšÐ¾Ð½Ñ‚ÐµÐ½Ñ‚ Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð¿ÑƒÑÑ‚Ñ‹Ð¼",type:"error"});return}L(!0);try{await H.put(`/wall/${t.id}`,{content:B.trim()}),h(G(t.userId)),y(!1)}catch(o){console.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¿Ð¾ÑÑ‚Ð°:",o),await p({title:"ÐžÑˆÐ¸Ð±ÐºÐ°",message:((a=(n=o.response)==null?void 0:n.data)==null?void 0:a.error)||"ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¾Ñ‚Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð·Ð°Ð¿Ð¸ÑÑŒ",type:"error"})}finally{L(!1)}},Z=()=>{y(!1),I(t.content||"")},ee=()=>{const n=new Date(t.createdAt),a=new Date,o=60*60*1e3;return a-n<o},te=n=>{const a=new Date(n),o=new Date,_=o-a,E=Math.floor(_/6e4),U=Math.floor(_/36e5),F=Math.floor(_/864e5);return E<1?"Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ‡Ñ‚Ð¾":E<60?`${E} Ð¼Ð¸Ð½ Ð½Ð°Ð·Ð°Ð´`:U<24?`${U} Ñ‡ Ð½Ð°Ð·Ð°Ð´`:F<7?`${F} Ð´ Ð½Ð°Ð·Ð°Ð´`:a.toLocaleDateString("ru-RU",{day:"numeric",month:"short",year:a.getFullYear()!==o.getFullYear()?"numeric":void 0})},b=()=>{t.tmdbId&&t.mediaType&&v(`/media/${t.mediaType}/${t.tmdbId}`)},se=()=>{switch(t.postType){case"text":return e.jsx("div",{className:s.textContent,children:S?e.jsxs("div",{className:s.editMode,children:[e.jsx("textarea",{className:s.editTextarea,value:B,onChange:n=>I(n.target.value),rows:4,disabled:T}),e.jsxs("div",{className:s.editButtons,children:[e.jsx("button",{className:s.saveButton,onClick:X,disabled:T,children:T?"Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ...":"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ"}),e.jsx("button",{className:s.cancelButton,onClick:Z,disabled:T,children:"ÐžÑ‚Ð¼ÐµÐ½Ð°"})]})]}):e.jsx("p",{children:t.content})});case"media_added":return e.jsxs("div",{className:s.mediaAddedContent,children:[e.jsxs("p",{className:s.actionText,children:["ðŸ“Œ Ð”Ð¾Ð±Ð°Ð²Ð¸Ð»",c?"":"Ð°"," Ð² ÑÐ¿Ð¸ÑÐ¾Ðº"]}),t.tmdbId&&e.jsx("div",{className:s.mediaInfo,onClick:b,children:e.jsxs("div",{className:s.mediaDetails,children:[e.jsxs("h4",{className:s.mediaTitle,children:[t.mediaType==="movie"?"Ð¤Ð¸Ð»ÑŒÐ¼":"Ð¡ÐµÑ€Ð¸Ð°Ð»"," (ID: ",t.tmdbId,")"]}),e.jsx("span",{className:s.mediaType,children:t.mediaType==="movie"?"ðŸŽ¬ Ð¤Ð¸Ð»ÑŒÐ¼":"ðŸ“º Ð¡ÐµÑ€Ð¸Ð°Ð»"})]})})]});case"rating":return e.jsxs("div",{className:s.ratingContent,children:[e.jsxs("p",{className:s.actionText,children:["â­ ÐžÑ†ÐµÐ½Ð¸Ð»",c?"":"Ð°"]}),t.tmdbId&&e.jsx("div",{className:s.mediaInfo,onClick:b,children:e.jsxs("div",{className:s.mediaDetails,children:[e.jsxs("h4",{className:s.mediaTitle,children:[t.mediaType==="movie"?"Ð¤Ð¸Ð»ÑŒÐ¼":"Ð¡ÐµÑ€Ð¸Ð°Ð»"," (ID: ",t.tmdbId,")"]}),e.jsxs("div",{className:s.ratingValue,children:[e.jsx("span",{className:s.ratingStars,children:"â˜…"}),e.jsxs("span",{className:s.ratingNumber,children:[t.rating,"/10"]})]})]})})]});case"review":return e.jsxs("div",{className:s.reviewContent,children:[e.jsxs("p",{className:s.actionText,children:["âœï¸ ÐÐ°Ð¿Ð¸ÑÐ°Ð»",c?"":"Ð°"," Ð¾Ñ‚Ð·Ñ‹Ð²"]}),t.tmdbId&&e.jsx("div",{className:s.mediaInfo,onClick:b,children:e.jsx("div",{className:s.mediaDetails,children:e.jsxs("h4",{className:s.mediaTitle,children:[t.mediaType==="movie"?"Ð¤Ð¸Ð»ÑŒÐ¼":"Ð¡ÐµÑ€Ð¸Ð°Ð»"," (ID: ",t.tmdbId,")"]})})}),t.content&&e.jsx("div",{className:s.reviewText,children:e.jsx("p",{children:t.content})})]});default:return null}},ne=((A=t.reactions)==null?void 0:A.reduce((n,a)=>{var o,_;return n[a.emoji]||(n[a.emoji]={emoji:a.emoji,count:0,users:[]}),n[a.emoji].count++,n[a.emoji].users.push({id:a.userId,name:((o=a.user)==null?void 0:o.displayName)||"ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ",avatarUrl:((_=a.user)==null?void 0:_.avatarUrl)||null}),n},{}))||{},P=Object.values(ne),D=($=t.reactions)==null?void 0:$.find(n=>n.userId===(r==null?void 0:r.id));return e.jsxs(e.Fragment,{children:[d,u,e.jsxs("div",{className:s.wallPost,children:[e.jsx("div",{className:s.postContent,children:se()}),e.jsxs("div",{className:s.postFooter,children:[e.jsxs("div",{className:s.postFooterLeft,children:[e.jsxs("span",{className:s.postDate,children:[te(t.createdAt),t.editedAt&&e.jsx("span",{className:s.editedLabel,children:" (Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¾)"})]}),c&&r&&t.userId===r.id&&e.jsxs("div",{className:s.postActions,children:[ee()&&(t.postType==="text"||t.postType==="review")&&!S&&e.jsx("button",{className:s.editButton,onClick:Q,title:"Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ",children:"âœï¸"}),e.jsx("button",{className:s.deleteButton,onClick:K,disabled:w,title:"Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð·Ð°Ð¿Ð¸ÑÑŒ",children:w?"â³":"ðŸ—‘ï¸"})]})]}),e.jsxs("div",{className:s.reactionsContainer,children:[P.length>0&&e.jsx("div",{className:s.reactionsList,children:P.map(n=>{const a=r&&n.users.some(o=>o.id===r.id);return e.jsxs("span",{className:`${s.reactionBadge} ${a?s.userReaction:""}`,onClick:()=>J(n),onMouseEnter:o=>O(o,n.users),onMouseLeave:Y,children:[n.emoji," ",n.count]},n.emoji)})}),r&&e.jsxs("div",{className:s.addReactionContainer,children:[e.jsx("button",{className:s.addReactionButton,onClick:()=>N(!g),title:D?"Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ñ€ÐµÐ°ÐºÑ†Ð¸ÑŽ":"Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ñ€ÐµÐ°ÐºÑ†Ð¸ÑŽ",children:D?D.emoji:"ðŸ˜Š"}),g&&e.jsx(xe,{onSelect:M,onClose:()=>N(!1)})]})]}),C&&e.jsx(we,{users:C.users,position:C.position,onMouseEnter:q,onMouseLeave:z})]})]})]})};export{nt as W};
//# sourceMappingURL=WallPost-BCqxorYb.js.map
