import{r as b,j as e,h as C,i as $,g as A,a as P,b as E,c as S,k as W,m as D,n as F,o as R,p as H,q as M}from"./index-BGc1Rv-X.js";const U="_episodeTracker_4uxqa_1",Y="_title_4uxqa_15",z="_emptyState_4uxqa_29",G="_seasonsList_4uxqa_41",J="_seasonItem_4uxqa_53",K="_seasonHeader_4uxqa_75",O="_seasonInfo_4uxqa_103",Q="_seasonTitle_4uxqa_111",V="_seasonProgress_4uxqa_125",X="_seasonActions_4uxqa_135",Z="_markAllButton_4uxqa_147",ee="_expandIcon_4uxqa_189",se="_progressBar_4uxqa_201",te="_progressFill_4uxqa_213",ae="_episodesList_4uxqa_225",ne="_episodeButton_4uxqa_241",oe="_watched_4uxqa_285",ie="_episodeNumber_4uxqa_307",ce="_checkmark_4uxqa_315",re="_lastWatched_4uxqa_329",o={episodeTracker:U,title:Y,emptyState:z,seasonsList:G,seasonItem:J,seasonHeader:K,seasonInfo:O,seasonTitle:Q,seasonProgress:V,seasonActions:X,markAllButton:Z,expandIcon:ee,progressBar:se,progressFill:te,episodesList:ae,episodeButton:ne,watched:oe,episodeNumber:ie,checkmark:ce,lastWatched:re},le=({seriesId:r,seasons:d=[],currentProgress:m=[],onMarkWatched:l})=>{const[s,x]=b.useState(null),u=(t,n)=>m.some(_=>_.seasonNumber===t&&_.episodeNumber===n),N=t=>{const n=m.filter(_=>_.seasonNumber===t).sort((_,v)=>v.episodeNumber-_.episodeNumber);return n.length>0?n[0].episodeNumber:0},k=t=>m.filter(n=>n.seasonNumber===t).length,h=t=>{x(s===t?null:t)},c=(t,n)=>{l&&l(t,n)},j=t=>{if(l)for(let n=1;n<=t.episodeCount;n++)u(t.seasonNumber,n)||l(t.seasonNumber,n)};return!d||d.length===0?e.jsx("div",{className:o.emptyState,children:e.jsx("p",{children:"Информация о сезонах недоступна"})}):e.jsxs("div",{className:o.episodeTracker,children:[e.jsx("h3",{className:o.title,children:"Прогресс просмотра"}),e.jsx("div",{className:o.seasonsList,children:d.map(t=>{const n=k(t.seasonNumber),_=s===t.seasonNumber,v=N(t.seasonNumber),y=n/t.episodeCount*100;return e.jsxs("div",{className:o.seasonItem,children:[e.jsxs("div",{className:o.seasonHeader,onClick:()=>h(t.seasonNumber),children:[e.jsxs("div",{className:o.seasonInfo,children:[e.jsx("h4",{className:o.seasonTitle,children:t.name||`Сезон ${t.seasonNumber}`}),e.jsxs("span",{className:o.seasonProgress,children:[n," / ",t.episodeCount," серий"]})]}),e.jsxs("div",{className:o.seasonActions,children:[n<t.episodeCount&&e.jsx("button",{className:o.markAllButton,onClick:p=>{p.stopPropagation(),j(t)},title:"Отметить все серии",children:"✓ Все"}),e.jsx("span",{className:o.expandIcon,children:_?"▼":"▶"})]})]}),e.jsx("div",{className:o.progressBar,children:e.jsx("div",{className:o.progressFill,style:{width:`${y}%`}})}),_&&e.jsx("div",{className:o.episodesList,children:Array.from({length:t.episodeCount},(p,f)=>f+1).map(p=>{const f=u(t.seasonNumber,p);return e.jsxs("button",{className:`${o.episodeButton} ${f?o.watched:""}`,onClick:()=>c(t.seasonNumber,p),title:`Серия ${p}`,children:[e.jsx("span",{className:o.episodeNumber,children:p}),f&&e.jsx("span",{className:o.checkmark,children:"✓"})]},p)})}),!_&&v>0&&e.jsxs("div",{className:o.lastWatched,children:["Последняя: серия ",v]})]},t.seasonNumber)})})]})},de="_ratingSelector_1mwfu_3",_e="_ratingLabel_1mwfu_25",pe="_ratingButtons_1mwfu_41",me="_ratingButton_1mwfu_41",ue="_active_1mwfu_103",he="_selected_1mwfu_117",ge="_loadingIndicator_1mwfu_143",g={ratingSelector:de,ratingLabel:_e,ratingButtons:pe,ratingButton:me,active:ue,selected:he,loadingIndicator:ge},xe=({media:r,currentRating:d=null,onRatingSet:m})=>{const l=C(),[s,x]=b.useState(null),[u,N]=b.useState(!1),k=async c=>{if(!u){N(!0);try{await l($({tmdbId:r.tmdbId,mediaType:r.mediaType,rating:c})).unwrap(),m&&m(c)}catch(j){console.error("Ошибка при сохранении рейтинга:",j)}finally{N(!1)}}},h=s||d;return e.jsxs("div",{className:g.ratingSelector,children:[e.jsxs("div",{className:g.ratingLabel,children:["Ваша оценка: ",h?`${h}/10`:"не оценено"]}),e.jsx("div",{className:g.ratingButtons,children:[1,2,3,4,5,6,7,8,9,10].map(c=>e.jsx("button",{className:`${g.ratingButton} ${h&&c<=h?g.active:""} ${d===c?g.selected:""}`,onClick:()=>k(c),onMouseEnter:()=>x(c),onMouseLeave:()=>x(null),disabled:u,title:`Оценить на ${c}`,children:c},c))}),u&&e.jsx("div",{className:g.loadingIndicator,children:"Сохранение..."})]})},Ne="_mediaDetailPage_1p50o_1",je="_backdrop_1p50o_13",ve="_content_1p50o_57",fe="_backButton_1p50o_73",be="_mainInfo_1p50o_109",ke="_posterSection_1p50o_123",ye="_poster_1p50o_123",Se="_infoSection_1p50o_147",Ie="_title_1p50o_161",we="_originalTitle_1p50o_177",Be="_meta_1p50o_191",Le="_type_1p50o_209",Te="_separator_1p50o_219",qe="_rating_1p50o_227",Ce="_overview_1p50o_237",$e="_actions_1p50o_251",Ae="_actionButton_1p50o_265",Pe="_selector_1p50o_327",Ee="_select_1p50o_327",We="_confirmButton_1p50o_367",De="_episodeSection_1p50o_477",Fe="_loading_1p50o_485",a={mediaDetailPage:Ne,backdrop:je,content:ve,backButton:fe,mainInfo:be,posterSection:ke,poster:ye,infoSection:Se,title:Ie,originalTitle:we,meta:Be,type:Le,separator:Te,rating:qe,overview:Ce,actions:$e,actionButton:Ae,selector:Pe,select:Ee,confirmButton:We,episodeSection:De,loading:Fe},He=()=>{const{mediaType:r,mediaId:d}=A(),m=P(),l=E(),{selectedMedia:s,loading:x}=S(i=>i.media),{customLists:u,episodeProgress:N,ratings:k}=S(i=>i.lists),{user:h}=S(i=>i.auth),[c,j]=b.useState(""),[t,n]=b.useState(!1);b.useEffect(()=>{r&&d&&(l(W({type:r,id:d})),l(D()),r==="tv"&&l(F(d)))},[l,r,d]);const _=async()=>{if(!(!c||!s))try{await l(H({listId:c,media:{tmdbId:s.id,mediaType:s.media_type||r}})).unwrap(),n(!1),j(""),alert("Добавлено в список!")}catch{alert("Ошибка при добавлении в список")}},v=async()=>{if(s)try{await l(R({tmdbId:s.id,mediaType:s.media_type||r})).unwrap(),alert("Добавлено в список желаемого!")}catch{alert("Ошибка при добавлении в watchlist")}},y=async(i,T)=>{if(s)try{await l(M({tmdbId:s.id,seasonNumber:i,episodeNumber:T})).unwrap()}catch(q){console.error("Ошибка при отметке серии:",q)}};if(x||!s)return e.jsx("div",{className:a.loading,children:e.jsx("p",{children:"Загрузка..."})});const p=s.backdrop_path?`https://image.tmdb.org/t/p/original${s.backdrop_path}`:null,f=s.poster_path?`https://image.tmdb.org/t/p/w500${s.poster_path}`:"/default-poster.png",I=s.release_date||s.first_air_date?new Date(s.release_date||s.first_air_date).getFullYear():null,w=u.filter(i=>i.mediaType===(s.media_type||r)),B=N[d]||[],L=k[d]||null;return e.jsxs("div",{className:a.mediaDetailPage,children:[p&&e.jsx("div",{className:a.backdrop,style:{backgroundImage:`url(${p})`}}),e.jsxs("div",{className:a.content,children:[e.jsx("button",{className:a.backButton,onClick:()=>m(-1),children:"← Назад"}),e.jsxs("div",{className:a.mainInfo,children:[e.jsx("div",{className:a.posterSection,children:e.jsx("img",{src:f,alt:s.title||s.name,className:a.poster})}),e.jsxs("div",{className:a.infoSection,children:[e.jsx("h1",{className:a.title,children:s.title||s.name}),s.original_title&&s.original_title!==s.title&&e.jsx("p",{className:a.originalTitle,children:s.original_title||s.original_name}),e.jsxs("div",{className:a.meta,children:[e.jsx("span",{className:a.type,children:(s.media_type||r)==="movie"?"Фильм":"Сериал"}),I&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:a.separator,children:"•"}),e.jsx("span",{children:I})]}),s.vote_average>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:a.separator,children:"•"}),e.jsxs("span",{className:a.rating,children:["★ ",s.vote_average.toFixed(1)]})]})]}),s.overview&&e.jsx("p",{className:a.overview,children:s.overview}),e.jsxs("div",{className:a.actions,children:[e.jsx("button",{className:a.actionButton,onClick:()=>n(!t),children:"+ Добавить в список"}),e.jsx("button",{className:a.actionButton,onClick:v,children:"+ В список желаемого"})]}),t&&e.jsxs("div",{className:a.selector,children:[e.jsxs("select",{value:c,onChange:i=>j(i.target.value),className:a.select,children:[e.jsx("option",{value:"",children:"Выберите список"}),w.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]}),e.jsx("button",{className:a.confirmButton,onClick:_,disabled:!c,children:"Добавить"})]}),e.jsx(xe,{media:{tmdbId:s.id,mediaType:s.media_type||r,title:s.title||s.name},currentRating:L,onRatingSet:i=>{alert(`Оценка ${i}/10 сохранена и добавлена на стену!`)}})]})]}),(s.media_type||r)==="tv"&&s.seasons&&e.jsx("div",{className:a.episodeSection,children:e.jsx(le,{seriesId:s.id,seasons:s.seasons,currentProgress:B,onMarkWatched:y})})]})]})};export{He as default};
//# sourceMappingURL=MediaDetailPage-DzF14Yio.js.map
