import{b as P,c as U,r as i,H as B,e as L,j as e,I as F,J as T,R,K as $,L as k}from"./index-DPQ5xN5C.js";import{U as E}from"./UserPageLayout-BKV1caGZ.js";const H="_container_90lqr_1",K="_header_90lqr_17",z="_title_90lqr_33",O="_newMessageButton_90lqr_47",Q="_loading_90lqr_95",Y="_empty_90lqr_97",J="_emptyIcon_90lqr_117",V="_emptyHint_90lqr_127",G="_list_90lqr_139",W="_item_90lqr_155",X="_active_90lqr_181",Z="_avatar_90lqr_191",ee="_avatarImage_90lqr_201",ae="_avatarPlaceholder_90lqr_215",se="_content_90lqr_241",te="_topRow_90lqr_251",re="_name_90lqr_265",ne="_time_90lqr_281",le="_bottomRow_90lqr_295",de="_lastMessage_90lqr_307",ce="_unreadBadge_90lqr_327",oe="_modal_90lqr_355",ie="_modalContent_90lqr_383",me="_modalHeader_90lqr_407",he="_closeButton_90lqr_437",_e="_searchInput_90lqr_479",ge="_friendsList_90lqr_511",ue="_friendItem_90lqr_523",pe="_friendAvatar_90lqr_551",ve="_friendAvatarImage_90lqr_561",Ne="_friendAvatarPlaceholder_90lqr_575",xe="_friendName_90lqr_601",je="_modalLoading_90lqr_613",fe="_modalEmpty_90lqr_615",s={container:H,header:K,title:z,newMessageButton:O,loading:Q,empty:Y,emptyIcon:J,emptyHint:V,list:G,item:W,active:X,avatar:Z,avatarImage:ee,avatarPlaceholder:ae,content:se,topRow:te,name:re,time:ne,bottomRow:le,lastMessage:de,unreadBadge:ce,modal:oe,modalContent:ie,modalHeader:me,closeButton:he,searchInput:_e,friendsList:ge,friendItem:ue,friendAvatar:pe,friendAvatarImage:ve,friendAvatarPlaceholder:Ne,friendName:xe,modalLoading:je,modalEmpty:fe},ye=({onSelectConversation:n})=>{const m=P(),{conversations:c,loading:N,currentConversation:p}=U(a=>a.messages),{user:x}=U(a=>a.auth),[h,o]=i.useState(!1),[y,w]=i.useState([]),[j,A]=i.useState(!1),[u,v]=i.useState("");i.useEffect(()=>{m(B())},[m]),i.useEffect(()=>{h&&x&&C()},[h,x]);const C=async()=>{try{A(!0);const a=await L.get(`/users/${x.id}/friends`);w(a.data)}catch(a){console.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð´Ñ€ÑƒÐ·ÐµÐ¹:",a)}finally{A(!1)}},f=a=>{m(F(a.id)),n&&n(a)},t=a=>{const g=c.find(b=>b.otherUser.id===a.id);if(g)o(!1),v(""),f(g);else{const b={id:null,otherUser:{id:a.id,displayName:a.displayName,avatarUrl:a.avatarUrl},lastMessage:null,unreadCount:0,lastMessageAt:new Date().toISOString(),createdAt:new Date().toISOString()};o(!1),v(""),f(b)}},l=y.filter(a=>a.displayName.toLowerCase().includes(u.toLowerCase())),d=a=>{const g=new Date(a),M=new Date-g,I=Math.floor(M/6e4),q=Math.floor(M/36e5),D=Math.floor(M/864e5);return I<1?"Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ‡Ñ‚Ð¾":I<60?`${I} Ð¼Ð¸Ð½`:q<24?`${q} Ñ‡`:D<7?`${D} Ð´Ð½`:g.toLocaleDateString("ru-RU",{day:"numeric",month:"short"})},_=(a,g=50)=>a?a.length<=g?a:a.substring(0,g)+"...":"";return N&&c.length===0?e.jsx("div",{className:s.container,children:e.jsx("div",{className:s.loading,children:"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð¸Ð°Ð»Ð¾Ð³Ð¾Ð²..."})}):c.length===0?e.jsxs("div",{className:s.container,children:[e.jsxs("div",{className:s.header,children:[e.jsx("h2",{className:s.title,children:"Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ"}),e.jsx("button",{className:s.newMessageButton,onClick:()=>o(!0),title:"ÐÐ°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ Ð½Ð¾Ð²Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ",children:"âœï¸ ÐÐ°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ"})]}),e.jsxs("div",{className:s.empty,children:[e.jsx("span",{className:s.emptyIcon,children:"ðŸ’¬"}),e.jsx("p",{children:"ÐŸÐ¾ÐºÐ° Ð½ÐµÑ‚ Ð´Ð¸Ð°Ð»Ð¾Ð³Ð¾Ð²"}),e.jsx("p",{className:s.emptyHint,children:'ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ "ÐÐ°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ", Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ Ð¿ÐµÑ€ÐµÐ¿Ð¸ÑÐºÑƒ'})]}),h&&e.jsx("div",{className:s.modal,onClick:()=>o(!1),children:e.jsxs("div",{className:s.modalContent,onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:s.modalHeader,children:[e.jsx("h3",{children:"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¿Ð¾Ð»ÑƒÑ‡Ð°Ñ‚ÐµÐ»Ñ"}),e.jsx("button",{className:s.closeButton,onClick:()=>o(!1),children:"Ã—"})]}),e.jsx("input",{type:"text",className:s.searchInput,placeholder:"ÐŸÐ¾Ð¸ÑÐº Ð´Ñ€ÑƒÐ·ÐµÐ¹...",value:u,onChange:a=>v(a.target.value),autoFocus:!0}),e.jsx("div",{className:s.friendsList,children:j?e.jsx("div",{className:s.modalLoading,children:"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ñ€ÑƒÐ·ÐµÐ¹..."}):l.length===0?e.jsx("div",{className:s.modalEmpty,children:u?"Ð”Ñ€ÑƒÐ·ÑŒÑ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹":"Ð£ Ð²Ð°Ñ Ð¿Ð¾ÐºÐ° Ð½ÐµÑ‚ Ð´Ñ€ÑƒÐ·ÐµÐ¹"}):l.map(a=>e.jsxs("div",{className:s.friendItem,onClick:()=>t(a),children:[e.jsx("div",{className:s.friendAvatar,children:a.avatarUrl?e.jsx("img",{src:a.avatarUrl,alt:a.displayName,className:s.friendAvatarImage}):e.jsx("div",{className:s.friendAvatarPlaceholder,children:a.displayName.charAt(0).toUpperCase()})}),e.jsx("span",{className:s.friendName,children:a.displayName})]},a.id))})]})})]}):e.jsxs("div",{className:s.container,children:[e.jsxs("div",{className:s.header,children:[e.jsx("h2",{className:s.title,children:"Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ"}),e.jsx("button",{className:s.newMessageButton,onClick:()=>o(!0),title:"ÐÐ°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ Ð½Ð¾Ð²Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ",children:"âœï¸ ÐÐ°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ"})]}),e.jsx("ul",{className:s.list,children:c.map(a=>e.jsxs("li",{className:`${s.item} ${p===a.id?s.active:""}`,onClick:()=>f(a),children:[e.jsx("div",{className:s.avatar,children:a.otherUser.avatarUrl?e.jsx("img",{src:a.otherUser.avatarUrl,alt:a.otherUser.displayName,className:s.avatarImage}):e.jsx("div",{className:s.avatarPlaceholder,children:a.otherUser.displayName.charAt(0).toUpperCase()})}),e.jsxs("div",{className:s.content,children:[e.jsxs("div",{className:s.topRow,children:[e.jsx("span",{className:s.name,children:a.otherUser.displayName}),e.jsx("span",{className:s.time,children:d(a.lastMessageAt)})]}),e.jsxs("div",{className:s.bottomRow,children:[e.jsx("p",{className:s.lastMessage,children:_(a.lastMessage)}),a.unreadCount>0&&e.jsx("div",{className:s.unreadBadge,children:a.unreadCount})]})]})]},a.id))}),h&&e.jsx("div",{className:s.modal,onClick:()=>o(!1),children:e.jsxs("div",{className:s.modalContent,onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:s.modalHeader,children:[e.jsx("h3",{children:"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¿Ð¾Ð»ÑƒÑ‡Ð°Ñ‚ÐµÐ»Ñ"}),e.jsx("button",{className:s.closeButton,onClick:()=>o(!1),children:"Ã—"})]}),e.jsx("input",{type:"text",className:s.searchInput,placeholder:"ÐŸÐ¾Ð¸ÑÐº Ð´Ñ€ÑƒÐ·ÐµÐ¹...",value:u,onChange:a=>v(a.target.value),autoFocus:!0}),e.jsx("div",{className:s.friendsList,children:j?e.jsx("div",{className:s.modalLoading,children:"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ñ€ÑƒÐ·ÐµÐ¹..."}):l.length===0?e.jsx("div",{className:s.modalEmpty,children:u?"Ð”Ñ€ÑƒÐ·ÑŒÑ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹":"Ð£ Ð²Ð°Ñ Ð¿Ð¾ÐºÐ° Ð½ÐµÑ‚ Ð´Ñ€ÑƒÐ·ÐµÐ¹"}):l.map(a=>e.jsxs("div",{className:s.friendItem,onClick:()=>t(a),children:[e.jsx("div",{className:s.friendAvatar,children:a.avatarUrl?e.jsx("img",{src:a.avatarUrl,alt:a.displayName,className:s.friendAvatarImage}):e.jsx("div",{className:s.friendAvatarPlaceholder,children:a.displayName.charAt(0).toUpperCase()})}),e.jsx("span",{className:s.friendName,children:a.displayName})]},a.id))})]})})]})},Ae="_container_d56hb_1",be="_header_d56hb_15",Ue="_headerAvatar_d56hb_31",we="_headerAvatarImage_d56hb_39",Ce="_headerAvatarPlaceholder_d56hb_53",Me="_headerName_d56hb_79",Ie="_loading_d56hb_93",Se="_empty_d56hb_95",qe="_emptyMessages_d56hb_97",De="_emptyIcon_d56hb_119",Pe="_messagesContainer_d56hb_129",Be="_messagesList_d56hb_143",Le="_dateSeparator_d56hb_155",Fe="_message_d56hb_129",Te="_ownMessage_d56hb_221",Re="_otherMessage_d56hb_231",$e="_messageAvatar_d56hb_239",ke="_messageAvatarImage_d56hb_247",Ee="_messageAvatarPlaceholder_d56hb_261",He="_messageBubble_d56hb_287",Ke="_messageText_d56hb_311",ze="_messageFooter_d56hb_327",Oe="_messageTime_d56hb_343",Qe="_deleteButton_d56hb_353",Ye="_inputForm_d56hb_385",Je="_input_d56hb_385",Ve="_sendButton_d56hb_451",r={container:Ae,header:be,headerAvatar:Ue,headerAvatarImage:we,headerAvatarPlaceholder:Ce,headerName:Me,loading:Ie,empty:Se,emptyMessages:qe,emptyIcon:De,messagesContainer:Pe,messagesList:Be,dateSeparator:Le,message:Fe,ownMessage:Te,otherMessage:Re,messageAvatar:$e,messageAvatarImage:ke,messageAvatarPlaceholder:Ee,messageBubble:He,messageText:Ke,messageFooter:ze,messageTime:Oe,deleteButton:Qe,inputForm:Ye,input:Je,sendButton:Ve},Ge=({conversation:n})=>{const m=P(),{messages:c,loading:N,sendingMessage:p}=U(t=>t.messages),{user:x}=U(t=>t.auth),[h,o]=i.useState(""),y=i.useRef(null);i.useEffect(()=>{n&&n.id&&m(T(n.id))},[n,m]),i.useEffect(()=>{w()},[c]);const w=()=>{var t;(t=y.current)==null||t.scrollIntoView({behavior:"smooth"})},j=async t=>{if(t.preventDefault(),!h.trim()||p)return;const l=h.trim();o("");const d=await m(k({receiverId:n.otherUser.id,content:l}));n.id===null&&d.meta.requestStatus},A=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),j(t))},u=t=>{window.confirm("Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÑ‚Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ?")&&m($(t))},v=t=>new Date(t).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}),C=t=>{const l=new Date(t),d=new Date,_=new Date(d);return _.setDate(_.getDate()-1),l.toDateString()===d.toDateString()?"Ð¡ÐµÐ³Ð¾Ð´Ð½Ñ":l.toDateString()===_.toDateString()?"Ð’Ñ‡ÐµÑ€Ð°":l.toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:l.getFullYear()!==d.getFullYear()?"numeric":void 0})},f=(t,l)=>{if(!l)return!0;const d=new Date(t.createdAt).toDateString(),_=new Date(l.createdAt).toDateString();return d!==_};return n?N&&c.length===0?e.jsxs("div",{className:r.container,children:[e.jsxs("div",{className:r.header,children:[e.jsx("div",{className:r.headerAvatar,children:n.otherUser.avatarUrl?e.jsx("img",{src:n.otherUser.avatarUrl,alt:n.otherUser.displayName,className:r.headerAvatarImage}):e.jsx("div",{className:r.headerAvatarPlaceholder,children:n.otherUser.displayName.charAt(0).toUpperCase()})}),e.jsx("h2",{className:r.headerName,children:n.otherUser.displayName})]}),e.jsx("div",{className:r.loading,children:"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹..."})]}):e.jsxs("div",{className:r.container,children:[e.jsxs("div",{className:r.header,children:[e.jsx("div",{className:r.headerAvatar,children:n.otherUser.avatarUrl?e.jsx("img",{src:n.otherUser.avatarUrl,alt:n.otherUser.displayName,className:r.headerAvatarImage}):e.jsx("div",{className:r.headerAvatarPlaceholder,children:n.otherUser.displayName.charAt(0).toUpperCase()})}),e.jsx("h2",{className:r.headerName,children:n.otherUser.displayName})]}),e.jsx("div",{className:r.messagesContainer,children:c.length===0?e.jsx("div",{className:r.emptyMessages,children:e.jsxs("p",{children:["ÐÐ°Ñ‡Ð½Ð¸Ñ‚Ðµ Ð¿ÐµÑ€ÐµÐ¿Ð¸ÑÐºÑƒ Ñ ",n.otherUser.displayName]})}):e.jsxs("div",{className:r.messagesList,children:[c.map((t,l)=>{const d=t.senderId===x.id,_=f(t,c[l-1]);return e.jsxs(R.Fragment,{children:[_&&e.jsx("div",{className:r.dateSeparator,children:C(t.createdAt)}),e.jsxs("div",{className:`${r.message} ${d?r.ownMessage:r.otherMessage}`,children:[!d&&e.jsx("div",{className:r.messageAvatar,children:n.otherUser.avatarUrl?e.jsx("img",{src:n.otherUser.avatarUrl,alt:n.otherUser.displayName,className:r.messageAvatarImage}):e.jsx("div",{className:r.messageAvatarPlaceholder,children:n.otherUser.displayName.charAt(0).toUpperCase()})}),e.jsxs("div",{className:r.messageBubble,children:[e.jsx("p",{className:r.messageText,children:t.content}),e.jsxs("div",{className:r.messageFooter,children:[e.jsx("span",{className:r.messageTime,children:v(t.createdAt)}),d&&e.jsx("button",{className:r.deleteButton,onClick:()=>u(t.id),title:"Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ",children:"Ã—"})]})]})]})]},t.id)}),e.jsx("div",{ref:y})]})}),e.jsxs("form",{className:r.inputForm,onSubmit:j,children:[e.jsx("textarea",{className:r.input,value:h,onChange:t=>o(t.target.value),onKeyDown:A,placeholder:"ÐÐ°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ...",rows:1,disabled:p}),e.jsx("button",{type:"submit",className:r.sendButton,disabled:!h.trim()||p,children:p?"...":"âž¤"})]})]}):e.jsx("div",{className:r.container,children:e.jsxs("div",{className:r.empty,children:[e.jsx("span",{className:r.emptyIcon,children:"ðŸ’¬"}),e.jsx("p",{children:"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð´Ð¸Ð°Ð»Ð¾Ð³ Ð´Ð»Ñ Ð½Ð°Ñ‡Ð°Ð»Ð° Ð¿ÐµÑ€ÐµÐ¿Ð¸ÑÐºÐ¸"})]})})},We="_container_dayzs_1",Xe="_conversationListPanel_dayzs_23",Ze="_messageThreadPanel_dayzs_37",S={container:We,conversationListPanel:Xe,messageThreadPanel:Ze},sa=()=>{const[n,m]=i.useState(null),c=N=>{m(N)};return e.jsx(E,{children:e.jsxs("div",{className:S.container,children:[e.jsx("div",{className:S.conversationListPanel,children:e.jsx(ye,{onSelectConversation:c})}),e.jsx("div",{className:S.messageThreadPanel,children:e.jsx(Ge,{conversation:n})})]})})};export{sa as default};
//# sourceMappingURL=MessagesPage-DCA3CKNT.js.map
