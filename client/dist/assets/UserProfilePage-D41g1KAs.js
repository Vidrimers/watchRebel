import{c as H,r as l,e as L,j as e,a as Z,b as ee,f as ue,g as me,h as J,i as _e,k as fe}from"./index-DXbm8Z41.js";import{U as he,a as pe}from"./UserPageLayout-CNTrVJH0.js";import{u as te}from"./useAlert-CCa2TZV8.js";import{u as se}from"./useConfirm-BpgiKNEP.js";const xe="_referralStats_1q298_1",je="_statsHeader_1q298_17",ve="_statsTitle_1q298_31",Ne="_statsCount_1q298_45",ge="_countNumber_1q298_65",be="_countLabel_1q298_77",ye="_toggleButton_1q298_89",we="_referralsList_1q298_125",Ce="_referralsItems_1q298_137",Be="_referralItem_1q298_149",Te="_referralAvatar_1q298_179",Se="_avatarPlaceholder_1q298_209",Pe="_referralInfo_1q298_233",ke="_referralName_1q298_241",Ie="_referralUsername_1q298_255",De="_referralDate_1q298_267",Re="_emptyMessage_1q298_279",$e="_loading_1q298_295",Le="_error_1q298_309",j={referralStats:xe,statsHeader:je,statsTitle:ve,statsCount:Ne,countNumber:ge,countLabel:be,toggleButton:ye,referralsList:we,referralsItems:Ce,referralItem:Be,referralAvatar:Te,avatarPlaceholder:Se,referralInfo:Pe,referralName:ke,referralUsername:Ie,referralDate:De,emptyMessage:Re,loading:$e,error:Le},Ee=({userId:t})=>{const{user:n}=H(r=>r.auth),[_,g]=l.useState(null),[d,b]=l.useState(0),[c,a]=l.useState([]),[u,N]=l.useState(!0),[h,p]=l.useState(!1),[f,w]=l.useState(null),y=(n==null?void 0:n.id)===t;l.useEffect(()=>{y&&x()},[t,y]);const x=async()=>{var r,C,D;try{N(!0),w(null);const P=await L.get(`/users/${t}/referral-code`);g(P.data.referralCode),b(P.data.referralsCount||0),N(!1)}catch(P){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤:",P),((r=P.response)==null?void 0:r.status)===404||((D=(C=P.response)==null?void 0:C.data)==null?void 0:D.code)==="USER_NOT_FOUND"?(g(null),b(0),N(!1)):(w("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É"),N(!1))}},S=async()=>{var r;try{const C=await L.get(`/users/${t}/referrals`);a(C.data)}catch(C){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤:",C),((r=C.response)==null?void 0:r.status)===404?a([]):w("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤")}},E=async()=>{!h&&c.length===0&&await S(),p(!h)};return y?u?e.jsx("div",{className:j.referralStats,children:e.jsx("p",{className:j.loading,children:"–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏..."})}):f?e.jsx("div",{className:j.referralStats,children:e.jsx("p",{className:j.error,children:f})}):e.jsxs("div",{className:j.referralStats,children:[e.jsxs("div",{className:j.statsHeader,children:[e.jsx("h3",{className:j.statsTitle,children:"üë• –ü—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã–µ –¥—Ä—É–∑—å—è"}),e.jsxs("div",{className:j.statsCount,children:[e.jsx("span",{className:j.countNumber,children:d}),e.jsx("span",{className:j.countLabel,children:"–¥—Ä—É–∑–µ–π"})]})]}),d>0&&e.jsx("button",{className:j.toggleButton,onClick:E,children:h?"‚ñº –°–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫":"‚ñ∂ –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫"}),h&&e.jsx("div",{className:j.referralsList,children:c.length===0?e.jsx("p",{className:j.emptyMessage,children:"–ó–∞–≥—Ä—É–∑–∫–∞..."}):e.jsx("ul",{className:j.referralsItems,children:c.map(r=>e.jsxs("li",{className:j.referralItem,children:[e.jsx("div",{className:j.referralAvatar,children:r.avatarUrl?e.jsx("img",{src:r.avatarUrl.startsWith("/uploads/")?`http://localhost:1313${r.avatarUrl}`:r.avatarUrl,alt:r.displayName}):e.jsx("div",{className:j.avatarPlaceholder,children:r.displayName.charAt(0).toUpperCase()})}),e.jsxs("div",{className:j.referralInfo,children:[e.jsx("p",{className:j.referralName,children:r.displayName}),r.telegramUsername&&e.jsxs("p",{className:j.referralUsername,children:["@",r.telegramUsername]}),e.jsxs("p",{className:j.referralDate,children:["–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è: ",new Date(r.referralCreatedAt).toLocaleDateString("ru-RU")]})]})]},r.id))})}),d===0&&e.jsx("p",{className:j.emptyMessage,children:"–í—ã –µ—â–µ –Ω–µ –ø—Ä–∏–≥–ª–∞—Å–∏–ª–∏ –¥—Ä—É–∑–µ–π. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Telegram –±–æ—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏!"})]}):null},Ae="_moderationPanel_7rr7w_1",Ue="_title_7rr7w_17",Me="_actions_7rr7w_29",qe="_button_7rr7w_41",Fe="_banPostsButton_7rr7w_71",He="_permanentBanButton_7rr7w_89",Ge="_unbanButton_7rr7w_107",Oe="_modalOverlay_7rr7w_127",We="_modal_7rr7w_127",Ve="_modalTitle_7rr7w_177",Je="_error_7rr7w_189",Ke="_formGroup_7rr7w_209",Ye="_textarea_7rr7w_231",ze="_input_7rr7w_233",Qe="_durationPresets_7rr7w_281",Xe="_presetButton_7rr7w_295",Ze="_modalActions_7rr7w_339",et="_cancelButton_7rr7w_351",m={moderationPanel:Ae,title:Ue,actions:Me,button:qe,banPostsButton:Fe,permanentBanButton:He,unbanButton:Ge,modalOverlay:Oe,modal:We,modalTitle:Ve,error:Je,formGroup:Ke,textarea:Ye,input:ze,durationPresets:Qe,presetButton:Xe,modalActions:Ze,cancelButton:et};function tt({userId:t,isAdmin:n,onModerationAction:_}){const{alertDialog:g,showAlert:d}=te(),{confirmDialog:b,showConfirm:c}=se(),[a,u]=l.useState(!1),[N,h]=l.useState(null),[p,f]=l.useState(""),[w,y]=l.useState(1440),[x,S]=l.useState(!1),[E,r]=l.useState(null);if(!n)return null;const C=async()=>{var B,k;if(!p.trim()){r("–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –ø—Ä–∏—á–∏–Ω—É –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏");return}if(w<=0){r("–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ 0");return}S(!0),r(null);try{await L.post(`/admin/users/${t}/ban-posts`,{reason:p.trim(),durationMinutes:w}),u(!1),f(""),y(1440),_&&_("post_ban"),await d({title:"–£—Å–ø–µ—à–Ω–æ",message:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∑–∞–ø—Ä–µ—â–µ–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ—Å—Ç—ã",type:"success"})}catch(I){console.error("–û—à–∏–±–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ—Å—Ç–æ–≤:",I),r(((k=(B=I.response)==null?void 0:B.data)==null?void 0:k.error)||"–û—à–∏–±–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ—Å—Ç–æ–≤")}finally{S(!1)}},D=async()=>{var k,I;if(!p.trim()){r("–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –ø—Ä–∏—á–∏–Ω—É –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏");return}if(await c({title:"–ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞",message:"–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –Ω–∞–≤—Å–µ–≥–¥–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?",confirmText:"–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å",cancelText:"–û—Ç–º–µ–Ω–∞",confirmButtonStyle:"danger"})){S(!0),r(null);try{await L.post(`/admin/users/${t}/ban-permanent`,{reason:p.trim()}),u(!1),f(""),_&&_("permanent_ban"),await d({title:"–£—Å–ø–µ—à–Ω–æ",message:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –Ω–∞–≤—Å–µ–≥–¥–∞",type:"success"})}catch(A){console.error("–û—à–∏–±–∫–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:",A),r(((I=(k=A.response)==null?void 0:k.data)==null?void 0:I.error)||"–û—à–∏–±–∫–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏")}finally{S(!1)}}},P=async()=>{var k,I;if(await c({title:"–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",message:"–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?",confirmText:"–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å",cancelText:"–û—Ç–º–µ–Ω–∞",confirmButtonStyle:"success"})){S(!0),r(null);try{await L.post(`/admin/users/${t}/unban`),_&&_("unban"),await d({title:"–£—Å–ø–µ—à–Ω–æ",message:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω",type:"success"})}catch(A){console.error("–û—à–∏–±–∫–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:",A),r(((I=(k=A.response)==null?void 0:k.data)==null?void 0:I.error)||"–û—à–∏–±–∫–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏")}finally{S(!1)}}},q=()=>{h("posts"),u(!0),r(null)},G=()=>{h("permanent"),u(!0),r(null)},F=()=>{u(!1),h(null),f(""),y(1440),r(null)};return e.jsxs(e.Fragment,{children:[g,b,e.jsxs("div",{className:m.moderationPanel,children:[e.jsx("h3",{className:m.title,children:"‚ö†Ô∏è –ú–æ–¥–µ—Ä–∞—Ü–∏—è"}),e.jsxs("div",{className:m.actions,children:[e.jsx("button",{className:`${m.button} ${m.banPostsButton}`,onClick:q,disabled:x,children:"üö´ –ó–∞–ø—Ä–µ—Ç–∏—Ç—å –ø–æ—Å—Ç—ã"}),e.jsx("button",{className:`${m.button} ${m.permanentBanButton}`,onClick:G,disabled:x,children:"‚õî –ó–∞–±–∞–Ω–∏—Ç—å –Ω–∞–≤—Å–µ–≥–¥–∞"}),e.jsx("button",{className:`${m.button} ${m.unbanButton}`,onClick:P,disabled:x,children:"‚úÖ –†–∞–∑–±–∞–Ω–∏—Ç—å"})]}),a&&e.jsx("div",{className:m.modalOverlay,onClick:F,children:e.jsxs("div",{className:m.modal,onClick:B=>B.stopPropagation(),children:[e.jsx("h3",{className:m.modalTitle,children:N==="posts"?"üö´ –ó–∞–ø—Ä–µ—Ç–∏—Ç—å –ø–æ—Å—Ç—ã":"‚õî –ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞"}),E&&e.jsx("div",{className:m.error,children:E}),e.jsxs("div",{className:m.formGroup,children:[e.jsx("label",{htmlFor:"reason",children:"–ü—Ä–∏—á–∏–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:"}),e.jsx("textarea",{id:"reason",className:m.textarea,value:p,onChange:B=>f(B.target.value),placeholder:"–£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏...",rows:4,disabled:x})]}),N==="posts"&&e.jsxs("div",{className:m.formGroup,children:[e.jsx("label",{htmlFor:"duration",children:"–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–∏–Ω—É—Ç—ã):"}),e.jsx("input",{id:"duration",type:"number",className:m.input,value:w,onChange:B=>y(parseInt(B.target.value)||0),min:"1",disabled:x}),e.jsxs("div",{className:m.durationPresets,children:[e.jsx("button",{className:m.presetButton,onClick:()=>y(60),disabled:x,children:"1 —á–∞—Å"}),e.jsx("button",{className:m.presetButton,onClick:()=>y(1440),disabled:x,children:"1 –¥–µ–Ω—å"}),e.jsx("button",{className:m.presetButton,onClick:()=>y(10080),disabled:x,children:"1 –Ω–µ–¥–µ–ª—è"}),e.jsx("button",{className:m.presetButton,onClick:()=>y(43200),disabled:x,children:"1 –º–µ—Å—è—Ü"})]})]}),e.jsxs("div",{className:m.modalActions,children:[e.jsx("button",{className:`${m.button} ${m.cancelButton}`,onClick:F,disabled:x,children:"–û—Ç–º–µ–Ω–∞"}),e.jsx("button",{className:`${m.button} ${N==="posts"?m.banPostsButton:m.permanentBanButton}`,onClick:N==="posts"?C:D,disabled:x,children:x?"–û–±—Ä–∞–±–æ—Ç–∫–∞...":"–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å"})]})]})})]})]})}const st="_reactionPicker_wifv9_3",at="_pickerHeader_wifv9_57",nt="_pickerTitle_wifv9_75",rt="_closeButton_wifv9_87",ot="_emojiGrid_wifv9_133",lt="_emojiButton_wifv9_145",U={reactionPicker:st,pickerHeader:at,pickerTitle:nt,closeButton:rt,emojiGrid:ot,emojiButton:lt},it=({onSelect:t,onClose:n})=>{const _=l.useRef(null),[g,d]=l.useState([]),b=["‚ù§Ô∏è","üëç","üòÇ","üòä","üòÆ","üò¢","üò°","üî•","üëè","üéâ","üíØ","ü§î","üòç","ü§©","üòé","ü•≥","üò±","ü§Ø","üëÄ","üí©","ü§°","ü§Æ","üò§","üôÑ","üòí","üëé","üíÄ","ü§¨","üòà"];l.useEffect(()=>{const a=JSON.parse(localStorage.getItem("emojiUsage")||"{}"),u=[...b].sort((N,h)=>{const p=a[N]||0;return(a[h]||0)-p});d(u)},[]),l.useEffect(()=>{const a=u=>{_.current&&!_.current.contains(u.target)&&n()};return document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[n]),l.useEffect(()=>{const a=u=>{u.key==="Escape"&&n()};return document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}},[n]);const c=a=>{const u=JSON.parse(localStorage.getItem("emojiUsage")||"{}");u[a]=(u[a]||0)+1,localStorage.setItem("emojiUsage",JSON.stringify(u)),t(a)};return e.jsxs("div",{className:U.reactionPicker,ref:_,children:[e.jsxs("div",{className:U.pickerHeader,children:[e.jsx("span",{className:U.pickerTitle,children:"–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∞–∫—Ü–∏—é"}),e.jsx("button",{className:U.closeButton,onClick:n,"aria-label":"–ó–∞–∫—Ä—ã—Ç—å",children:"√ó"})]}),e.jsx("div",{className:U.emojiGrid,children:g.map(a=>e.jsx("button",{className:U.emojiButton,onClick:()=>c(a),title:a,children:a},a))})]})},ct="_tooltip_15kfh_1",dt="_tooltipContent_15kfh_25",ut="_userItem_15kfh_37",mt="_avatar_15kfh_65",_t="_avatarPlaceholder_15kfh_93",ft="_userName_15kfh_117",M={tooltip:ct,tooltipContent:dt,userItem:ut,avatar:mt,avatarPlaceholder:_t,userName:ft},ht=({users:t,position:n,onMouseEnter:_,onMouseLeave:g})=>{const d=Z(),b=(c,a)=>{a.stopPropagation(),d(`/profile/${c}`)};return e.jsx("div",{className:M.tooltip,style:{left:(n==null?void 0:n.x)||0,top:(n==null?void 0:n.y)||0},onMouseEnter:_,onMouseLeave:g,children:e.jsx("div",{className:M.tooltipContent,children:t.map(c=>e.jsxs("div",{className:M.userItem,onClick:a=>b(c.id,a),children:[e.jsx("div",{className:M.avatar,children:c.avatarUrl?e.jsx("img",{src:c.avatarUrl,alt:c.name}):e.jsx("div",{className:M.avatarPlaceholder,children:c.name.charAt(0).toUpperCase()})}),e.jsx("span",{className:M.userName,children:c.name})]},c.id))})})},pt="_wallPost_1dsun_3",xt="_postActions_1dsun_29",jt="_postContent_1dsun_39",vt="_textContent_1dsun_49",Nt="_actionText_1dsun_69",gt="_mediaInfo_1dsun_83",bt="_mediaDetails_1dsun_127",yt="_mediaTitle_1dsun_143",wt="_mediaType_1dsun_159",Ct="_ratingValue_1dsun_171",Bt="_ratingStars_1dsun_185",Tt="_ratingNumber_1dsun_195",St="_reviewText_1dsun_209",Pt="_postFooter_1dsun_245",kt="_postFooterLeft_1dsun_261",It="_postDate_1dsun_273",Dt="_editedLabel_1dsun_283",Rt="_editButton_1dsun_309",$t="_deleteButton_1dsun_311",Lt="_reactionsContainer_1dsun_367",Et="_reactionsList_1dsun_379",At="_reactionBadge_1dsun_391",Ut="_userReaction_1dsun_427",Mt="_addReactionContainer_1dsun_443",qt="_addReactionButton_1dsun_451",Ft="_editMode_1dsun_547",Ht="_editTextarea_1dsun_559",Gt="_editButtons_1dsun_597",Ot="_saveButton_1dsun_607",Wt="_cancelButton_1dsun_609",s={wallPost:pt,postActions:xt,postContent:jt,textContent:vt,actionText:Nt,mediaInfo:gt,mediaDetails:bt,mediaTitle:yt,mediaType:wt,ratingValue:Ct,ratingStars:Bt,ratingNumber:Tt,reviewText:St,postFooter:Pt,postFooterLeft:kt,postDate:It,editedLabel:Dt,editButton:Rt,deleteButton:$t,reactionsContainer:Lt,reactionsList:Et,reactionBadge:At,userReaction:Ut,addReactionContainer:Mt,addReactionButton:qt,editMode:Ft,editTextarea:Ht,editButtons:Gt,saveButton:Ot,cancelButton:Wt},Vt=({post:t,isOwnProfile:n})=>{var Y,z;const _=ee(),g=Z(),d=H(o=>o.auth.user),{confirmDialog:b,showConfirm:c}=se(),{alertDialog:a,showAlert:u}=te(),[N,h]=l.useState(!1),[p,f]=l.useState(!1),[w,y]=l.useState(null),x=l.useRef(null),[S,E]=l.useState(!1),[r,C]=l.useState(t.content||""),[D,P]=l.useState(!1),q=async o=>{try{await _(me({postId:t.id,emoji:o})).unwrap(),h(!1)}catch(i){console.error("–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–µ–∞–∫—Ü–∏–∏:",i)}},G=async o=>{try{await L.delete(`/wall/${t.id}/reactions/${o}`),_(J(t.userId))}catch(i){console.error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ä–µ–∞–∫—Ü–∏–∏:",i)}},F=async o=>{var v;if(!d)return;const i=(v=t.reactions)==null?void 0:v.find(R=>R.userId===d.id&&R.emoji===o.emoji);i?await G(i.id):await q(o.emoji)},B=(o,i)=>{x.current&&clearTimeout(x.current);const v=o.currentTarget.getBoundingClientRect();y({users:i,position:{x:v.left,y:v.bottom+5}})},k=()=>{x.current=setTimeout(()=>{y(null)},300)},I=()=>{x.current&&clearTimeout(x.current)},A=()=>{y(null)};l.useEffect(()=>()=>{x.current&&clearTimeout(x.current)},[]);const ae=async()=>{if(await c({title:"–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?",message:"–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.",confirmText:"–£–¥–∞–ª–∏—Ç—å",cancelText:"–û—Ç–º–µ–Ω–∞",confirmButtonStyle:"danger"})){f(!0);try{await _(ue(t.id)).unwrap()}catch(i){console.error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ—Å—Ç–∞:",i),await u({title:"–û—à–∏–±–∫–∞",message:"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.",type:"error"}),f(!1)}}},ne=()=>{E(!0),C(t.content||"")},re=async()=>{var o,i;if(!r.trim()){await u({title:"–û—à–∏–±–∫–∞",message:"–ö–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º",type:"error"});return}P(!0);try{await L.put(`/wall/${t.id}`,{content:r.trim()}),_(J(t.userId)),E(!1)}catch(v){console.error("–û—à–∏–±–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Å—Ç–∞:",v),await u({title:"–û—à–∏–±–∫–∞",message:((i=(o=v.response)==null?void 0:o.data)==null?void 0:i.error)||"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å—å",type:"error"})}finally{P(!1)}},oe=()=>{E(!1),C(t.content||"")},le=()=>{const o=new Date(t.createdAt),i=new Date,v=60*60*1e3;return i-o<v},ie=o=>{const i=new Date(o),v=new Date,R=v-i,V=Math.floor(R/6e4),Q=Math.floor(R/36e5),X=Math.floor(R/864e5);return V<1?"—Ç–æ–ª—å–∫–æ —á—Ç–æ":V<60?`${V} –º–∏–Ω –Ω–∞–∑–∞–¥`:Q<24?`${Q} —á –Ω–∞–∑–∞–¥`:X<7?`${X} –¥ –Ω–∞–∑–∞–¥`:i.toLocaleDateString("ru-RU",{day:"numeric",month:"short",year:i.getFullYear()!==v.getFullYear()?"numeric":void 0})},O=()=>{t.tmdbId&&t.mediaType&&g(`/media/${t.mediaType}/${t.tmdbId}`)},ce=()=>{switch(t.postType){case"text":return e.jsx("div",{className:s.textContent,children:S?e.jsxs("div",{className:s.editMode,children:[e.jsx("textarea",{className:s.editTextarea,value:r,onChange:o=>C(o.target.value),rows:4,disabled:D}),e.jsxs("div",{className:s.editButtons,children:[e.jsx("button",{className:s.saveButton,onClick:re,disabled:D,children:D?"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...":"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"}),e.jsx("button",{className:s.cancelButton,onClick:oe,disabled:D,children:"–û—Ç–º–µ–Ω–∞"})]})]}):e.jsx("p",{children:t.content})});case"media_added":return e.jsxs("div",{className:s.mediaAddedContent,children:[e.jsxs("p",{className:s.actionText,children:["üìå –î–æ–±–∞–≤–∏–ª",n?"":"–∞"," –≤ —Å–ø–∏—Å–æ–∫"]}),t.tmdbId&&e.jsx("div",{className:s.mediaInfo,onClick:O,children:e.jsxs("div",{className:s.mediaDetails,children:[e.jsxs("h4",{className:s.mediaTitle,children:[t.mediaType==="movie"?"–§–∏–ª—å–º":"–°–µ—Ä–∏–∞–ª"," (ID: ",t.tmdbId,")"]}),e.jsx("span",{className:s.mediaType,children:t.mediaType==="movie"?"üé¨ –§–∏–ª—å–º":"üì∫ –°–µ—Ä–∏–∞–ª"})]})})]});case"rating":return e.jsxs("div",{className:s.ratingContent,children:[e.jsxs("p",{className:s.actionText,children:["‚≠ê –û—Ü–µ–Ω–∏–ª",n?"":"–∞"]}),t.tmdbId&&e.jsx("div",{className:s.mediaInfo,onClick:O,children:e.jsxs("div",{className:s.mediaDetails,children:[e.jsxs("h4",{className:s.mediaTitle,children:[t.mediaType==="movie"?"–§–∏–ª—å–º":"–°–µ—Ä–∏–∞–ª"," (ID: ",t.tmdbId,")"]}),e.jsxs("div",{className:s.ratingValue,children:[e.jsx("span",{className:s.ratingStars,children:"‚òÖ"}),e.jsxs("span",{className:s.ratingNumber,children:[t.rating,"/10"]})]})]})})]});case"review":return e.jsxs("div",{className:s.reviewContent,children:[e.jsxs("p",{className:s.actionText,children:["‚úçÔ∏è –ù–∞–ø–∏—Å–∞–ª",n?"":"–∞"," –æ—Ç–∑—ã–≤"]}),t.tmdbId&&e.jsx("div",{className:s.mediaInfo,onClick:O,children:e.jsx("div",{className:s.mediaDetails,children:e.jsxs("h4",{className:s.mediaTitle,children:[t.mediaType==="movie"?"–§–∏–ª—å–º":"–°–µ—Ä–∏–∞–ª"," (ID: ",t.tmdbId,")"]})})}),t.content&&e.jsx("div",{className:s.reviewText,children:e.jsx("p",{children:t.content})})]});default:return null}},de=((Y=t.reactions)==null?void 0:Y.reduce((o,i)=>{var v,R;return o[i.emoji]||(o[i.emoji]={emoji:i.emoji,count:0,users:[]}),o[i.emoji].count++,o[i.emoji].users.push({id:i.userId,name:((v=i.user)==null?void 0:v.displayName)||"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",avatarUrl:((R=i.user)==null?void 0:R.avatarUrl)||null}),o},{}))||{},K=Object.values(de),W=(z=t.reactions)==null?void 0:z.find(o=>o.userId===(d==null?void 0:d.id));return e.jsxs(e.Fragment,{children:[b,a,e.jsxs("div",{className:s.wallPost,children:[e.jsx("div",{className:s.postContent,children:ce()}),e.jsxs("div",{className:s.postFooter,children:[e.jsxs("div",{className:s.postFooterLeft,children:[e.jsxs("span",{className:s.postDate,children:[ie(t.createdAt),t.editedAt&&e.jsx("span",{className:s.editedLabel,children:" (–∏–∑–º–µ–Ω–µ–Ω–æ)"})]}),n&&d&&t.userId===d.id&&e.jsxs("div",{className:s.postActions,children:[le()&&(t.postType==="text"||t.postType==="review")&&!S&&e.jsx("button",{className:s.editButton,onClick:ne,title:"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å",children:"‚úèÔ∏è"}),e.jsx("button",{className:s.deleteButton,onClick:ae,disabled:p,title:"–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å",children:p?"‚è≥":"üóëÔ∏è"})]})]}),e.jsxs("div",{className:s.reactionsContainer,children:[K.length>0&&e.jsx("div",{className:s.reactionsList,children:K.map(o=>{const i=d&&o.users.some(v=>v.id===d.id);return e.jsxs("span",{className:`${s.reactionBadge} ${i?s.userReaction:""}`,onClick:()=>F(o),onMouseEnter:v=>B(v,o.users),onMouseLeave:k,children:[o.emoji," ",o.count]},o.emoji)})}),d&&e.jsxs("div",{className:s.addReactionContainer,children:[e.jsx("button",{className:s.addReactionButton,onClick:()=>h(!N),title:W?"–ò–∑–º–µ–Ω–∏—Ç—å —Ä–µ–∞–∫—Ü–∏—é":"–î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∞–∫—Ü–∏—é",children:W?W.emoji:"üòä"}),N&&e.jsx(it,{onSelect:q,onClose:()=>h(!1)})]})]}),w&&e.jsx(ht,{users:w.users,position:w.position,onMouseEnter:I,onMouseLeave:A})]})]})]})},Jt="_wall_1v69n_3",Kt="_createPostContainer_1v69n_17",Yt="_createPostForm_1v69n_33",zt="_postInput_1v69n_45",Qt="_submitButton_1v69n_89",Xt="_postsList_1v69n_135",Zt="_loading_1v69n_149",es="_error_1v69n_151",ts="_emptyState_1v69n_177",ss="_emptyHint_1v69n_205",T={wall:Jt,createPostContainer:Kt,createPostForm:Yt,postInput:zt,submitButton:Qt,postsList:Xt,loading:Zt,error:es,emptyState:ts,emptyHint:ss},as=({userId:t,isOwnProfile:n=!1})=>{const _=ee(),{posts:g,loading:d,error:b}=H(f=>f.wall),[c,a]=l.useState(""),[u,N]=l.useState(!1);l.useEffect(()=>{t&&_(J(t))},[_,t]);const h=async f=>{if(f.preventDefault(),!!c.trim()){N(!0);try{await _(_e({postType:"text",content:c.trim()})).unwrap(),a("")}catch(w){console.error("–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞:",w)}finally{N(!1)}}},p=f=>{f.key==="Enter"&&!f.shiftKey&&(f.preventDefault(),h(f))};return d&&g.length===0?e.jsx("div",{className:T.wall,children:e.jsx("div",{className:T.loading,children:"–ó–∞–≥—Ä—É–∑–∫–∞..."})}):b?e.jsx("div",{className:T.wall,children:e.jsxs("div",{className:T.error,children:["–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–µ–Ω—ã: ",b.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"]})}):e.jsxs("div",{className:T.wall,children:[n&&e.jsx("div",{className:T.createPostContainer,children:e.jsxs("form",{onSubmit:h,className:T.createPostForm,children:[e.jsx("textarea",{className:T.postInput,placeholder:"–ß—Ç–æ —É –≤–∞—Å –Ω–æ–≤–æ–≥–æ?",value:c,onChange:f=>a(f.target.value),onKeyDown:p,rows:3,disabled:u}),e.jsx("button",{type:"submit",className:T.submitButton,disabled:!c.trim()||u,children:u?"–ü—É–±–ª–∏–∫–∞—Ü–∏—è...":"–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å"})]})}),e.jsx("div",{className:T.postsList,children:g.length===0?e.jsxs("div",{className:T.emptyState,children:[e.jsx("p",{children:"–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π –Ω–∞ —Å—Ç–µ–Ω–µ"}),n&&e.jsx("p",{className:T.emptyHint,children:"–î–æ–±–∞–≤—å—Ç–µ —Ñ–∏–ª—å–º –≤ —Å–ø–∏—Å–æ–∫ –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å!"})]}):g.map(f=>e.jsx(Vt,{post:f,isOwnProfile:n},f.id))})]})},ns="_profileContainer_27but_1",rs="_profileHeader_27but_9",os="_profileInfo_27but_31",ls="_profileName_27but_39",is="_wallSection_27but_65",cs="_sectionTitle_27but_79",ds="_errorContainer_27but_303",$={profileContainer:ns,profileHeader:rs,profileInfo:os,profileName:ls,wallSection:is,sectionTitle:cs,errorContainer:ds},hs=()=>{const{userId:t}=fe(),{user:n,isAuthenticated:_}=H(h=>h.auth),[g,d]=l.useState(null),[b,c]=l.useState(!0),a=(n==null?void 0:n.id)===t,u=(n==null?void 0:n.isAdmin)||!1;l.useEffect(()=>{_&&t&&(async()=>{try{if(c(!0),a){d(n),c(!1);return}const p=await L.get(`/users/${t}`);d(p.data)}catch(p){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è:",p)}finally{c(!1)}})()},[t,_,a,n]);const N=async h=>{console.log("–î–µ–π—Å—Ç–≤–∏–µ –º–æ–¥–µ—Ä–∞—Ü–∏–∏:",h);try{const p=await L.get(`/users/${t}`);d(p.data)}catch(p){console.error("–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è:",p)}};return _?b?e.jsx("div",{className:$.errorContainer,children:e.jsx("p",{children:"–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è..."})}):g?e.jsx(he,{user:n,children:e.jsxs("div",{className:$.profileContainer,children:[!a&&e.jsxs("div",{className:$.profileHeader,children:[e.jsx(pe,{user:g,size:"large",showBanIndicator:!0}),e.jsx("div",{className:$.profileInfo,children:e.jsx("h1",{className:$.profileName,children:g.displayName})})]}),u&&!a&&e.jsx(tt,{userId:t,isAdmin:u,onModerationAction:N}),a&&e.jsx(Ee,{userId:t}),e.jsxs("div",{className:$.wallSection,children:[e.jsx("h2",{className:$.sectionTitle,children:"–õ–µ–Ω—Ç–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏"}),e.jsx(as,{userId:t,isOwnProfile:a})]})]})}):e.jsx("div",{className:$.errorContainer,children:e.jsx("p",{children:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω"})}):e.jsx("div",{className:$.errorContainer,children:e.jsx("p",{children:"–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è"})})};export{hs as default};
//# sourceMappingURL=UserProfilePage-D41g1KAs.js.map
