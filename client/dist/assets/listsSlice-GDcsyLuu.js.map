{"version":3,"file":"listsSlice-GDcsyLuu.js","sources":["../../src/store/slices/listsSlice.js"],"sourcesContent":["import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\r\nimport api, { APIError, NetworkError } from '../../services/api';\r\n\r\n// Вспомогательная функция для обработки ошибок\r\nconst handleError = (error, rejectWithValue) => {\r\n  if (error instanceof APIError) {\r\n    return rejectWithValue(error.data || error.message);\r\n  } else if (error instanceof NetworkError) {\r\n    return rejectWithValue({ message: error.message });\r\n  }\r\n  return rejectWithValue({ message: 'Неизвестная ошибка' });\r\n};\r\n\r\nexport const fetchLists = createAsyncThunk(\r\n  'lists/fetchLists',\r\n  async (_, { rejectWithValue }) => {\r\n    try {\r\n      const response = await api.get('/lists');\r\n      return response.data;\r\n    } catch (error) {\r\n      return handleError(error, rejectWithValue);\r\n    }\r\n  }\r\n);\r\n\r\nexport const createList = createAsyncThunk(\r\n  'lists/createList',\r\n  async ({ name, mediaType }, { rejectWithValue }) => {\r\n    try {\r\n      const response = await api.post('/lists', { name, mediaType });\r\n      return response.data;\r\n    } catch (error) {\r\n      return handleError(error, rejectWithValue);\r\n    }\r\n  }\r\n);\r\n\r\nexport const deleteList = createAsyncThunk(\r\n  'lists/deleteList',\r\n  async (listId, { rejectWithValue }) => {\r\n    try {\r\n      await api.delete(`/lists/${listId}`);\r\n      return listId;\r\n    } catch (error) {\r\n      return handleError(error, rejectWithValue);\r\n    }\r\n  }\r\n);\r\n\r\nexport const addToList = createAsyncThunk(\r\n  'lists/addToList',\r\n  async ({ listId, media }, { rejectWithValue }) => {\r\n    try {\r\n      const response = await api.post(`/lists/${listId}/items`, media);\r\n      return { listId, item: response.data };\r\n    } catch (error) {\r\n      return handleError(error, rejectWithValue);\r\n    }\r\n  }\r\n);\r\n\r\nexport const fetchWatchlist = createAsyncThunk(\r\n  'lists/fetchWatchlist',\r\n  async (_, { rejectWithValue }) => {\r\n    try {\r\n      const response = await api.get('/watchlist');\r\n      return response.data;\r\n    } catch (error) {\r\n      return handleError(error, rejectWithValue);\r\n    }\r\n  }\r\n);\r\n\r\nexport const addToWatchlist = createAsyncThunk(\r\n  'lists/addToWatchlist',\r\n  async (media, { rejectWithValue }) => {\r\n    try {\r\n      const response = await api.post('/watchlist', media);\r\n      return response.data;\r\n    } catch (error) {\r\n      return handleError(error, rejectWithValue);\r\n    }\r\n  }\r\n);\r\n\r\nexport const removeFromWatchlist = createAsyncThunk(\r\n  'lists/removeFromWatchlist',\r\n  async (itemId, { rejectWithValue }) => {\r\n    try {\r\n      await api.delete(`/watchlist/${itemId}`);\r\n      return itemId;\r\n    } catch (error) {\r\n      return handleError(error, rejectWithValue);\r\n    }\r\n  }\r\n);\r\n\r\nexport const removeFromList = createAsyncThunk(\r\n  'lists/removeFromList',\r\n  async ({ listId, itemId }, { rejectWithValue }) => {\r\n    try {\r\n      await api.delete(`/lists/${listId}/items/${itemId}`);\r\n      return { listId, itemId };\r\n    } catch (error) {\r\n      return handleError(error, rejectWithValue);\r\n    }\r\n  }\r\n);\r\n\r\n// Получить прогресс просмотра сериала\r\nexport const fetchEpisodeProgress = createAsyncThunk(\r\n  'lists/fetchEpisodeProgress',\r\n  async (seriesId, { rejectWithValue }) => {\r\n    try {\r\n      const response = await api.get(`/progress/${seriesId}`);\r\n      return { seriesId, progress: response.data };\r\n    } catch (error) {\r\n      return handleError(error, rejectWithValue);\r\n    }\r\n  }\r\n);\r\n\r\n// Отметить серию как просмотренную\r\nexport const markEpisodeWatched = createAsyncThunk(\r\n  'lists/markEpisodeWatched',\r\n  async ({ tmdbId, seasonNumber, episodeNumber }, { rejectWithValue }) => {\r\n    try {\r\n      const response = await api.post('/progress', {\r\n        tmdbId,\r\n        seasonNumber,\r\n        episodeNumber\r\n      });\r\n      return response.data;\r\n    } catch (error) {\r\n      return handleError(error, rejectWithValue);\r\n    }\r\n  }\r\n);\r\n\r\n// Поставить рейтинг\r\nexport const addRating = createAsyncThunk(\r\n  'lists/addRating',\r\n  async ({ tmdbId, mediaType, rating }, { rejectWithValue }) => {\r\n    try {\r\n      const response = await api.post('/ratings', {\r\n        tmdbId,\r\n        mediaType,\r\n        rating\r\n      });\r\n      return response.data;\r\n    } catch (error) {\r\n      return handleError(error, rejectWithValue);\r\n    }\r\n  }\r\n);\r\n\r\nconst listsSlice = createSlice({\r\n  name: 'lists',\r\n  initialState: {\r\n    customLists: [],\r\n    watchlist: [],\r\n    episodeProgress: {}, // { seriesId: [progress items] }\r\n    ratings: {}, // { tmdbId: rating }\r\n    loading: false,\r\n    error: null\r\n  },\r\n  reducers: {},\r\n  extraReducers: (builder) => {\r\n    builder\r\n      .addCase(fetchLists.fulfilled, (state, action) => {\r\n        state.customLists = action.payload;\r\n      })\r\n      .addCase(createList.fulfilled, (state, action) => {\r\n        state.customLists.push(action.payload);\r\n      })\r\n      .addCase(deleteList.fulfilled, (state, action) => {\r\n        state.customLists = state.customLists.filter(list => list.id !== action.payload);\r\n      })\r\n      .addCase(addToList.fulfilled, (state, action) => {\r\n        const list = state.customLists.find(l => l.id === action.payload.listId);\r\n        if (list) {\r\n          list.items.push(action.payload.item);\r\n        }\r\n      })\r\n      .addCase(fetchWatchlist.fulfilled, (state, action) => {\r\n        state.watchlist = action.payload;\r\n      })\r\n      .addCase(addToWatchlist.fulfilled, (state, action) => {\r\n        state.watchlist.push(action.payload);\r\n      })\r\n      .addCase(removeFromWatchlist.fulfilled, (state, action) => {\r\n        state.watchlist = state.watchlist.filter(item => item.id !== action.payload);\r\n      })\r\n      .addCase(removeFromList.fulfilled, (state, action) => {\r\n        const list = state.customLists.find(l => l.id === action.payload.listId);\r\n        if (list) {\r\n          list.items = list.items.filter(item => item.id !== action.payload.itemId);\r\n        }\r\n      })\r\n      .addCase(fetchEpisodeProgress.fulfilled, (state, action) => {\r\n        state.episodeProgress[action.payload.seriesId] = action.payload.progress;\r\n      })\r\n      .addCase(markEpisodeWatched.fulfilled, (state, action) => {\r\n        const seriesId = action.payload.tmdbId;\r\n        if (!state.episodeProgress[seriesId]) {\r\n          state.episodeProgress[seriesId] = [];\r\n        }\r\n        state.episodeProgress[seriesId].push(action.payload);\r\n      })\r\n      .addCase(addRating.fulfilled, (state, action) => {\r\n        state.ratings[action.payload.tmdbId] = action.payload.rating;\r\n      });\r\n  }\r\n});\r\n\r\nexport default listsSlice.reducer;\r\n"],"names":["handleError","error","rejectWithValue","APIError","NetworkError","fetchLists","createAsyncThunk","_","api","createList","name","mediaType","deleteList","listId","addToList","media","response","fetchWatchlist","addToWatchlist","removeFromWatchlist","itemId","removeFromList","fetchEpisodeProgress","seriesId","markEpisodeWatched","tmdbId","seasonNumber","episodeNumber","addRating","rating","createSlice","builder","state","action","list","l","item"],"mappings":"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"}