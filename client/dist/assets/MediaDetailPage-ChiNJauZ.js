import{r as f,j as e,l as A,m as P,k as E,a as W,b as D,c as w,n as F,o as R,p as H,q as M,t as U,v as Y}from"./index-BDVNw2dN.js";import{u as z}from"./useAlert-9x7LhsL9.js";const G="_episodeTracker_4uxqa_1",J="_title_4uxqa_15",K="_emptyState_4uxqa_29",O="_seasonsList_4uxqa_41",Q="_seasonItem_4uxqa_53",V="_seasonHeader_4uxqa_75",X="_seasonInfo_4uxqa_103",Z="_seasonTitle_4uxqa_111",ee="_seasonProgress_4uxqa_125",se="_seasonActions_4uxqa_135",te="_markAllButton_4uxqa_147",ae="_expandIcon_4uxqa_189",ne="_progressBar_4uxqa_201",oe="_progressFill_4uxqa_213",ie="_episodesList_4uxqa_225",ce="_episodeButton_4uxqa_241",re="_watched_4uxqa_285",le="_episodeNumber_4uxqa_307",de="_checkmark_4uxqa_315",pe="_lastWatched_4uxqa_329",o={episodeTracker:G,title:J,emptyState:K,seasonsList:O,seasonItem:Q,seasonHeader:V,seasonInfo:X,seasonTitle:Z,seasonProgress:ee,seasonActions:se,markAllButton:te,expandIcon:ae,progressBar:ne,progressFill:oe,episodesList:ie,episodeButton:ce,watched:re,episodeNumber:le,checkmark:de,lastWatched:pe},_e=({seriesId:c,seasons:d=[],currentProgress:u=[],onMarkWatched:r})=>{const[N,_]=f.useState(null),s=(t,n)=>u.some(p=>p.seasonNumber===t&&p.episodeNumber===n),j=t=>{const n=u.filter(p=>p.seasonNumber===t).sort((p,g)=>g.episodeNumber-p.episodeNumber);return n.length>0?n[0].episodeNumber:0},b=t=>u.filter(n=>n.seasonNumber===t).length,h=t=>{_(N===t?null:t)},l=(t,n)=>{r&&r(t,n)},y=t=>{if(r)for(let n=1;n<=t.episodeCount;n++)s(t.seasonNumber,n)||r(t.seasonNumber,n)};return!d||d.length===0?e.jsx("div",{className:o.emptyState,children:e.jsx("p",{children:"Информация о сезонах недоступна"})}):e.jsxs("div",{className:o.episodeTracker,children:[e.jsx("h3",{className:o.title,children:"Прогресс просмотра"}),e.jsx("div",{className:o.seasonsList,children:d.map(t=>{const n=b(t.seasonNumber),p=N===t.seasonNumber,g=j(t.seasonNumber),k=n/t.episodeCount*100;return e.jsxs("div",{className:o.seasonItem,children:[e.jsxs("div",{className:o.seasonHeader,onClick:()=>h(t.seasonNumber),children:[e.jsxs("div",{className:o.seasonInfo,children:[e.jsx("h4",{className:o.seasonTitle,children:t.name||`Сезон ${t.seasonNumber}`}),e.jsxs("span",{className:o.seasonProgress,children:[n," / ",t.episodeCount," серий"]})]}),e.jsxs("div",{className:o.seasonActions,children:[n<t.episodeCount&&e.jsx("button",{className:o.markAllButton,onClick:m=>{m.stopPropagation(),y(t)},title:"Отметить все серии",children:"✓ Все"}),e.jsx("span",{className:o.expandIcon,children:p?"▼":"▶"})]})]}),e.jsx("div",{className:o.progressBar,children:e.jsx("div",{className:o.progressFill,style:{width:`${k}%`}})}),p&&e.jsx("div",{className:o.episodesList,children:Array.from({length:t.episodeCount},(m,v)=>v+1).map(m=>{const v=s(t.seasonNumber,m);return e.jsxs("button",{className:`${o.episodeButton} ${v?o.watched:""}`,onClick:()=>l(t.seasonNumber,m),title:`Серия ${m}`,children:[e.jsx("span",{className:o.episodeNumber,children:m}),v&&e.jsx("span",{className:o.checkmark,children:"✓"})]},m)})}),!p&&g>0&&e.jsxs("div",{className:o.lastWatched,children:["Последняя: серия ",g]})]},t.seasonNumber)})})]})},me="_ratingSelector_1mwfu_3",ue="_ratingLabel_1mwfu_25",he="_ratingButtons_1mwfu_41",ge="_ratingButton_1mwfu_41",xe="_active_1mwfu_103",Ne="_selected_1mwfu_117",je="_loadingIndicator_1mwfu_143",x={ratingSelector:me,ratingLabel:ue,ratingButtons:he,ratingButton:ge,active:xe,selected:Ne,loadingIndicator:je},ve=({media:c,currentRating:d=null,onRatingSet:u})=>{const r=A(),[N,_]=f.useState(null),[s,j]=f.useState(!1),b=async l=>{if(!s){j(!0);try{await r(P({tmdbId:c.tmdbId,mediaType:c.mediaType,rating:l})).unwrap(),u&&u(l)}catch(y){console.error("Ошибка при сохранении рейтинга:",y)}finally{j(!1)}}},h=N||d;return e.jsxs("div",{className:x.ratingSelector,children:[e.jsxs("div",{className:x.ratingLabel,children:["Ваша оценка: ",h?`${h}/10`:"не оценено"]}),e.jsx("div",{className:x.ratingButtons,children:[1,2,3,4,5,6,7,8,9,10].map(l=>e.jsx("button",{className:`${x.ratingButton} ${h&&l<=h?x.active:""} ${d===l?x.selected:""}`,onClick:()=>b(l),onMouseEnter:()=>_(l),onMouseLeave:()=>_(null),disabled:s,title:`Оценить на ${l}`,children:l},l))}),s&&e.jsx("div",{className:x.loadingIndicator,children:"Сохранение..."})]})},fe="_mediaDetailPage_1p50o_1",be="_backdrop_1p50o_13",ye="_content_1p50o_57",ke="_backButton_1p50o_73",we="_mainInfo_1p50o_109",Se="_posterSection_1p50o_123",Ie="_poster_1p50o_123",Be="_infoSection_1p50o_147",Le="_title_1p50o_161",Te="_originalTitle_1p50o_177",qe="_meta_1p50o_191",Ce="_type_1p50o_209",$e="_separator_1p50o_219",Ae="_rating_1p50o_227",Pe="_overview_1p50o_237",Ee="_actions_1p50o_251",We="_actionButton_1p50o_265",De="_selector_1p50o_327",Fe="_select_1p50o_327",Re="_confirmButton_1p50o_367",He="_episodeSection_1p50o_477",Me="_loading_1p50o_485",a={mediaDetailPage:fe,backdrop:be,content:ye,backButton:ke,mainInfo:we,posterSection:Se,poster:Ie,infoSection:Be,title:Le,originalTitle:Te,meta:qe,type:Ce,separator:$e,rating:Ae,overview:Pe,actions:Ee,actionButton:We,selector:De,select:Fe,confirmButton:Re,episodeSection:He,loading:Me},ze=()=>{const{mediaType:c,mediaId:d}=E(),u=W(),r=D(),{alertDialog:N,showAlert:_}=z(),{selectedMedia:s,loading:j}=w(i=>i.media),{customLists:b,episodeProgress:h,ratings:l}=w(i=>i.lists),{user:y}=w(i=>i.auth),[t,n]=f.useState(""),[p,g]=f.useState(!1);f.useEffect(()=>{c&&d&&(r(F({type:c,id:d})),r(R()),c==="tv"&&r(H(d)))},[r,c,d]);const k=async()=>{if(!(!t||!s))try{await r(U({listId:t,media:{tmdbId:s.id,mediaType:s.media_type||c}})).unwrap(),g(!1),n(""),await _({title:"Успешно!",message:"Контент добавлен в список",type:"success"})}catch{await _({title:"Ошибка",message:"Не удалось добавить в список",type:"error"})}},m=async()=>{if(s)try{await r(M({tmdbId:s.id,mediaType:s.media_type||c})).unwrap(),await _({title:"Успешно!",message:"Добавлено в список желаемого",type:"success"})}catch{await _({title:"Ошибка",message:"Не удалось добавить в список желаемого",type:"error"})}},v=async(i,C)=>{if(s)try{await r(Y({tmdbId:s.id,seasonNumber:i,episodeNumber:C})).unwrap()}catch($){console.error("Ошибка при отметке серии:",$)}};if(j||!s)return e.jsx("div",{className:a.loading,children:e.jsx("p",{children:"Загрузка..."})});const S=s.backdrop_path?`https://image.tmdb.org/t/p/original${s.backdrop_path}`:null,B=s.poster_path?`https://image.tmdb.org/t/p/w500${s.poster_path}`:"/default-poster.png",I=s.release_date||s.first_air_date?new Date(s.release_date||s.first_air_date).getFullYear():null,L=b.filter(i=>i.mediaType===(s.media_type||c)),T=h[d]||[],q=l[d]||null;return e.jsxs(e.Fragment,{children:[N,e.jsxs("div",{className:a.mediaDetailPage,children:[S&&e.jsx("div",{className:a.backdrop,style:{backgroundImage:`url(${S})`}}),e.jsxs("div",{className:a.content,children:[e.jsx("button",{className:a.backButton,onClick:()=>u(-1),children:"← Назад"}),e.jsxs("div",{className:a.mainInfo,children:[e.jsx("div",{className:a.posterSection,children:e.jsx("img",{src:B,alt:s.title||s.name,className:a.poster})}),e.jsxs("div",{className:a.infoSection,children:[e.jsx("h1",{className:a.title,children:s.title||s.name}),s.original_title&&s.original_title!==s.title&&e.jsx("p",{className:a.originalTitle,children:s.original_title||s.original_name}),e.jsxs("div",{className:a.meta,children:[e.jsx("span",{className:a.type,children:(s.media_type||c)==="movie"?"Фильм":"Сериал"}),I&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:a.separator,children:"•"}),e.jsx("span",{children:I})]}),s.vote_average>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:a.separator,children:"•"}),e.jsxs("span",{className:a.rating,children:["★ ",s.vote_average.toFixed(1)]})]})]}),s.overview&&e.jsx("p",{className:a.overview,children:s.overview}),e.jsxs("div",{className:a.actions,children:[e.jsx("button",{className:a.actionButton,onClick:()=>g(!p),children:"+ Добавить в список"}),e.jsx("button",{className:a.actionButton,onClick:m,children:"+ В список желаемого"})]}),p&&e.jsxs("div",{className:a.selector,children:[e.jsxs("select",{value:t,onChange:i=>n(i.target.value),className:a.select,children:[e.jsx("option",{value:"",children:"Выберите список"}),L.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]}),e.jsx("button",{className:a.confirmButton,onClick:k,disabled:!t,children:"Добавить"})]}),e.jsx(ve,{media:{tmdbId:s.id,mediaType:s.media_type||c,title:s.title||s.name},currentRating:q,onRatingSet:async i=>{await _({title:"Оценка сохранена!",message:`Оценка ${i}/10 добавлена на стену`,type:"success"})}})]})]}),(s.media_type||c)==="tv"&&s.seasons&&e.jsx("div",{className:a.episodeSection,children:e.jsx(_e,{seriesId:s.id,seasons:s.seasons,currentProgress:T,onMarkWatched:v})})]})]})]})};export{ze as default};
//# sourceMappingURL=MediaDetailPage-ChiNJauZ.js.map
