import{b as P,c as b,r as o,G as B,e as L,j as e,H as F,I as T,R,J as $,K as k}from"./index-BDVNw2dN.js";import{U as E}from"./UserPageLayout--cGvvqMr.js";const H="_container_sf9tt_1",K="_header_sf9tt_17",z="_title_sf9tt_33",O="_newMessageButton_sf9tt_47",Q="_loading_sf9tt_95",Y="_empty_sf9tt_97",q="_emptyIcon_sf9tt_117",G="_emptyHint_sf9tt_127",J="_list_sf9tt_139",V="_item_sf9tt_155",W="_active_sf9tt_181",X="_avatar_sf9tt_191",Z="_avatarImage_sf9tt_201",ee="_avatarPlaceholder_sf9tt_215",se="_content_sf9tt_241",ae="_topRow_sf9tt_251",te="_name_sf9tt_265",re="_time_sf9tt_281",ne="_bottomRow_sf9tt_295",le="_lastMessage_sf9tt_307",de="_unreadBadge_sf9tt_327",ce="_modal_sf9tt_355",oe="_modalContent_sf9tt_383",ie="_modalHeader_sf9tt_405",me="_closeButton_sf9tt_435",he="_searchInput_sf9tt_477",_e="_friendsList_sf9tt_509",ge="_friendItem_sf9tt_521",ue="_friendAvatar_sf9tt_549",pe="_friendAvatarImage_sf9tt_559",fe="_friendAvatarPlaceholder_sf9tt_573",ve="_friendName_sf9tt_599",Ne="_modalLoading_sf9tt_611",xe="_modalEmpty_sf9tt_613",a={container:H,header:K,title:z,newMessageButton:O,loading:Q,empty:Y,emptyIcon:q,emptyHint:G,list:J,item:V,active:W,avatar:X,avatarImage:Z,avatarPlaceholder:ee,content:se,topRow:ae,name:te,time:re,bottomRow:ne,lastMessage:le,unreadBadge:de,modal:ce,modalContent:oe,modalHeader:ie,closeButton:me,searchInput:he,friendsList:_e,friendItem:ge,friendAvatar:ue,friendAvatarImage:pe,friendAvatarPlaceholder:fe,friendName:ve,modalLoading:Ne,modalEmpty:xe},je=({onSelectConversation:n})=>{const i=P(),{conversations:c,loading:f,currentConversation:p}=b(s=>s.messages),{user:v}=b(s=>s.auth),[h,m]=o.useState(!1),[j,w]=o.useState([]),[N,y]=o.useState(!1),[g,x]=o.useState("");o.useEffect(()=>{i(B())},[i]),o.useEffect(()=>{h&&v&&U()},[h,v]);const U=async()=>{try{y(!0);const s=await L.get(`/users/${v.id}/friends`);w(s.data)}catch(s){console.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð´Ñ€ÑƒÐ·ÐµÐ¹:",s)}finally{y(!1)}},A=s=>{i(F(s.id)),n&&n(s)},t=s=>{const u={id:null,otherUser:{id:s.id,displayName:s.displayName,avatarUrl:s.avatarUrl},lastMessage:null,unreadCount:0,lastMessageAt:new Date().toISOString(),createdAt:new Date().toISOString()};m(!1),x(""),A(u)},l=j.filter(s=>s.displayName.toLowerCase().includes(g.toLowerCase())),d=s=>{const u=new Date(s),C=new Date-u,M=Math.floor(C/6e4),S=Math.floor(C/36e5),D=Math.floor(C/864e5);return M<1?"Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ‡Ñ‚Ð¾":M<60?`${M} Ð¼Ð¸Ð½`:S<24?`${S} Ñ‡`:D<7?`${D} Ð´Ð½`:u.toLocaleDateString("ru-RU",{day:"numeric",month:"short"})},_=(s,u=50)=>s?s.length<=u?s:s.substring(0,u)+"...":"";return f&&c.length===0?e.jsx("div",{className:a.container,children:e.jsx("div",{className:a.loading,children:"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ð¸Ð°Ð»Ð¾Ð³Ð¾Ð²..."})}):c.length===0?e.jsxs("div",{className:a.container,children:[e.jsxs("div",{className:a.header,children:[e.jsx("h2",{className:a.title,children:"Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ"}),e.jsx("button",{className:a.newMessageButton,onClick:()=>m(!0),title:"ÐÐ°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ Ð½Ð¾Ð²Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ",children:"âœï¸ ÐÐ°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ"})]}),e.jsxs("div",{className:a.empty,children:[e.jsx("span",{className:a.emptyIcon,children:"ðŸ’¬"}),e.jsx("p",{children:"ÐŸÐ¾ÐºÐ° Ð½ÐµÑ‚ Ð´Ð¸Ð°Ð»Ð¾Ð³Ð¾Ð²"}),e.jsx("p",{className:a.emptyHint,children:'ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ "ÐÐ°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ", Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ Ð¿ÐµÑ€ÐµÐ¿Ð¸ÑÐºÑƒ'})]}),h&&e.jsx("div",{className:a.modal,onClick:()=>m(!1),children:e.jsxs("div",{className:a.modalContent,onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:a.modalHeader,children:[e.jsx("h3",{children:"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¿Ð¾Ð»ÑƒÑ‡Ð°Ñ‚ÐµÐ»Ñ"}),e.jsx("button",{className:a.closeButton,onClick:()=>m(!1),children:"Ã—"})]}),e.jsx("input",{type:"text",className:a.searchInput,placeholder:"ÐŸÐ¾Ð¸ÑÐº Ð´Ñ€ÑƒÐ·ÐµÐ¹...",value:g,onChange:s=>x(s.target.value),autoFocus:!0}),e.jsx("div",{className:a.friendsList,children:N?e.jsx("div",{className:a.modalLoading,children:"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ñ€ÑƒÐ·ÐµÐ¹..."}):l.length===0?e.jsx("div",{className:a.modalEmpty,children:g?"Ð”Ñ€ÑƒÐ·ÑŒÑ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹":"Ð£ Ð²Ð°Ñ Ð¿Ð¾ÐºÐ° Ð½ÐµÑ‚ Ð´Ñ€ÑƒÐ·ÐµÐ¹"}):l.map(s=>e.jsxs("div",{className:a.friendItem,onClick:()=>t(s),children:[e.jsx("div",{className:a.friendAvatar,children:s.avatarUrl?e.jsx("img",{src:s.avatarUrl,alt:s.displayName,className:a.friendAvatarImage}):e.jsx("div",{className:a.friendAvatarPlaceholder,children:s.displayName.charAt(0).toUpperCase()})}),e.jsx("span",{className:a.friendName,children:s.displayName})]},s.id))})]})})]}):e.jsxs("div",{className:a.container,children:[e.jsxs("div",{className:a.header,children:[e.jsx("h2",{className:a.title,children:"Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ"}),e.jsx("button",{className:a.newMessageButton,onClick:()=>m(!0),title:"ÐÐ°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ Ð½Ð¾Ð²Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ",children:"âœï¸ ÐÐ°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ"})]}),e.jsx("ul",{className:a.list,children:c.map(s=>e.jsxs("li",{className:`${a.item} ${p===s.id?a.active:""}`,onClick:()=>A(s),children:[e.jsx("div",{className:a.avatar,children:s.otherUser.avatarUrl?e.jsx("img",{src:s.otherUser.avatarUrl,alt:s.otherUser.displayName,className:a.avatarImage}):e.jsx("div",{className:a.avatarPlaceholder,children:s.otherUser.displayName.charAt(0).toUpperCase()})}),e.jsxs("div",{className:a.content,children:[e.jsxs("div",{className:a.topRow,children:[e.jsx("span",{className:a.name,children:s.otherUser.displayName}),e.jsx("span",{className:a.time,children:d(s.lastMessageAt)})]}),e.jsxs("div",{className:a.bottomRow,children:[e.jsx("p",{className:a.lastMessage,children:_(s.lastMessage)}),s.unreadCount>0&&e.jsx("div",{className:a.unreadBadge,children:s.unreadCount})]})]})]},s.id))}),h&&e.jsx("div",{className:a.modal,onClick:()=>m(!1),children:e.jsxs("div",{className:a.modalContent,onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:a.modalHeader,children:[e.jsx("h3",{children:"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¿Ð¾Ð»ÑƒÑ‡Ð°Ñ‚ÐµÐ»Ñ"}),e.jsx("button",{className:a.closeButton,onClick:()=>m(!1),children:"Ã—"})]}),e.jsx("input",{type:"text",className:a.searchInput,placeholder:"ÐŸÐ¾Ð¸ÑÐº Ð´Ñ€ÑƒÐ·ÐµÐ¹...",value:g,onChange:s=>x(s.target.value),autoFocus:!0}),e.jsx("div",{className:a.friendsList,children:N?e.jsx("div",{className:a.modalLoading,children:"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð´Ñ€ÑƒÐ·ÐµÐ¹..."}):l.length===0?e.jsx("div",{className:a.modalEmpty,children:g?"Ð”Ñ€ÑƒÐ·ÑŒÑ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ñ‹":"Ð£ Ð²Ð°Ñ Ð¿Ð¾ÐºÐ° Ð½ÐµÑ‚ Ð´Ñ€ÑƒÐ·ÐµÐ¹"}):l.map(s=>e.jsxs("div",{className:a.friendItem,onClick:()=>t(s),children:[e.jsx("div",{className:a.friendAvatar,children:s.avatarUrl?e.jsx("img",{src:s.avatarUrl,alt:s.displayName,className:a.friendAvatarImage}):e.jsx("div",{className:a.friendAvatarPlaceholder,children:s.displayName.charAt(0).toUpperCase()})}),e.jsx("span",{className:a.friendName,children:s.displayName})]},s.id))})]})})]})},ye="_container_d56hb_1",Ae="_header_d56hb_15",be="_headerAvatar_d56hb_31",we="_headerAvatarImage_d56hb_39",Ue="_headerAvatarPlaceholder_d56hb_53",Ce="_headerName_d56hb_79",Me="_loading_d56hb_93",Ie="_empty_d56hb_95",Se="_emptyMessages_d56hb_97",De="_emptyIcon_d56hb_119",Pe="_messagesContainer_d56hb_129",Be="_messagesList_d56hb_143",Le="_dateSeparator_d56hb_155",Fe="_message_d56hb_129",Te="_ownMessage_d56hb_221",Re="_otherMessage_d56hb_231",$e="_messageAvatar_d56hb_239",ke="_messageAvatarImage_d56hb_247",Ee="_messageAvatarPlaceholder_d56hb_261",He="_messageBubble_d56hb_287",Ke="_messageText_d56hb_311",ze="_messageFooter_d56hb_327",Oe="_messageTime_d56hb_343",Qe="_deleteButton_d56hb_353",Ye="_inputForm_d56hb_385",qe="_input_d56hb_385",Ge="_sendButton_d56hb_451",r={container:ye,header:Ae,headerAvatar:be,headerAvatarImage:we,headerAvatarPlaceholder:Ue,headerName:Ce,loading:Me,empty:Ie,emptyMessages:Se,emptyIcon:De,messagesContainer:Pe,messagesList:Be,dateSeparator:Le,message:Fe,ownMessage:Te,otherMessage:Re,messageAvatar:$e,messageAvatarImage:ke,messageAvatarPlaceholder:Ee,messageBubble:He,messageText:Ke,messageFooter:ze,messageTime:Oe,deleteButton:Qe,inputForm:Ye,input:qe,sendButton:Ge},Je=({conversation:n})=>{const i=P(),{messages:c,loading:f,sendingMessage:p}=b(t=>t.messages),{user:v}=b(t=>t.auth),[h,m]=o.useState(""),j=o.useRef(null);o.useEffect(()=>{n&&n.id&&i(T(n.id))},[n,i]),o.useEffect(()=>{w()},[c]);const w=()=>{var t;(t=j.current)==null||t.scrollIntoView({behavior:"smooth"})},N=async t=>{if(t.preventDefault(),!h.trim()||p)return;const l=h.trim();m("");const d=await i(k({receiverId:n.otherUser.id,content:l}));n.id===null&&d.meta.requestStatus},y=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),N(t))},g=t=>{window.confirm("Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÑ‚Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ?")&&i($(t))},x=t=>new Date(t).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}),U=t=>{const l=new Date(t),d=new Date,_=new Date(d);return _.setDate(_.getDate()-1),l.toDateString()===d.toDateString()?"Ð¡ÐµÐ³Ð¾Ð´Ð½Ñ":l.toDateString()===_.toDateString()?"Ð’Ñ‡ÐµÑ€Ð°":l.toLocaleDateString("ru-RU",{day:"numeric",month:"long",year:l.getFullYear()!==d.getFullYear()?"numeric":void 0})},A=(t,l)=>{if(!l)return!0;const d=new Date(t.createdAt).toDateString(),_=new Date(l.createdAt).toDateString();return d!==_};return n?f&&c.length===0?e.jsxs("div",{className:r.container,children:[e.jsxs("div",{className:r.header,children:[e.jsx("div",{className:r.headerAvatar,children:n.otherUser.avatarUrl?e.jsx("img",{src:n.otherUser.avatarUrl,alt:n.otherUser.displayName,className:r.headerAvatarImage}):e.jsx("div",{className:r.headerAvatarPlaceholder,children:n.otherUser.displayName.charAt(0).toUpperCase()})}),e.jsx("h2",{className:r.headerName,children:n.otherUser.displayName})]}),e.jsx("div",{className:r.loading,children:"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹..."})]}):e.jsxs("div",{className:r.container,children:[e.jsxs("div",{className:r.header,children:[e.jsx("div",{className:r.headerAvatar,children:n.otherUser.avatarUrl?e.jsx("img",{src:n.otherUser.avatarUrl,alt:n.otherUser.displayName,className:r.headerAvatarImage}):e.jsx("div",{className:r.headerAvatarPlaceholder,children:n.otherUser.displayName.charAt(0).toUpperCase()})}),e.jsx("h2",{className:r.headerName,children:n.otherUser.displayName})]}),e.jsx("div",{className:r.messagesContainer,children:c.length===0?e.jsx("div",{className:r.emptyMessages,children:e.jsxs("p",{children:["ÐÐ°Ñ‡Ð½Ð¸Ñ‚Ðµ Ð¿ÐµÑ€ÐµÐ¿Ð¸ÑÐºÑƒ Ñ ",n.otherUser.displayName]})}):e.jsxs("div",{className:r.messagesList,children:[c.map((t,l)=>{const d=t.senderId===v.id,_=A(t,c[l-1]);return e.jsxs(R.Fragment,{children:[_&&e.jsx("div",{className:r.dateSeparator,children:U(t.createdAt)}),e.jsxs("div",{className:`${r.message} ${d?r.ownMessage:r.otherMessage}`,children:[!d&&e.jsx("div",{className:r.messageAvatar,children:n.otherUser.avatarUrl?e.jsx("img",{src:n.otherUser.avatarUrl,alt:n.otherUser.displayName,className:r.messageAvatarImage}):e.jsx("div",{className:r.messageAvatarPlaceholder,children:n.otherUser.displayName.charAt(0).toUpperCase()})}),e.jsxs("div",{className:r.messageBubble,children:[e.jsx("p",{className:r.messageText,children:t.content}),e.jsxs("div",{className:r.messageFooter,children:[e.jsx("span",{className:r.messageTime,children:x(t.createdAt)}),d&&e.jsx("button",{className:r.deleteButton,onClick:()=>g(t.id),title:"Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ",children:"Ã—"})]})]})]})]},t.id)}),e.jsx("div",{ref:j})]})}),e.jsxs("form",{className:r.inputForm,onSubmit:N,children:[e.jsx("textarea",{className:r.input,value:h,onChange:t=>m(t.target.value),onKeyDown:y,placeholder:"ÐÐ°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ...",rows:1,disabled:p}),e.jsx("button",{type:"submit",className:r.sendButton,disabled:!h.trim()||p,children:p?"...":"âž¤"})]})]}):e.jsx("div",{className:r.container,children:e.jsxs("div",{className:r.empty,children:[e.jsx("span",{className:r.emptyIcon,children:"ðŸ’¬"}),e.jsx("p",{children:"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð´Ð¸Ð°Ð»Ð¾Ð³ Ð´Ð»Ñ Ð½Ð°Ñ‡Ð°Ð»Ð° Ð¿ÐµÑ€ÐµÐ¿Ð¸ÑÐºÐ¸"})]})})},Ve="_container_dayzs_1",We="_conversationListPanel_dayzs_23",Xe="_messageThreadPanel_dayzs_37",I={container:Ve,conversationListPanel:We,messageThreadPanel:Xe},as=()=>{const[n,i]=o.useState(null),c=f=>{i(f)};return e.jsx(E,{children:e.jsxs("div",{className:I.container,children:[e.jsx("div",{className:I.conversationListPanel,children:e.jsx(je,{onSelectConversation:c})}),e.jsx("div",{className:I.messageThreadPanel,children:e.jsx(Je,{conversation:n})})]})})};export{as as default};
//# sourceMappingURL=MessagesPage-BQOl4fZt.js.map
