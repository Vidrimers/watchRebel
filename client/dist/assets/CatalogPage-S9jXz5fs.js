import{a as re,r as c,R as le,j as e,b as ie,c as J,u as ce,m as K,e as F,p as de,q as pe}from"./index-DPQ5xN5C.js";import{U as ge}from"./UserPageLayout-BKV1caGZ.js";import{u as _e}from"./useAlert-C1sBKQSI.js";import{C as ve}from"./ConfirmDialog-CGWZbxny.js";const me="_mediaGrid_prsbg_1",ue="_mediaCard_prsbg_13",he="_posterContainer_prsbg_43",fe="_poster_prsbg_43",xe="_overlay_prsbg_83",ye="_overlayContent_prsbg_131",je="_overlayTitle_prsbg_141",be="_overlayYear_prsbg_155",we="_overlayRating_prsbg_167",Ne="_overlayOverview_prsbg_181",Ce="_actionButton_prsbg_197",Se="_actionMenu_prsbg_259",Le="_menuItem_prsbg_309",Te="_cardInfo_prsbg_353",Ie="_cardTitle_prsbg_361",Ge="_cardYear_prsbg_389",Pe="_cardRating_prsbg_401",Be="_empty_prsbg_415",r={mediaGrid:me,mediaCard:ue,posterContainer:he,poster:fe,overlay:xe,overlayContent:ye,overlayTitle:je,overlayYear:be,overlayRating:we,overlayOverview:Ne,actionButton:Ce,actionMenu:Se,menuItem:Le,cardInfo:Te,cardTitle:Ie,cardYear:Ge,cardRating:Pe,empty:Be},Ae=({items:u,mediaType:y,onAddToList:S,onAddToWatchlist:L})=>{const j=re(),[h,b]=c.useState(null),T=s=>{const i=y||(s.title?"movie":"tv");j(`/media/${i}/${s.id}`)},B=(s,i)=>{s.stopPropagation(),b(h===i?null:i)};le.useEffect(()=>{const s=()=>{h&&b(null)};return document.addEventListener("click",s),()=>document.removeEventListener("click",s)},[h]);const I=(s,i)=>{s.stopPropagation(),b(null),S&&S(i)},A=(s,i)=>{s.stopPropagation(),b(null),L&&L(i)};return!u||u.length===0?e.jsx("div",{className:r.empty,children:e.jsx("p",{children:"–ö–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω"})}):e.jsx("div",{className:r.mediaGrid,children:u.map(s=>{const i=s.title||s.name,C=s.release_date||s.first_air_date,f=C?new Date(C).getFullYear():null,M=s.poster_path?`https://image.tmdb.org/t/p/w342${s.poster_path}`:"/default-poster.png";return e.jsxs("div",{className:r.mediaCard,onClick:()=>T(s),onMouseLeave:()=>b(null),children:[e.jsxs("div",{className:r.posterContainer,children:[e.jsx("img",{src:M,alt:i,className:r.poster,loading:"lazy"}),e.jsxs("div",{className:r.overlay,children:[e.jsxs("div",{className:r.overlayContent,children:[e.jsx("h3",{className:r.overlayTitle,children:i}),f&&e.jsx("p",{className:r.overlayYear,children:f}),s.vote_average>0&&e.jsxs("div",{className:r.overlayRating,children:["‚≠ê ",s.vote_average.toFixed(1)]}),s.overview&&e.jsx("p",{className:r.overlayOverview,children:s.overview.length>100?`${s.overview.substring(0,100)}...`:s.overview})]}),e.jsx("button",{className:r.actionButton,onClick:w=>B(w,s.id),title:"–î–µ–π—Å—Ç–≤–∏—è",children:"‚ãÆ"}),h===s.id&&e.jsxs("div",{className:r.actionMenu,children:[e.jsx("button",{className:r.menuItem,onClick:w=>I(w,s),children:"üìã –î–æ–±–∞–≤–∏—Ç—å –≤ —Å–ø–∏—Å–æ–∫"}),e.jsx("button",{className:r.menuItem,onClick:w=>A(w,s),children:"‚≠ê –•–æ—á—É –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å"})]})]})]}),e.jsxs("div",{className:r.cardInfo,children:[e.jsx("h3",{className:r.cardTitle,title:i,children:i}),f&&e.jsx("p",{className:r.cardYear,children:f}),s.vote_average>0&&e.jsxs("div",{className:r.cardRating,children:["‚≠ê ",s.vote_average.toFixed(1)]})]})]},s.id)})})},Me="_catalogPage_12w8e_1",ke="_header_12w8e_13",Re="_title_12w8e_21",Ye="_subtitle_12w8e_33",$e="_tabs_12w8e_45",Ee="_tab_12w8e_45",De="_active_12w8e_93",Fe="_filters_12w8e_107",Oe="_filterGroup_12w8e_129",He="_filterLabel_12w8e_143",Ue="_filterSelect_12w8e_155",We="_resetButton_12w8e_199",ze="_content_12w8e_239",Ve="_pagination_12w8e_367",qe="_pageButton_12w8e_385",Je="_pageInfo_12w8e_433",Ke="_loading_12w8e_447",Qe="_error_12w8e_449",Xe="_empty_12w8e_451",Ze="_spinner_12w8e_469",et="_emptyHint_12w8e_517",tt="_retryButton_12w8e_527",st="_listSelectorContent_12w8e_665",at="_listSelectorText_12w8e_679",ot="_listSelect_12w8e_665",nt="_noListsMessage_12w8e_735",a={catalogPage:Me,header:ke,title:Re,subtitle:Ye,tabs:$e,tab:Ee,active:De,filters:Fe,filterGroup:Oe,filterLabel:He,filterSelect:Ue,resetButton:We,content:ze,pagination:Ve,pageButton:qe,pageInfo:Je,loading:Ke,error:Qe,empty:Xe,spinner:Ze,emptyHint:et,retryButton:tt,listSelectorContent:st,listSelectorText:at,listSelect:ot,noListsMessage:nt},dt=()=>{console.log("üé¨ CatalogPage —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è");const u=ie(),{showAlert:y}=_e(),{user:S}=J(t=>t.auth),{customLists:L}=J(t=>t.lists),[j,h]=ce(),[b,T]=c.useState([]),[B,I]=c.useState([]),[A,s]=c.useState(!0),[i,C]=c.useState(null),[f,M]=c.useState({movieGenres:[],tvGenres:[]}),[w,k]=c.useState(!1),[_,R]=c.useState(null),[G,Y]=c.useState(""),l=j.get("tab")||"movies",x=parseInt(j.get("page"))||1,d=j.get("genre")||"",p=j.get("year")||"",v=j.get("sort")||"popularity.desc",[$,E]=c.useState(1);c.useEffect(()=>{u(K())},[u]),c.useEffect(()=>{console.log("üöÄ useEffect –¥–ª—è –∂–∞–Ω—Ä–æ–≤ –∑–∞–ø—É—â–µ–Ω"),Q()},[]),c.useEffect(()=>{O()},[l,x,d,p,v]);const Q=async()=>{var t,o,n;try{console.log("üé¨ –ó–∞–≥—Ä—É–∑–∫–∞ –∂–∞–Ω—Ä–æ–≤...");const g=await F.get("/media/genres");console.log("üì¶ –û—Ç–≤–µ—Ç –æ—Ç API:",g.data),g.data?(console.log("üé≠ –ñ–∞–Ω—Ä—ã —Ñ–∏–ª—å–º–æ–≤:",((t=g.data.movieGenres)==null?void 0:t.length)||0),console.log("üì∫ –ñ–∞–Ω—Ä—ã —Å–µ—Ä–∏–∞–ª–æ–≤:",((o=g.data.tvGenres)==null?void 0:o.length)||0),M(g.data)):console.warn("‚ö†Ô∏è –ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –æ—Ç API")}catch(g){console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∂–∞–Ω—Ä–æ–≤:",g),console.error("–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:",((n=g.response)==null?void 0:n.data)||g.message)}},O=async()=>{s(!0),C(null);try{if(d||p||v!=="popularity.desc"){const o={type:l==="movies"?"movie":"tv",page:x,sortBy:v};d&&(o.genres=d),p&&(o.year=p);const n=await F.get("/media/discover",{params:o});l==="movies"?T(n.data.results||[]):I(n.data.results||[]),E(n.data.total_pages||1)}else{const o=await F.get("/media/popular",{params:{type:l==="movies"?"movie":"tv",page:x}});l==="movies"?(T(o.data.movies||[]),E(o.data.totalMoviePages||1)):(I(o.data.tv||[]),E(o.data.totalTVPages||1))}}catch(t){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞:",t),C("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.")}finally{s(!1)}},H=t=>{h({tab:t,page:1})},U=t=>{const o={tab:l,page:t};d&&(o.genre=d),p&&(o.year=p),v!=="popularity.desc"&&(o.sort=v),h(o),window.scrollTo({top:0,behavior:"smooth"})},D=(t,o)=>{const n={tab:l,page:1};t==="genre"?(o&&(n.genre=o),p&&(n.year=p),v!=="popularity.desc"&&(n.sort=v)):t==="year"?(d&&(n.genre=d),o&&(n.year=o),v!=="popularity.desc"&&(n.sort=v)):t==="sort"&&(d&&(n.genre=d),p&&(n.year=p),o!=="popularity.desc"&&(n.sort=o)),h(n)},X=()=>{h({tab:l,page:1})},Z=t=>{R(t),k(!0)},ee=async()=>{var t,o,n,g,V,q;if(!(!G||!_))try{const m=l==="movies"?"movie":"tv",P={listId:G,media:{tmdbId:_.id,mediaType:m}};console.log("üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö:",P),console.log("üìù –¢–∏–ø tmdbId:",typeof _.id),await u(pe(P)).unwrap(),await u(K()),k(!1),Y("");const ne=_.title||_.name;R(null),await y({title:"–£—Å–ø–µ—à–Ω–æ!",message:`"${ne}" –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Å–ø–∏—Å–æ–∫`,type:"success"})}catch(m){if(console.error("‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ —Å–ø–∏—Å–æ–∫:",m),console.error("üìã –î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:",((t=m.response)==null?void 0:t.data)||m),m.code==="ALREADY_IN_LIST"||((n=(o=m.response)==null?void 0:o.data)==null?void 0:n.code)==="ALREADY_IN_LIST"){const P=((g=m.response)==null?void 0:g.data)||m;await y({title:"–£–∂–µ –≤ —Å–ø–∏—Å–∫–µ",message:`–≠—Ç–æ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç —É–∂–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ "${P.existingListName}". –ö–æ–Ω—Ç–µ–Ω—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω–æ–º —Å–ø–∏—Å–∫–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.`,type:"warning"})}else await y({title:"–û—à–∏–±–∫–∞",message:((q=(V=m.response)==null?void 0:V.data)==null?void 0:q.error)||m.error||"–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –≤ —Å–ø–∏—Å–æ–∫. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.",type:"error"})}},te=()=>{k(!1),Y(""),R(null)},se=async t=>{try{const o=l==="movies"?"movie":"tv";await u(de({tmdbId:t.id,mediaType:o})).unwrap(),await y({title:"–£—Å–ø–µ—à–Ω–æ!",message:`"${t.title||t.name}" –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Å–ø–∏—Å–æ–∫ "–•–æ—á—É –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å"`,type:"success"})}catch(o){console.error("–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ watchlist:",o),await y({title:"–û—à–∏–±–∫–∞",message:"–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –≤ —Å–ø–∏—Å–æ–∫. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.",type:"error"})}},W=l==="movies"?b:B,N=l==="movies"?f.movieGenres:f.tvGenres;console.log("üéØ –¢–µ–∫—É—â–∞—è –≤–∫–ª–∞–¥–∫–∞:",l),console.log("üìö –í—Å–µ –∂–∞–Ω—Ä—ã:",f),console.log("üé≠ –¢–µ–∫—É—â–∏–µ –∂–∞–Ω—Ä—ã:",N);const z=L.filter(t=>t.mediaType===(l==="movies"?"movie":"tv")),ae=new Date().getFullYear(),oe=Array.from({length:51},(t,o)=>ae-o);return e.jsxs(ge,{user:S,children:[e.jsxs("div",{className:a.catalogPage,children:[e.jsxs("div",{className:a.header,children:[e.jsx("h1",{className:a.title,children:"üìö –ö–∞—Ç–∞–ª–æ–≥"}),e.jsx("p",{className:a.subtitle,children:"–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ñ–∏–ª—å–º—ã –∏ —Å–µ—Ä–∏–∞–ª—ã"})]}),e.jsxs("div",{className:a.tabs,children:[e.jsx("button",{className:`${a.tab} ${l==="movies"?a.active:""}`,onClick:()=>H("movies"),children:"üé¨ –§–∏–ª—å–º—ã"}),e.jsx("button",{className:`${a.tab} ${l==="tv"?a.active:""}`,onClick:()=>H("tv"),children:"üì∫ –°–µ—Ä–∏–∞–ª—ã"})]}),e.jsxs("div",{className:a.filters,children:[e.jsxs("div",{className:a.filterGroup,children:[e.jsx("label",{className:a.filterLabel,children:"–ñ–∞–Ω—Ä:"}),e.jsxs("select",{className:a.filterSelect,value:d,onChange:t=>D("genre",t.target.value),children:[e.jsx("option",{value:"",children:"–í—Å–µ –∂–∞–Ω—Ä—ã"}),N&&N.length>0?N.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id)):e.jsx("option",{disabled:!0,children:"–ó–∞–≥—Ä—É–∑–∫–∞ –∂–∞–Ω—Ä–æ–≤..."})]}),N&&N.length===0&&e.jsx("small",{style:{color:"red",fontSize:"0.75rem"},children:"–ñ–∞–Ω—Ä—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å."})]}),e.jsxs("div",{className:a.filterGroup,children:[e.jsx("label",{className:a.filterLabel,children:"–ì–æ–¥:"}),e.jsxs("select",{className:a.filterSelect,value:p,onChange:t=>D("year",t.target.value),children:[e.jsx("option",{value:"",children:"–í—Å–µ –≥–æ–¥—ã"}),oe.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:a.filterGroup,children:[e.jsx("label",{className:a.filterLabel,children:"–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:"}),e.jsxs("select",{className:a.filterSelect,value:v,onChange:t=>D("sort",t.target.value),children:[e.jsx("option",{value:"popularity.desc",children:"–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å ‚Üì"}),e.jsx("option",{value:"popularity.asc",children:"–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å ‚Üë"}),e.jsx("option",{value:"vote_average.desc",children:"–†–µ–π—Ç–∏–Ω–≥ ‚Üì"}),e.jsx("option",{value:"vote_average.asc",children:"–†–µ–π—Ç–∏–Ω–≥ ‚Üë"}),e.jsx("option",{value:"release_date.desc",children:"–î–∞—Ç–∞ –≤—ã—Ö–æ–¥–∞ ‚Üì"}),e.jsx("option",{value:"release_date.asc",children:"–î–∞—Ç–∞ –≤—ã—Ö–æ–¥–∞ ‚Üë"})]})]}),(d||p||v!=="popularity.desc")&&e.jsx("button",{className:a.resetButton,onClick:X,children:"–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã"})]}),e.jsx("div",{className:a.content,children:A?e.jsxs("div",{className:a.loading,children:[e.jsx("div",{className:a.spinner}),e.jsx("p",{children:"–ó–∞–≥—Ä—É–∑–∫–∞..."})]}):i?e.jsxs("div",{className:a.error,children:[e.jsx("p",{children:i}),e.jsx("button",{onClick:O,className:a.retryButton,children:"–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞"})]}):W.length>0?e.jsxs(e.Fragment,{children:[e.jsx(Ae,{items:W,mediaType:l==="movies"?"movie":"tv",onAddToList:Z,onAddToWatchlist:se}),$>1&&e.jsxs("div",{className:a.pagination,children:[e.jsx("button",{className:a.pageButton,onClick:()=>U(x-1),disabled:x===1,children:"‚Üê –ù–∞–∑–∞–¥"}),e.jsxs("span",{className:a.pageInfo,children:["–°—Ç—Ä–∞–Ω–∏—Ü–∞ ",x," –∏–∑ ",$]}),e.jsx("button",{className:a.pageButton,onClick:()=>U(x+1),disabled:x>=$,children:"–í–ø–µ—Ä–µ–¥ ‚Üí"})]})]}):e.jsxs("div",{className:a.empty,children:[e.jsx("p",{children:"–ö–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω"}),e.jsx("p",{className:a.emptyHint,children:"–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã"})]})})]}),e.jsx(ve,{isOpen:w,title:"–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–∏—Å–æ–∫",message:e.jsxs("div",{className:a.listSelectorContent,children:[e.jsxs("p",{className:a.listSelectorText,children:['–î–æ–±–∞–≤–∏—Ç—å "',(_==null?void 0:_.title)||(_==null?void 0:_.name),'" –≤ —Å–ø–∏—Å–æ–∫:']}),e.jsxs("select",{value:G,onChange:t=>Y(t.target.value),className:a.listSelect,children:[e.jsx("option",{value:"",children:"–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–∏—Å–æ–∫"}),z.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),z.length===0&&e.jsxs("p",{className:a.noListsMessage,children:['–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–ø–∏—Å–∫–æ–≤. –°–æ–∑–¥–∞–π—Ç–µ —Å–ø–∏—Å–æ–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ "–ú–æ–∏ ',l==="movies"?"—Ñ–∏–ª—å–º—ã":"—Å–µ—Ä–∏–∞–ª—ã",'".']})]}),onConfirm:ee,onCancel:te,confirmText:"–î–æ–±–∞–≤–∏—Ç—å",cancelText:"–û—Ç–º–µ–Ω–∞",confirmButtonStyle:"primary",confirmDisabled:!G})]})};export{dt as default};
//# sourceMappingURL=CatalogPage-S9jXz5fs.js.map
