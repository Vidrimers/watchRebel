import{r as l,j as e,a as G,b as ne,c as ie,M as oe,N as re,e as H,f as W}from"./index-GLrqEWvZ.js";import{u as ce}from"./useConfirm-r4lu6ZEG.js";import{u as de}from"./useAlert-NXgLQgpe.js";const le="_reactionPicker_wifv9_3",ue="_pickerHeader_wifv9_57",me="_pickerTitle_wifv9_75",_e="_closeButton_wifv9_87",he="_emojiGrid_wifv9_133",ve="_emojiButton_wifv9_145",j={reactionPicker:le,pickerHeader:ue,pickerTitle:me,closeButton:_e,emojiGrid:he,emojiButton:ve},xe=({onSelect:t,onClose:r})=>{const m=l.useRef(null),[h,f]=l.useState([]),d=["â¤ï¸","ðŸ‘","ðŸ˜‚","ðŸ˜Š","ðŸ˜®","ðŸ˜¢","ðŸ˜¡","ðŸ”¥","ðŸ‘","ðŸŽ‰","ðŸ’¯","ðŸ¤”","ðŸ˜","ðŸ¤©","ðŸ˜Ž","ðŸ¥³","ðŸ˜±","ðŸ¤¯","ðŸ‘€","ðŸ’©","ðŸ¤¡","ðŸ¤®","ðŸ˜¤","ðŸ™„","ðŸ˜’","ðŸ‘Ž","ðŸ’€","ðŸ¤¬","ðŸ˜ˆ"];l.useEffect(()=>{const i=JSON.parse(localStorage.getItem("emojiUsage")||"{}"),u=[...d].sort((p,g)=>{const N=i[p]||0;return(i[g]||0)-N});f(u)},[]),l.useEffect(()=>{const i=u=>{m.current&&!m.current.contains(u.target)&&r()};return document.addEventListener("mousedown",i),()=>{document.removeEventListener("mousedown",i)}},[r]),l.useEffect(()=>{const i=u=>{u.key==="Escape"&&r()};return document.addEventListener("keydown",i),()=>{document.removeEventListener("keydown",i)}},[r]);const c=i=>{const u=JSON.parse(localStorage.getItem("emojiUsage")||"{}");u[i]=(u[i]||0)+1,localStorage.setItem("emojiUsage",JSON.stringify(u)),t(i)};return e.jsxs("div",{className:j.reactionPicker,ref:m,children:[e.jsxs("div",{className:j.pickerHeader,children:[e.jsx("span",{className:j.pickerTitle,children:"Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ñ€ÐµÐ°ÐºÑ†Ð¸ÑŽ"}),e.jsx("button",{className:j.closeButton,onClick:r,"aria-label":"Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ",children:"Ã—"})]}),e.jsx("div",{className:j.emojiGrid,children:h.map(i=>e.jsx("button",{className:j.emojiButton,onClick:()=>c(i),title:i,children:i},i))})]})},je="_tooltip_192er_1",fe="_tooltipContent_192er_25",pe="_userItem_192er_37",Ne="_avatar_192er_65",ge="_avatarPlaceholder_192er_93",Te="_userName_192er_119",x={tooltip:je,tooltipContent:fe,userItem:pe,avatar:Ne,avatarPlaceholder:ge,userName:Te},we=({users:t,position:r,onMouseEnter:m,onMouseLeave:h})=>{const f=G(),d=(c,i)=>{i.stopPropagation(),f(`/profile/${c}`)};return e.jsx("div",{className:x.tooltip,style:{left:(r==null?void 0:r.x)||0,top:(r==null?void 0:r.y)||0},onMouseEnter:m,onMouseLeave:h,children:e.jsx("div",{className:x.tooltipContent,children:t.map(c=>e.jsxs("div",{className:x.userItem,onClick:i=>d(c.id,i),children:[e.jsx("div",{className:x.avatar,children:c.avatarUrl?e.jsx("img",{src:c.avatarUrl.startsWith("http")?c.avatarUrl:`http://localhost:1313${c.avatarUrl}`,alt:c.name,onError:i=>{i.target.style.display="none",i.target.parentElement.innerHTML=`<div class="${x.avatarPlaceholder}">${c.name.charAt(0).toUpperCase()}</div>`}}):e.jsx("div",{className:x.avatarPlaceholder,children:c.name.charAt(0).toUpperCase()})}),e.jsx("span",{className:x.userName,children:c.name})]},c.id))})})},Ce="_wallPost_1dsun_3",ye="_postActions_1dsun_29",Be="_postContent_1dsun_39",ke="_textContent_1dsun_49",Ie="_actionText_1dsun_69",be="_mediaInfo_1dsun_83",Ee="_mediaDetails_1dsun_127",De="_mediaTitle_1dsun_143",Re="_mediaType_1dsun_159",Se="_ratingValue_1dsun_171",Le="_ratingStars_1dsun_185",Me="_ratingNumber_1dsun_195",Pe="_reviewText_1dsun_209",Ae="_postFooter_1dsun_245",$e="_postFooterLeft_1dsun_261",Ue="_postDate_1dsun_273",Fe="_editedLabel_1dsun_283",He="_editButton_1dsun_309",We="_deleteButton_1dsun_311",Ge="_reactionsContainer_1dsun_367",Ve="_reactionsList_1dsun_379",Je="_reactionBadge_1dsun_391",Oe="_userReaction_1dsun_427",Ye="_addReactionContainer_1dsun_443",qe="_addReactionButton_1dsun_451",ze="_editMode_1dsun_547",Ke="_editTextarea_1dsun_559",Qe="_editButtons_1dsun_597",Xe="_saveButton_1dsun_607",Ze="_cancelButton_1dsun_609",s={wallPost:Ce,postActions:ye,postContent:Be,textContent:ke,actionText:Ie,mediaInfo:be,mediaDetails:Ee,mediaTitle:De,mediaType:Re,ratingValue:Se,ratingStars:Le,ratingNumber:Me,reviewText:Pe,postFooter:Ae,postFooterLeft:$e,postDate:Ue,editedLabel:Fe,editButton:He,deleteButton:We,reactionsContainer:Ge,reactionsList:Ve,reactionBadge:Je,userReaction:Oe,addReactionContainer:Ye,addReactionButton:qe,editMode:ze,editTextarea:Ke,editButtons:Qe,saveButton:Xe,cancelButton:Ze},at=({post:t,isOwnProfile:r,onReactionChange:m})=>{var A,$;const h=ne(),f=G(),d=ie(a=>a.auth.user),{confirmDialog:c,showConfirm:i}=ce(),{alertDialog:u,showAlert:p}=de(),[g,N]=l.useState(!1),[w,R]=l.useState(!1),[C,y]=l.useState(null),v=l.useRef(null),[S,B]=l.useState(!1),[k,I]=l.useState(t.content||""),[T,L]=l.useState(!1),M=async a=>{try{await h(re({postId:t.id,emoji:a})).unwrap(),N(!1),m&&m()}catch(n){console.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ñ€ÐµÐ°ÐºÑ†Ð¸Ð¸:",n)}},V=async a=>{try{await H.delete(`/wall/${t.id}/reactions/${a}`),h(W(t.userId)),m&&m()}catch(n){console.error("ÐžÑˆÐ¸Ð±ÐºÐ° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ Ñ€ÐµÐ°ÐºÑ†Ð¸Ð¸:",n)}},J=async a=>{var o;if(!d)return;const n=(o=t.reactions)==null?void 0:o.find(_=>_.userId===d.id&&_.emoji===a.emoji);n?await V(n.id):await M(a.emoji)},O=(a,n)=>{v.current&&clearTimeout(v.current);const o=a.currentTarget.getBoundingClientRect();y({users:n,position:{x:o.left,y:o.bottom+5}})},Y=()=>{v.current=setTimeout(()=>{y(null)},300)},q=()=>{v.current&&clearTimeout(v.current)},z=()=>{y(null)};l.useEffect(()=>()=>{v.current&&clearTimeout(v.current)},[]);const K=async()=>{if(await i({title:"Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð·Ð°Ð¿Ð¸ÑÑŒ?",message:"Ð’Ñ‹ ÑƒÐ²ÐµÑ€ÐµÐ½Ñ‹, Ñ‡Ñ‚Ð¾ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÑ‚Ñƒ Ð·Ð°Ð¿Ð¸ÑÑŒ? Ð­Ñ‚Ð¾ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ð½ÐµÐ»ÑŒÐ·Ñ Ð¾Ñ‚Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ.",confirmText:"Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ",cancelText:"ÐžÑ‚Ð¼ÐµÐ½Ð°",confirmButtonStyle:"danger"})){R(!0);try{await h(oe(t.id)).unwrap()}catch(n){console.error("ÐžÑˆÐ¸Ð±ÐºÐ° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ Ð¿Ð¾ÑÑ‚Ð°:",n),await p({title:"ÐžÑˆÐ¸Ð±ÐºÐ°",message:"ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ Ð·Ð°Ð¿Ð¸ÑÑŒ. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÐµÑ‰Ðµ Ñ€Ð°Ð·.",type:"error"}),R(!1)}}},Q=()=>{B(!0),I(t.content||"")},X=async()=>{var a,n;if(!k.trim()){await p({title:"ÐžÑˆÐ¸Ð±ÐºÐ°",message:"ÐšÐ¾Ð½Ñ‚ÐµÐ½Ñ‚ Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð¿ÑƒÑÑ‚Ñ‹Ð¼",type:"error"});return}L(!0);try{await H.put(`/wall/${t.id}`,{content:k.trim()}),h(W(t.userId)),B(!1)}catch(o){console.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¿Ð¾ÑÑ‚Ð°:",o),await p({title:"ÐžÑˆÐ¸Ð±ÐºÐ°",message:((n=(a=o.response)==null?void 0:a.data)==null?void 0:n.error)||"ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¾Ñ‚Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð·Ð°Ð¿Ð¸ÑÑŒ",type:"error"})}finally{L(!1)}},Z=()=>{B(!1),I(t.content||"")},ee=()=>{const a=new Date(t.createdAt),n=new Date,o=60*60*1e3;return n-a<o},te=a=>{const n=new Date(a),o=new Date,_=o-n,D=Math.floor(_/6e4),U=Math.floor(_/36e5),F=Math.floor(_/864e5);return D<1?"Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ‡Ñ‚Ð¾":D<60?`${D} Ð¼Ð¸Ð½ Ð½Ð°Ð·Ð°Ð´`:U<24?`${U} Ñ‡ Ð½Ð°Ð·Ð°Ð´`:F<7?`${F} Ð´ Ð½Ð°Ð·Ð°Ð´`:n.toLocaleDateString("ru-RU",{day:"numeric",month:"short",year:n.getFullYear()!==o.getFullYear()?"numeric":void 0})},b=()=>{t.tmdbId&&t.mediaType&&f(`/media/${t.mediaType}/${t.tmdbId}`)},se=()=>{switch(t.postType){case"text":return e.jsx("div",{className:s.textContent,children:S?e.jsxs("div",{className:s.editMode,children:[e.jsx("textarea",{className:s.editTextarea,value:k,onChange:a=>I(a.target.value),rows:4,disabled:T}),e.jsxs("div",{className:s.editButtons,children:[e.jsx("button",{className:s.saveButton,onClick:X,disabled:T,children:T?"Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ...":"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ"}),e.jsx("button",{className:s.cancelButton,onClick:Z,disabled:T,children:"ÐžÑ‚Ð¼ÐµÐ½Ð°"})]})]}):e.jsx("p",{children:t.content})});case"media_added":return e.jsxs("div",{className:s.mediaAddedContent,children:[e.jsxs("p",{className:s.actionText,children:["ðŸ“Œ Ð”Ð¾Ð±Ð°Ð²Ð¸Ð»",r?"":"Ð°"," Ð² ÑÐ¿Ð¸ÑÐ¾Ðº"]}),t.tmdbId&&e.jsx("div",{className:s.mediaInfo,onClick:b,children:e.jsxs("div",{className:s.mediaDetails,children:[e.jsxs("h4",{className:s.mediaTitle,children:[t.mediaType==="movie"?"Ð¤Ð¸Ð»ÑŒÐ¼":"Ð¡ÐµÑ€Ð¸Ð°Ð»"," (ID: ",t.tmdbId,")"]}),e.jsx("span",{className:s.mediaType,children:t.mediaType==="movie"?"ðŸŽ¬ Ð¤Ð¸Ð»ÑŒÐ¼":"ðŸ“º Ð¡ÐµÑ€Ð¸Ð°Ð»"})]})})]});case"rating":return e.jsxs("div",{className:s.ratingContent,children:[e.jsxs("p",{className:s.actionText,children:["â­ ÐžÑ†ÐµÐ½Ð¸Ð»",r?"":"Ð°"]}),t.tmdbId&&e.jsx("div",{className:s.mediaInfo,onClick:b,children:e.jsxs("div",{className:s.mediaDetails,children:[e.jsxs("h4",{className:s.mediaTitle,children:[t.mediaType==="movie"?"Ð¤Ð¸Ð»ÑŒÐ¼":"Ð¡ÐµÑ€Ð¸Ð°Ð»"," (ID: ",t.tmdbId,")"]}),e.jsxs("div",{className:s.ratingValue,children:[e.jsx("span",{className:s.ratingStars,children:"â˜…"}),e.jsxs("span",{className:s.ratingNumber,children:[t.rating,"/10"]})]})]})})]});case"review":return e.jsxs("div",{className:s.reviewContent,children:[e.jsxs("p",{className:s.actionText,children:["âœï¸ ÐÐ°Ð¿Ð¸ÑÐ°Ð»",r?"":"Ð°"," Ð¾Ñ‚Ð·Ñ‹Ð²"]}),t.tmdbId&&e.jsx("div",{className:s.mediaInfo,onClick:b,children:e.jsx("div",{className:s.mediaDetails,children:e.jsxs("h4",{className:s.mediaTitle,children:[t.mediaType==="movie"?"Ð¤Ð¸Ð»ÑŒÐ¼":"Ð¡ÐµÑ€Ð¸Ð°Ð»"," (ID: ",t.tmdbId,")"]})})}),t.content&&e.jsx("div",{className:s.reviewText,children:e.jsx("p",{children:t.content})})]});default:return null}},ae=((A=t.reactions)==null?void 0:A.reduce((a,n)=>{var o,_;return a[n.emoji]||(a[n.emoji]={emoji:n.emoji,count:0,users:[]}),a[n.emoji].count++,a[n.emoji].users.push({id:n.userId,name:((o=n.user)==null?void 0:o.displayName)||"ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ",avatarUrl:((_=n.user)==null?void 0:_.avatarUrl)||null}),a},{}))||{},P=Object.values(ae),E=($=t.reactions)==null?void 0:$.find(a=>a.userId===(d==null?void 0:d.id));return e.jsxs(e.Fragment,{children:[c,u,e.jsxs("div",{className:s.wallPost,children:[e.jsx("div",{className:s.postContent,children:se()}),e.jsxs("div",{className:s.postFooter,children:[e.jsxs("div",{className:s.postFooterLeft,children:[e.jsxs("span",{className:s.postDate,children:[te(t.createdAt),t.editedAt&&e.jsx("span",{className:s.editedLabel,children:" (Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¾)"})]}),r&&d&&t.userId===d.id&&e.jsxs("div",{className:s.postActions,children:[ee()&&(t.postType==="text"||t.postType==="review")&&!S&&e.jsx("button",{className:s.editButton,onClick:Q,title:"Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ",children:"âœï¸"}),e.jsx("button",{className:s.deleteButton,onClick:K,disabled:w,title:"Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð·Ð°Ð¿Ð¸ÑÑŒ",children:w?"â³":"ðŸ—‘ï¸"})]})]}),e.jsxs("div",{className:s.reactionsContainer,children:[P.length>0&&e.jsx("div",{className:s.reactionsList,children:P.map(a=>{const n=d&&a.users.some(o=>o.id===d.id);return e.jsxs("span",{className:`${s.reactionBadge} ${n?s.userReaction:""}`,onClick:()=>J(a),onMouseEnter:o=>O(o,a.users),onMouseLeave:Y,children:[a.emoji," ",a.count]},a.emoji)})}),d&&e.jsxs("div",{className:s.addReactionContainer,children:[e.jsx("button",{className:s.addReactionButton,onClick:()=>N(!g),title:E?"Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ñ€ÐµÐ°ÐºÑ†Ð¸ÑŽ":"Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ñ€ÐµÐ°ÐºÑ†Ð¸ÑŽ",children:E?E.emoji:"ðŸ˜Š"}),g&&e.jsx(xe,{onSelect:M,onClose:()=>N(!1)})]})]}),C&&e.jsx(we,{users:C.users,position:C.position,onMouseEnter:q,onMouseLeave:z})]})]})]})};export{at as W};
//# sourceMappingURL=WallPost-Bjj0hfds.js.map
