{"version":3,"file":"WatchlistPage-CaR6Cljp.js","sources":["../../src/pages/WatchlistPage.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { useSearchParams } from 'react-router-dom';\r\nimport { useAppDispatch } from '../hooks/useAppDispatch';\r\nimport { useAppSelector } from '../hooks/useAppSelector';\r\nimport { fetchWatchlist, fetchLists, addToList } from '../store/slices/listsSlice';\r\nimport UserPageLayout from '../components/Layout/UserPageLayout';\r\nimport MediaCard from '../components/Media/MediaCard';\r\nimport styles from './WatchlistPage.module.css';\r\n\r\n/**\r\n * –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–ø–∏—Å–∫–∞ –∂–µ–ª–∞–µ–º–æ–≥–æ –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É\r\n * –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å watchlist –∏ –ø–µ—Ä–µ–º–µ—â–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–ø–∏—Å–∫–∏\r\n */\r\nconst WatchlistPage = () => {\r\n  const dispatch = useAppDispatch();\r\n  const [searchParams, setSearchParams] = useSearchParams();\r\n  \r\n  const { user, isAuthenticated } = useAppSelector((state) => state.auth);\r\n  const { watchlist, customLists, loading, error } = useAppSelector((state) => state.lists);\r\n  const { episodeProgress } = useAppSelector((state) => state.lists);\r\n\r\n  // –§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É –º–µ–¥–∏–∞\r\n  const filterType = searchParams.get('type') || 'all';\r\n  \r\n  // –°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –≤ —Å–ø–∏—Å–æ–∫\r\n  const [moveModalOpen, setMoveModalOpen] = useState(false);\r\n  const [selectedMedia, setSelectedMedia] = useState(null);\r\n\r\n  useEffect(() => {\r\n    if (isAuthenticated) {\r\n      dispatch(fetchWatchlist());\r\n      dispatch(fetchLists());\r\n    }\r\n  }, [isAuthenticated, dispatch]);\r\n\r\n  // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è watchlist –ø–æ —Ç–∏–ø—É\r\n  const filteredWatchlist = filterType === 'all' \r\n    ? watchlist \r\n    : watchlist.filter(item => item.mediaType === filterType);\r\n\r\n  // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞\r\n  const handleFilterChange = (type) => {\r\n    setSearchParams(type === 'all' ? {} : { type });\r\n  };\r\n\r\n  // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è\r\n  const handleMoveToList = (media) => {\r\n    setSelectedMedia(media);\r\n    setMoveModalOpen(true);\r\n  };\r\n\r\n  // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–æ–∫\r\n  const handleSelectList = async (listId) => {\r\n    if (!selectedMedia) return;\r\n\r\n    try {\r\n      await dispatch(addToList({\r\n        listId,\r\n        media: {\r\n          tmdbId: selectedMedia.tmdbId,\r\n          mediaType: selectedMedia.mediaType\r\n        }\r\n      })).unwrap();\r\n\r\n      // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ\r\n      setMoveModalOpen(false);\r\n      setSelectedMedia(null);\r\n\r\n      // –û–±–Ω–æ–≤–ª—è–µ–º watchlist\r\n      dispatch(fetchWatchlist());\r\n    } catch (err) {\r\n      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–∏ –≤ —Å–ø–∏—Å–æ–∫:', err);\r\n    }\r\n  };\r\n\r\n  // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞\r\n  const handleCloseModal = () => {\r\n    setMoveModalOpen(false);\r\n    setSelectedMedia(null);\r\n  };\r\n\r\n  // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –º–µ–¥–∏–∞\r\n  const availableLists = selectedMedia \r\n    ? customLists.filter(list => list.mediaType === selectedMedia.mediaType)\r\n    : [];\r\n\r\n  if (!isAuthenticated) {\r\n    return (\r\n      <div className={styles.errorContainer}>\r\n        <p>–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <UserPageLayout user={user}>\r\n      <div className={styles.watchlistPage}>\r\n        {/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã */}\r\n        <div className={styles.pageHeader}>\r\n          <h1 className={styles.pageTitle}>–°–ø–∏—Å–æ–∫ –∂–µ–ª–∞–µ–º–æ–≥–æ</h1>\r\n          \r\n          <div className={styles.filterButtons}>\r\n            <button\r\n              className={`${styles.filterButton} ${filterType === 'all' ? styles.active : ''}`}\r\n              onClick={() => handleFilterChange('all')}\r\n            >\r\n              –í—Å–µ\r\n            </button>\r\n            <button\r\n              className={`${styles.filterButton} ${filterType === 'movie' ? styles.active : ''}`}\r\n              onClick={() => handleFilterChange('movie')}\r\n            >\r\n              üé¨ –§–∏–ª—å–º—ã\r\n            </button>\r\n            <button\r\n              className={`${styles.filterButton} ${filterType === 'tv' ? styles.active : ''}`}\r\n              onClick={() => handleFilterChange('tv')}\r\n            >\r\n              üì∫ –°–µ—Ä–∏–∞–ª—ã\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* –°—á–µ—Ç—á–∏–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */}\r\n        {!loading && !error && (\r\n          <div className={styles.countInfo}>\r\n            <p>\r\n              {filteredWatchlist.length} {' '}\r\n              {filteredWatchlist.length === 1 ? '—ç–ª–µ–º–µ–Ω—Ç' : \r\n               filteredWatchlist.length > 1 && filteredWatchlist.length < 5 ? '—ç–ª–µ–º–µ–Ω—Ç–∞' : \r\n               '—ç–ª–µ–º–µ–Ω—Ç–æ–≤'}\r\n            </p>\r\n          </div>\r\n        )}\r\n\r\n        {/* –°–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ—à–∏–±–æ–∫ */}\r\n        {loading && (\r\n          <div className={styles.loadingContainer}>\r\n            <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –∂–µ–ª–∞–µ–º–æ–≥–æ...</p>\r\n          </div>\r\n        )}\r\n\r\n        {error && (\r\n          <div className={styles.errorMessage}>\r\n            <p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: {error.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}</p>\r\n          </div>\r\n        )}\r\n\r\n        {/* –ö–æ–Ω—Ç–µ–Ω—Ç */}\r\n        {!loading && !error && (\r\n          <>\r\n            {filteredWatchlist.length === 0 ? (\r\n              <div className={styles.emptyState}>\r\n                <div className={styles.emptyIcon}>üìã</div>\r\n                <p className={styles.emptyTitle}>–°–ø–∏—Å–æ–∫ –∂–µ–ª–∞–µ–º–æ–≥–æ –ø—É—Å—Ç</p>\r\n                <p className={styles.emptyHint}>\r\n                  –î–æ–±–∞–≤—å—Ç–µ —Ñ–∏–ª—å–º—ã –∏ —Å–µ—Ä–∏–∞–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Ç–∏—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å\r\n                </p>\r\n              </div>\r\n            ) : (\r\n              <div className={styles.mediaGrid}>\r\n                {filteredWatchlist.map((item) => (\r\n                  <div key={item.tmdbId} className={styles.mediaCardWrapper}>\r\n                    <MediaCard\r\n                      media={item}\r\n                      showProgress={item.mediaType === 'tv'}\r\n                      progress={episodeProgress[item.tmdbId]?.[episodeProgress[item.tmdbId].length - 1]}\r\n                    />\r\n                    <button\r\n                      className={styles.moveButton}\r\n                      onClick={() => handleMoveToList(item)}\r\n                      title=\"–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤ —Å–ø–∏—Å–æ–∫\"\r\n                    >\r\n                      ‚Üí –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤ —Å–ø–∏—Å–æ–∫\r\n                    </button>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </>\r\n        )}\r\n\r\n        {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ —Å–ø–∏—Å–∫–∞ */}\r\n        {moveModalOpen && selectedMedia && (\r\n          <div className={styles.modalOverlay} onClick={handleCloseModal}>\r\n            <div className={styles.modal} onClick={(e) => e.stopPropagation()}>\r\n              <div className={styles.modalHeader}>\r\n                <h2 className={styles.modalTitle}>–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–∏—Å–æ–∫</h2>\r\n                <button \r\n                  className={styles.modalClose}\r\n                  onClick={handleCloseModal}\r\n                >\r\n                  √ó\r\n                </button>\r\n              </div>\r\n\r\n              <div className={styles.modalContent}>\r\n                <p className={styles.modalSubtitle}>\r\n                  –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å \"{selectedMedia.title}\" –≤:\r\n                </p>\r\n\r\n                {availableLists.length === 0 ? (\r\n                  <div className={styles.noLists}>\r\n                    <p>–£ –≤–∞—Å –Ω–µ—Ç —Å–ø–∏—Å–∫–æ–≤ –¥–ª—è {selectedMedia.mediaType === 'movie' ? '—Ñ–∏–ª—å–º–æ–≤' : '—Å–µ—Ä–∏–∞–ª–æ–≤'}</p>\r\n                    <p className={styles.noListsHint}>\r\n                      –°–æ–∑–¥–∞–π—Ç–µ —Å–ø–∏—Å–æ–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ \"–ú–æ–∏ —Å–ø–∏—Å–∫–∏\"\r\n                    </p>\r\n                  </div>\r\n                ) : (\r\n                  <div className={styles.listOptions}>\r\n                    {availableLists.map((list) => (\r\n                      <button\r\n                        key={list.id}\r\n                        className={styles.listOption}\r\n                        onClick={() => handleSelectList(list.id)}\r\n                      >\r\n                        <span className={styles.listOptionName}>{list.name}</span>\r\n                        <span className={styles.listOptionCount}>\r\n                          {list.items?.length || 0} —ç–ª–µ–º–µ–Ω—Ç–æ–≤\r\n                        </span>\r\n                      </button>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </UserPageLayout>\r\n  );\r\n};\r\n\r\nexport default WatchlistPage;\r\n"],"names":["WatchlistPage","dispatch","useAppDispatch","searchParams","setSearchParams","useSearchParams","user","isAuthenticated","useAppSelector","state","watchlist","customLists","loading","error","episodeProgress","filterType","moveModalOpen","setMoveModalOpen","useState","selectedMedia","setSelectedMedia","useEffect","fetchWatchlist","fetchLists","filteredWatchlist","item","handleFilterChange","type","handleMoveToList","media","handleSelectList","listId","addToList","err","handleCloseModal","availableLists","list","UserPageLayout","styles","jsxs","jsx","Fragment","MediaCard","_a","e"],"mappings":"igDAaMA,GAAgB,IAAM,CAC1B,MAAMC,EAAWC,EAAA,EACX,CAACC,EAAcC,CAAe,EAAIC,EAAA,EAElC,CAAE,KAAAC,EAAM,gBAAAC,CAAA,EAAoBC,EAAgBC,GAAUA,EAAM,IAAI,EAChE,CAAE,UAAAC,EAAW,YAAAC,EAAa,QAAAC,EAAS,MAAAC,GAAUL,EAAgBC,GAAUA,EAAM,KAAK,EAClF,CAAE,gBAAAK,CAAA,EAAoBN,EAAgBC,GAAUA,EAAM,KAAK,EAG3DM,EAAaZ,EAAa,IAAI,MAAM,GAAK,MAGzC,CAACa,EAAeC,CAAgB,EAAIC,EAAAA,SAAS,EAAK,EAClD,CAACC,EAAeC,CAAgB,EAAIF,EAAAA,SAAS,IAAI,EAEvDG,EAAAA,UAAU,IAAM,CACVd,IACFN,EAASqB,GAAgB,EACzBrB,EAASsB,GAAY,EAEzB,EAAG,CAAChB,EAAiBN,CAAQ,CAAC,EAG9B,MAAMuB,EAAoBT,IAAe,MACrCL,EACAA,EAAU,OAAOe,GAAQA,EAAK,YAAcV,CAAU,EAGpDW,EAAsBC,GAAS,CACnCvB,EAAgBuB,IAAS,MAAQ,CAAA,EAAK,CAAE,KAAAA,EAAM,CAChD,EAGMC,EAAoBC,GAAU,CAClCT,EAAiBS,CAAK,EACtBZ,EAAiB,EAAI,CACvB,EAGMa,EAAmB,MAAOC,GAAW,CACzC,GAAKZ,EAEL,GAAI,CACF,MAAMlB,EAAS+B,EAAU,CACvB,OAAAD,EACA,MAAO,CACL,OAAQZ,EAAc,OACtB,UAAWA,EAAc,SAAA,CAC3B,CACD,CAAC,EAAE,OAAA,EAGJF,EAAiB,EAAK,EACtBG,EAAiB,IAAI,EAGrBnB,EAASqB,GAAgB,CAC3B,OAASW,EAAK,CACZ,QAAQ,MAAM,mCAAoCA,CAAG,CACvD,CACF,EAGMC,EAAmB,IAAM,CAC7BjB,EAAiB,EAAK,EACtBG,EAAiB,IAAI,CACvB,EAGMe,EAAiBhB,EACnBR,EAAY,OAAOyB,GAAQA,EAAK,YAAcjB,EAAc,SAAS,EACrE,CAAA,EAEJ,OAAKZ,QASF8B,EAAA,CAAe,KAAA/B,EACd,gBAAC,MAAA,CAAI,UAAWgC,EAAO,cAErB,SAAA,CAAAC,EAAAA,KAAC,MAAA,CAAI,UAAWD,EAAO,WACrB,SAAA,CAAAE,EAAAA,IAAC,KAAA,CAAG,UAAWF,EAAO,UAAW,SAAA,mBAAgB,EAEjDC,EAAAA,KAAC,MAAA,CAAI,UAAWD,EAAO,cACrB,SAAA,CAAAE,EAAAA,IAAC,SAAA,CACC,UAAW,GAAGF,EAAO,YAAY,IAAIvB,IAAe,MAAQuB,EAAO,OAAS,EAAE,GAC9E,QAAS,IAAMZ,EAAmB,KAAK,EACxC,SAAA,KAAA,CAAA,EAGDc,EAAAA,IAAC,SAAA,CACC,UAAW,GAAGF,EAAO,YAAY,IAAIvB,IAAe,QAAUuB,EAAO,OAAS,EAAE,GAChF,QAAS,IAAMZ,EAAmB,OAAO,EAC1C,SAAA,WAAA,CAAA,EAGDc,EAAAA,IAAC,SAAA,CACC,UAAW,GAAGF,EAAO,YAAY,IAAIvB,IAAe,KAAOuB,EAAO,OAAS,EAAE,GAC7E,QAAS,IAAMZ,EAAmB,IAAI,EACvC,SAAA,YAAA,CAAA,CAED,CAAA,CACF,CAAA,EACF,EAGC,CAACd,GAAW,CAACC,GACZ2B,EAAAA,IAAC,OAAI,UAAWF,EAAO,UACrB,SAAAC,EAAAA,KAAC,IAAA,CACE,SAAA,CAAAf,EAAkB,OAAO,IAAE,IAC3BA,EAAkB,SAAW,EAAI,UACjCA,EAAkB,OAAS,GAAKA,EAAkB,OAAS,EAAI,WAC/D,WAAA,CAAA,CACH,CAAA,CACF,EAIDZ,SACE,MAAA,CAAI,UAAW0B,EAAO,iBACrB,SAAAE,EAAAA,IAAC,IAAA,CAAE,SAAA,8BAAA,CAA4B,CAAA,CACjC,EAGD3B,GACC2B,EAAAA,IAAC,MAAA,CAAI,UAAWF,EAAO,aACrB,gBAAC,IAAA,CAAE,SAAA,CAAA,oBAAkBzB,EAAM,SAAW,oBAAA,CAAA,CAAqB,CAAA,CAC7D,EAID,CAACD,GAAW,CAACC,GACZ2B,EAAAA,IAAAC,EAAAA,SAAA,CACG,SAAAjB,EAAkB,SAAW,EAC5Be,EAAAA,KAAC,MAAA,CAAI,UAAWD,EAAO,WACrB,SAAA,CAAAE,EAAAA,IAAC,MAAA,CAAI,UAAWF,EAAO,UAAW,SAAA,KAAE,EACpCE,EAAAA,IAAC,IAAA,CAAE,UAAWF,EAAO,WAAY,SAAA,wBAAqB,EACtDE,EAAAA,IAAC,IAAA,CAAE,UAAWF,EAAO,UAAW,SAAA,sDAAA,CAEhC,CAAA,CAAA,CACF,EAEAE,EAAAA,IAAC,MAAA,CAAI,UAAWF,EAAO,UACpB,SAAAd,EAAkB,IAAKC,GAAA,OACtBc,OAAAA,EAAAA,KAAC,MAAA,CAAsB,UAAWD,EAAO,iBACvC,SAAA,CAAAE,EAAAA,IAACE,EAAA,CACC,MAAOjB,EACP,aAAcA,EAAK,YAAc,KACjC,UAAUkB,EAAA7B,EAAgBW,EAAK,MAAM,IAA3B,YAAAkB,EAA+B7B,EAAgBW,EAAK,MAAM,EAAE,OAAS,EAAC,CAAA,EAElFe,EAAAA,IAAC,SAAA,CACC,UAAWF,EAAO,WAClB,QAAS,IAAMV,EAAiBH,CAAI,EACpC,MAAM,uBACP,SAAA,wBAAA,CAAA,CAED,CAAA,EAZQA,EAAK,MAaf,EACD,CAAA,CACH,CAAA,CAEJ,EAIDT,GAAiBG,GAChBqB,EAAAA,IAAC,OAAI,UAAWF,EAAO,aAAc,QAASJ,EAC5C,gBAAC,MAAA,CAAI,UAAWI,EAAO,MAAO,QAAUM,GAAMA,EAAE,kBAC9C,SAAA,CAAAL,EAAAA,KAAC,MAAA,CAAI,UAAWD,EAAO,YACrB,SAAA,CAAAE,EAAAA,IAAC,KAAA,CAAG,UAAWF,EAAO,WAAY,SAAA,kBAAe,EACjDE,EAAAA,IAAC,SAAA,CACC,UAAWF,EAAO,WAClB,QAASJ,EACV,SAAA,GAAA,CAAA,CAED,EACF,EAEAK,EAAAA,KAAC,MAAA,CAAI,UAAWD,EAAO,aACrB,SAAA,CAAAC,EAAAA,KAAC,IAAA,CAAE,UAAWD,EAAO,cAAe,SAAA,CAAA,gBACpBnB,EAAc,MAAM,MAAA,EACpC,EAECgB,EAAe,SAAW,SACxB,MAAA,CAAI,UAAWG,EAAO,QACrB,SAAA,CAAAC,OAAC,IAAA,CAAE,SAAA,CAAA,yBAAuBpB,EAAc,YAAc,QAAU,UAAY,UAAA,EAAW,EACvFqB,EAAAA,IAAC,IAAA,CAAE,UAAWF,EAAO,YAAa,SAAA,0CAAA,CAElC,CAAA,CAAA,CACF,QAEC,MAAA,CAAI,UAAWA,EAAO,YACpB,SAAAH,EAAe,IAAKC,GAAA,OACnBG,OAAAA,EAAAA,KAAC,SAAA,CAEC,UAAWD,EAAO,WAClB,QAAS,IAAMR,EAAiBM,EAAK,EAAE,EAEvC,SAAA,CAAAI,MAAC,OAAA,CAAK,UAAWF,EAAO,eAAiB,WAAK,KAAK,EACnDC,EAAAA,KAAC,OAAA,CAAK,UAAWD,EAAO,gBACrB,SAAA,GAAAK,EAAAP,EAAK,QAAL,YAAAO,EAAY,SAAU,EAAE,YAAA,CAAA,CAC3B,CAAA,CAAA,EAPKP,EAAK,EAAA,EASb,CAAA,CACH,CAAA,CAAA,CAEJ,CAAA,CAAA,CACF,CAAA,CACF,CAAA,CAAA,CAEJ,CAAA,CACF,EA7IEI,EAAAA,IAAC,OAAI,UAAWF,EAAO,eACrB,SAAAE,EAAAA,IAAC,IAAA,CAAE,qCAAyB,CAAA,CAC9B,CA6IN"}