{"version":3,"file":"LoginPage-C2osbfLz.js","sources":["../../src/pages/LoginPage.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { useNavigate, useSearchParams } from 'react-router-dom';\r\nimport { useAppDispatch } from '../hooks/useAppDispatch';\r\nimport { useAppSelector } from '../hooks/useAppSelector';\r\nimport { login } from '../store/slices/authSlice';\r\nimport './LoginPage.css';\r\n\r\n/**\r\n * Страница авторизации через Telegram\r\n * Автоматически авторизует пользователя по токену из URL параметров\r\n */\r\nfunction LoginPage() {\r\n  const [searchParams] = useSearchParams();\r\n  const navigate = useNavigate();\r\n  const dispatch = useAppDispatch();\r\n  \r\n  const { isAuthenticated, loading, error } = useAppSelector((state) => state.auth);\r\n  const [authAttempted, setAuthAttempted] = useState(false);\r\n\r\n  useEffect(() => {\r\n    // Если уже авторизован, перенаправляем на главную\r\n    if (isAuthenticated) {\r\n      navigate('/', { replace: true });\r\n      return;\r\n    }\r\n\r\n    // Получаем токен из URL параметров\r\n    const token = searchParams.get('token');\r\n    const userId = searchParams.get('userId');\r\n    const username = searchParams.get('username');\r\n    const displayName = searchParams.get('displayName');\r\n    const avatarUrl = searchParams.get('avatarUrl');\r\n\r\n    // Если есть токен и данные пользователя, пытаемся авторизоваться\r\n    if (token && userId && !authAttempted) {\r\n      setAuthAttempted(true);\r\n      \r\n      // Сохраняем токен в localStorage\r\n      localStorage.setItem('authToken', token);\r\n      \r\n      // Отправляем данные для авторизации\r\n      dispatch(login({\r\n        token,\r\n        userId,\r\n        username,\r\n        displayName,\r\n        avatarUrl\r\n      }));\r\n    }\r\n  }, [searchParams, isAuthenticated, navigate, dispatch, authAttempted]);\r\n\r\n  // Если идет загрузка\r\n  if (loading) {\r\n    return (\r\n      <div className=\"login-page\">\r\n        <div className=\"login-container\">\r\n          <div className=\"login-card\">\r\n            <div className=\"login-logo\">\r\n              <h1>watchRebel</h1>\r\n              <p className=\"login-subtitle\">Социальная сеть для любителей кино</p>\r\n            </div>\r\n            <div className=\"login-loading\">\r\n              <div className=\"spinner\"></div>\r\n              <p>Авторизация...</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Если есть ошибка\r\n  if (error) {\r\n    return (\r\n      <div className=\"login-page\">\r\n        <div className=\"login-container\">\r\n          <div className=\"login-card\">\r\n            <div className=\"login-logo\">\r\n              <h1>watchRebel</h1>\r\n              <p className=\"login-subtitle\">Социальная сеть для любителей кино</p>\r\n            </div>\r\n            <div className=\"login-error\">\r\n              <div className=\"error-icon\">⚠️</div>\r\n              <h2>Ошибка авторизации</h2>\r\n              <p>{error.message || 'Не удалось авторизоваться'}</p>\r\n              <button \r\n                className=\"retry-button\"\r\n                onClick={() => window.location.href = '/'}\r\n              >\r\n                Попробовать снова\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Страница приглашения авторизоваться через Telegram\r\n  return (\r\n    <div className=\"login-page\">\r\n      <div className=\"login-container\">\r\n        <div className=\"login-card\">\r\n          <div className=\"login-logo\">\r\n            <h1>watchRebel</h1>\r\n            <p className=\"login-subtitle\">Социальная сеть для любителей кино</p>\r\n          </div>\r\n          \r\n          <div className=\"login-content\">\r\n            <div className=\"login-icon\">\r\n              <img src=\"/images/logo-animation.gif\" alt=\"watchRebel\" />\r\n            </div>\r\n            <h2>Добро пожаловать!</h2>\r\n            <p className=\"login-description\">\r\n              Ведите учет просмотренных фильмов и сериалов, делитесь отзывами \r\n              и находите друзей с похожими вкусами\r\n            </p>\r\n            \r\n            <div className=\"login-instructions\">\r\n              <h3>Как начать:</h3>\r\n              <ol>\r\n                <li>Откройте Telegram бота watchRebel</li>\r\n                <li>Нажмите команду /start</li>\r\n                <li>Перейдите по ссылке из бота</li>\r\n              </ol>\r\n            </div>\r\n\r\n            <div className=\"login-telegram\">\r\n              <a \r\n                href={`https://t.me/${import.meta.env.VITE_TELEGRAM_BOT_USERNAME || 'watchrebel_bot'}`}\r\n                className=\"telegram-button\"\r\n                target=\"_blank\"\r\n                rel=\"noopener noreferrer\"\r\n              >\r\n                <span className=\"telegram-icon\">\r\n                  <img src=\"/images/telegram-icon.png\" alt=\"Telegram\" />\r\n                </span>\r\n                Открыть Telegram бота\r\n              </a>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default LoginPage;\r\n"],"names":["LoginPage","searchParams","useSearchParams","navigate","useNavigate","dispatch","useAppDispatch","isAuthenticated","loading","error","useAppSelector","state","authAttempted","setAuthAttempted","useState","useEffect","token","userId","username","displayName","avatarUrl","login","jsx","jsxs"],"mappings":"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"}