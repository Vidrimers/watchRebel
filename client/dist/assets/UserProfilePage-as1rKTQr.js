import{r as h,j as e,b as P,a as B,c as w,d as D,f as S,e as R,g as L}from"./index-BGc1Rv-X.js";import{U as H,a as E}from"./UserPageLayout-Cne3eD7Q.js";const F="_reactionPicker_wifv9_3",U="_pickerHeader_wifv9_57",$="_pickerTitle_wifv9_75",A="_closeButton_wifv9_87",M="_emojiGrid_wifv9_133",G="_emojiButton_wifv9_145",p={reactionPicker:F,pickerHeader:U,pickerTitle:$,closeButton:A,emojiGrid:M,emojiButton:G},V=({onSelect:t,onClose:n})=>{const d=h.useRef(null),m=["‚ù§Ô∏è","üëç","üòÇ","üòÆ","üò¢","üò°","üî•","üëè","üéâ","üíØ","ü§î","üòç","ü§©","üòé","ü•≥","üò±","ü§Ø","üëÄ"];h.useEffect(()=>{const a=o=>{d.current&&!d.current.contains(o.target)&&n()};return document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[n]),h.useEffect(()=>{const a=o=>{o.key==="Escape"&&n()};return document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}},[n]);const r=a=>{t(a)};return e.jsxs("div",{className:p.reactionPicker,ref:d,children:[e.jsxs("div",{className:p.pickerHeader,children:[e.jsx("span",{className:p.pickerTitle,children:"–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∞–∫—Ü–∏—é"}),e.jsx("button",{className:p.closeButton,onClick:n,"aria-label":"–ó–∞–∫—Ä—ã—Ç—å",children:"√ó"})]}),e.jsx("div",{className:p.emojiGrid,children:m.map(a=>e.jsx("button",{className:p.emojiButton,onClick:()=>r(a),title:a,children:a},a))})]})},W="_wallPost_1yz1y_3",Y="_postContent_1yz1y_29",q="_textContent_1yz1y_39",J="_actionText_1yz1y_59",K="_mediaInfo_1yz1y_73",Q="_mediaDetails_1yz1y_117",X="_mediaTitle_1yz1y_133",Z="_mediaType_1yz1y_149",O="_ratingValue_1yz1y_161",ee="_ratingStars_1yz1y_175",te="_ratingNumber_1yz1y_185",se="_reviewText_1yz1y_199",ne="_postFooter_1yz1y_235",ae="_postDate_1yz1y_251",ie="_reactionsContainer_1yz1y_263",re="_reactionsList_1yz1y_275",oe="_reactionBadge_1yz1y_287",ce="_addReactionContainer_1yz1y_321",le="_addReactionButton_1yz1y_329",s={wallPost:W,postContent:Y,textContent:q,actionText:J,mediaInfo:K,mediaDetails:Q,mediaTitle:X,mediaType:Z,ratingValue:O,ratingStars:ee,ratingNumber:te,reviewText:se,postFooter:ne,postDate:ae,reactionsContainer:ie,reactionsList:re,reactionBadge:oe,addReactionContainer:ce,addReactionButton:le},de=({post:t,isOwnProfile:n})=>{var k,T;const d=P(),m=B(),r=w(i=>i.auth.user),[a,o]=h.useState(!1),f=async i=>{try{await d(D({postId:t.id,emoji:i})).unwrap(),o(!1)}catch(c){console.error("–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–µ–∞–∫—Ü–∏–∏:",c)}},x=i=>{const c=new Date(i),b=new Date,g=b-c,C=Math.floor(g/6e4),z=Math.floor(g/36e5),I=Math.floor(g/864e5);return C<1?"—Ç–æ–ª—å–∫–æ —á—Ç–æ":C<60?`${C} –º–∏–Ω –Ω–∞–∑–∞–¥`:z<24?`${z} —á –Ω–∞–∑–∞–¥`:I<7?`${I} –¥ –Ω–∞–∑–∞–¥`:c.toLocaleDateString("ru-RU",{day:"numeric",month:"short",year:c.getFullYear()!==b.getFullYear()?"numeric":void 0})},j=()=>{t.tmdbId&&t.mediaType&&m(`/media/${t.mediaType}/${t.tmdbId}`)},N=()=>{switch(t.postType){case"text":return e.jsx("div",{className:s.textContent,children:e.jsx("p",{children:t.content})});case"media_added":return e.jsxs("div",{className:s.mediaAddedContent,children:[e.jsxs("p",{className:s.actionText,children:["üìå –î–æ–±–∞–≤–∏–ª",n?"":"–∞"," –≤ —Å–ø–∏—Å–æ–∫"]}),t.tmdbId&&e.jsx("div",{className:s.mediaInfo,onClick:j,children:e.jsxs("div",{className:s.mediaDetails,children:[e.jsxs("h4",{className:s.mediaTitle,children:[t.mediaType==="movie"?"–§–∏–ª—å–º":"–°–µ—Ä–∏–∞–ª"," (ID: ",t.tmdbId,")"]}),e.jsx("span",{className:s.mediaType,children:t.mediaType==="movie"?"üé¨ –§–∏–ª—å–º":"üì∫ –°–µ—Ä–∏–∞–ª"})]})})]});case"rating":return e.jsxs("div",{className:s.ratingContent,children:[e.jsxs("p",{className:s.actionText,children:["‚≠ê –û—Ü–µ–Ω–∏–ª",n?"":"–∞"]}),t.tmdbId&&e.jsx("div",{className:s.mediaInfo,onClick:j,children:e.jsxs("div",{className:s.mediaDetails,children:[e.jsxs("h4",{className:s.mediaTitle,children:[t.mediaType==="movie"?"–§–∏–ª—å–º":"–°–µ—Ä–∏–∞–ª"," (ID: ",t.tmdbId,")"]}),e.jsxs("div",{className:s.ratingValue,children:[e.jsx("span",{className:s.ratingStars,children:"‚òÖ"}),e.jsxs("span",{className:s.ratingNumber,children:[t.rating,"/10"]})]})]})})]});case"review":return e.jsxs("div",{className:s.reviewContent,children:[e.jsxs("p",{className:s.actionText,children:["‚úçÔ∏è –ù–∞–ø–∏—Å–∞–ª",n?"":"–∞"," –æ—Ç–∑—ã–≤"]}),t.tmdbId&&e.jsx("div",{className:s.mediaInfo,onClick:j,children:e.jsx("div",{className:s.mediaDetails,children:e.jsxs("h4",{className:s.mediaTitle,children:[t.mediaType==="movie"?"–§–∏–ª—å–º":"–°–µ—Ä–∏–∞–ª"," (ID: ",t.tmdbId,")"]})})}),t.content&&e.jsx("div",{className:s.reviewText,children:e.jsx("p",{children:t.content})})]});default:return null}},_=((k=t.reactions)==null?void 0:k.reduce((i,c)=>(i[c.emoji]||(i[c.emoji]={emoji:c.emoji,count:0,users:[]}),i[c.emoji].count++,i[c.emoji].users.push(c.userId),i),{}))||{},y=Object.values(_),v=(T=t.reactions)==null?void 0:T.find(i=>i.userId===(r==null?void 0:r.id));return e.jsxs("div",{className:s.wallPost,children:[e.jsx("div",{className:s.postContent,children:N()}),e.jsxs("div",{className:s.postFooter,children:[e.jsx("span",{className:s.postDate,children:x(t.createdAt)}),e.jsxs("div",{className:s.reactionsContainer,children:[y.length>0&&e.jsx("div",{className:s.reactionsList,children:y.map(i=>e.jsxs("span",{className:s.reactionBadge,title:`${i.count} ${i.count===1?"—Ä–µ–∞–∫—Ü–∏—è":"—Ä–µ–∞–∫—Ü–∏–π"}`,children:[i.emoji," ",i.count]},i.emoji))}),!n&&r&&e.jsxs("div",{className:s.addReactionContainer,children:[e.jsx("button",{className:s.addReactionButton,onClick:()=>o(!a),title:v?"–ò–∑–º–µ–Ω–∏—Ç—å —Ä–µ–∞–∫—Ü–∏—é":"–î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∞–∫—Ü–∏—é",children:v?v.emoji:"üòä"}),a&&e.jsx(V,{onSelect:f,onClose:()=>o(!1)})]})]})]})]})},me="_wall_ijzek_3",_e="_createPostContainer_ijzek_17",ue="_createPostForm_ijzek_33",he="_postInput_ijzek_45",je="_submitButton_ijzek_89",pe="_postsList_ijzek_135",xe="_loading_ijzek_149",fe="_error_ijzek_151",ye="_emptyState_ijzek_177",Ne="_emptyHint_ijzek_205",l={wall:me,createPostContainer:_e,createPostForm:ue,postInput:he,submitButton:je,postsList:pe,loading:xe,error:fe,emptyState:ye,emptyHint:Ne},ve=({userId:t,isOwnProfile:n=!1})=>{const d=P(),{posts:m,loading:r,error:a}=w(_=>_.wall),[o,f]=h.useState(""),[x,j]=h.useState(!1);h.useEffect(()=>{t&&d(S(t))},[d,t]);const N=async _=>{if(_.preventDefault(),!!o.trim()){j(!0);try{await d(R({postType:"text",content:o.trim()})).unwrap(),f("")}catch(y){console.error("–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞:",y)}finally{j(!1)}}};return r&&m.length===0?e.jsx("div",{className:l.wall,children:e.jsx("div",{className:l.loading,children:"–ó–∞–≥—Ä—É–∑–∫–∞..."})}):a?e.jsx("div",{className:l.wall,children:e.jsxs("div",{className:l.error,children:["–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–µ–Ω—ã: ",a.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"]})}):e.jsxs("div",{className:l.wall,children:[n&&e.jsx("div",{className:l.createPostContainer,children:e.jsxs("form",{onSubmit:N,className:l.createPostForm,children:[e.jsx("textarea",{className:l.postInput,placeholder:"–ß—Ç–æ —É –≤–∞—Å –Ω–æ–≤–æ–≥–æ?",value:o,onChange:_=>f(_.target.value),rows:3,disabled:x}),e.jsx("button",{type:"submit",className:l.submitButton,disabled:!o.trim()||x,children:x?"–ü—É–±–ª–∏–∫–∞—Ü–∏—è...":"–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å"})]})}),e.jsx("div",{className:l.postsList,children:m.length===0?e.jsxs("div",{className:l.emptyState,children:[e.jsx("p",{children:"–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π –Ω–∞ —Å—Ç–µ–Ω–µ"}),n&&e.jsx("p",{className:l.emptyHint,children:"–î–æ–±–∞–≤—å—Ç–µ —Ñ–∏–ª—å–º –≤ —Å–ø–∏—Å–æ–∫ –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å!"})]}):m.map(_=>e.jsx(de,{post:_,isOwnProfile:n},_.id))})]})},ge="_profileContainer_27but_1",Ce="_profileHeader_27but_9",we="_profileInfo_27but_31",ke="_profileName_27but_39",Te="_profileUsername_27but_53",be="_wallSection_27but_65",ze="_sectionTitle_27but_79",Ie="_errorContainer_27but_303",u={profileContainer:ge,profileHeader:Ce,profileInfo:we,profileName:ke,profileUsername:Te,wallSection:be,sectionTitle:ze,errorContainer:Ie},De=()=>{const{userId:t}=L(),{user:n,isAuthenticated:d}=w(a=>a.auth),m=(n==null?void 0:n.id)===t,r=m?n:null;return d?r?e.jsx(H,{user:n,children:e.jsxs("div",{className:u.profileContainer,children:[e.jsxs("div",{className:u.profileHeader,children:[e.jsx(E,{user:r,size:"large"}),e.jsxs("div",{className:u.profileInfo,children:[e.jsx("h1",{className:u.profileName,children:r.displayName}),r.telegramUsername&&e.jsxs("p",{className:u.profileUsername,children:["@",r.telegramUsername]})]})]}),e.jsxs("div",{className:u.wallSection,children:[e.jsx("h2",{className:u.sectionTitle,children:"–õ–µ–Ω—Ç–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏"}),e.jsx(ve,{userId:t,isOwnProfile:m})]})]})}):e.jsx("div",{className:u.errorContainer,children:e.jsx("p",{children:"–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è..."})}):e.jsx("div",{className:u.errorContainer,children:e.jsx("p",{children:"–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è"})})};export{De as default};
//# sourceMappingURL=UserProfilePage-as1rKTQr.js.map
