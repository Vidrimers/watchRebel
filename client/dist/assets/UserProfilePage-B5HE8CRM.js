import{c as L,r as l,e as $,j as e,b as k,f as R,g as H,h as E}from"./index-GLrqEWvZ.js";import{U as M,a as F}from"./UserPageLayout-D_nUOe2R.js";import{u as O}from"./useAlert-NXgLQgpe.js";import{u as G}from"./useConfirm-r4lu6ZEG.js";import{W}from"./WallPost-Bjj0hfds.js";import"./ConfirmDialog-Ol20coub.js";const K="_referralStats_1q298_1",z="_statsHeader_1q298_17",J="_statsTitle_1q298_31",Q="_statsCount_1q298_45",V="_countNumber_1q298_65",X="_countLabel_1q298_77",Y="_toggleButton_1q298_89",Z="_referralsList_1q298_125",ee="_referralsItems_1q298_137",te="_referralItem_1q298_149",se="_referralAvatar_1q298_179",ae="_avatarPlaceholder_1q298_209",re="_referralInfo_1q298_233",ne="_referralName_1q298_241",oe="_referralUsername_1q298_255",le="_referralDate_1q298_267",ce="_emptyMessage_1q298_279",ie="_loading_1q298_295",de="_error_1q298_309",a={referralStats:K,statsHeader:z,statsTitle:J,statsCount:Q,countNumber:V,countLabel:X,toggleButton:Y,referralsList:Z,referralsItems:ee,referralItem:te,referralAvatar:se,avatarPlaceholder:ae,referralInfo:re,referralName:ne,referralUsername:oe,referralDate:le,emptyMessage:ce,loading:ie,error:de},ue=({userId:r})=>{const{user:o}=L(t=>t.auth),[d,x]=l.useState(null),[h,v]=l.useState(0),[u,m]=l.useState([]),[_,f]=l.useState(!0),[i,c]=l.useState(!1),[n,g]=l.useState(null),j=(o==null?void 0:o.id)===r;l.useEffect(()=>{j&&p()},[r,j]);const p=async()=>{var t,y,I;try{f(!0),g(null);const C=await $.get(`/users/${r}/referral-code`);x(C.data.referralCode),v(C.data.referralsCount||0),f(!1)}catch(C){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤:",C),((t=C.response)==null?void 0:t.status)===404||((I=(y=C.response)==null?void 0:y.data)==null?void 0:I.code)==="USER_NOT_FOUND"?(x(null),v(0),f(!1)):(g("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É"),f(!1))}},B=async()=>{var t;try{const y=await $.get(`/users/${r}/referrals`);m(y.data)}catch(y){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤:",y),((t=y.response)==null?void 0:t.status)===404?m([]):g("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤")}},q=async()=>{!i&&u.length===0&&await B(),c(!i)};return j?_?e.jsx("div",{className:a.referralStats,children:e.jsx("p",{className:a.loading,children:"–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏..."})}):n?e.jsx("div",{className:a.referralStats,children:e.jsx("p",{className:a.error,children:n})}):e.jsxs("div",{className:a.referralStats,children:[e.jsxs("div",{className:a.statsHeader,children:[e.jsx("h3",{className:a.statsTitle,children:"üë• –ü—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã–µ –¥—Ä—É–∑—å—è"}),e.jsxs("div",{className:a.statsCount,children:[e.jsx("span",{className:a.countNumber,children:h}),e.jsx("span",{className:a.countLabel,children:"–¥—Ä—É–∑–µ–π"})]})]}),h>0&&e.jsx("button",{className:a.toggleButton,onClick:q,children:i?"‚ñº –°–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫":"‚ñ∂ –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫"}),i&&e.jsx("div",{className:a.referralsList,children:u.length===0?e.jsx("p",{className:a.emptyMessage,children:"–ó–∞–≥—Ä—É–∑–∫–∞..."}):e.jsx("ul",{className:a.referralsItems,children:u.map(t=>e.jsxs("li",{className:a.referralItem,children:[e.jsx("div",{className:a.referralAvatar,children:t.avatarUrl?e.jsx("img",{src:t.avatarUrl.startsWith("/uploads/")?`http://localhost:1313${t.avatarUrl}`:t.avatarUrl,alt:t.displayName}):e.jsx("div",{className:a.avatarPlaceholder,children:t.displayName.charAt(0).toUpperCase()})}),e.jsxs("div",{className:a.referralInfo,children:[e.jsx("p",{className:a.referralName,children:t.displayName}),t.telegramUsername&&e.jsxs("p",{className:a.referralUsername,children:["@",t.telegramUsername]}),e.jsxs("p",{className:a.referralDate,children:["–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è: ",new Date(t.referralCreatedAt).toLocaleDateString("ru-RU")]})]})]},t.id))})}),h===0&&e.jsx("p",{className:a.emptyMessage,children:"–í—ã –µ—â–µ –Ω–µ –ø—Ä–∏–≥–ª–∞—Å–∏–ª–∏ –¥—Ä—É–∑–µ–π. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Telegram –±–æ—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏!"})]}):null},me="_moderationPanel_7rr7w_1",_e="_title_7rr7w_17",fe="_actions_7rr7w_29",pe="_button_7rr7w_41",he="_banPostsButton_7rr7w_71",xe="_permanentBanButton_7rr7w_89",Ne="_unbanButton_7rr7w_107",je="_modalOverlay_7rr7w_127",be="_modal_7rr7w_127",ve="_modalTitle_7rr7w_177",ge="_error_7rr7w_189",ye="_formGroup_7rr7w_209",we="_textarea_7rr7w_231",Be="_input_7rr7w_233",Ce="_durationPresets_7rr7w_281",Pe="_presetButton_7rr7w_295",Se="_modalActions_7rr7w_339",$e="_cancelButton_7rr7w_351",s={moderationPanel:me,title:_e,actions:fe,button:pe,banPostsButton:he,permanentBanButton:xe,unbanButton:Ne,modalOverlay:je,modal:be,modalTitle:ve,error:ge,formGroup:ye,textarea:we,input:Be,durationPresets:Ce,presetButton:Pe,modalActions:Se,cancelButton:$e};function Te({userId:r,isAdmin:o,onModerationAction:d}){const{alertDialog:x,showAlert:h}=O(),{confirmDialog:v,showConfirm:u}=G(),[m,_]=l.useState(!1),[f,i]=l.useState(null),[c,n]=l.useState(""),[g,j]=l.useState(1440),[p,B]=l.useState(!1),[q,t]=l.useState(null);if(!o)return null;const y=async()=>{var b,P;if(!c.trim()){t("–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –ø—Ä–∏—á–∏–Ω—É –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏");return}if(g<=0){t("–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ 0");return}B(!0),t(null);try{await $.post(`/admin/users/${r}/ban-posts`,{reason:c.trim(),durationMinutes:g}),_(!1),n(""),j(1440),d&&d("post_ban"),await h({title:"–£—Å–ø–µ—à–Ω–æ",message:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∑–∞–ø—Ä–µ—â–µ–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ—Å—Ç—ã",type:"success"})}catch(S){console.error("–û—à–∏–±–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ—Å—Ç–æ–≤:",S),t(((P=(b=S.response)==null?void 0:b.data)==null?void 0:P.error)||"–û—à–∏–±–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ—Å—Ç–æ–≤")}finally{B(!1)}},I=async()=>{var P,S;if(!c.trim()){t("–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –ø—Ä–∏—á–∏–Ω—É –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏");return}if(await u({title:"–ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞",message:"–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –Ω–∞–≤—Å–µ–≥–¥–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?",confirmText:"–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å",cancelText:"–û—Ç–º–µ–Ω–∞",confirmButtonStyle:"danger"})){B(!0),t(null);try{await $.post(`/admin/users/${r}/ban-permanent`,{reason:c.trim()}),_(!1),n(""),d&&d("permanent_ban"),await h({title:"–£—Å–ø–µ—à–Ω–æ",message:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –Ω–∞–≤—Å–µ–≥–¥–∞",type:"success"})}catch(T){console.error("–û—à–∏–±–∫–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:",T),t(((S=(P=T.response)==null?void 0:P.data)==null?void 0:S.error)||"–û—à–∏–±–∫–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏")}finally{B(!1)}}},C=async()=>{var P,S;if(await u({title:"–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",message:"–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?",confirmText:"–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å",cancelText:"–û—Ç–º–µ–Ω–∞",confirmButtonStyle:"success"})){B(!0),t(null);try{await $.post(`/admin/users/${r}/unban`),d&&d("unban"),await h({title:"–£—Å–ø–µ—à–Ω–æ",message:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω",type:"success"})}catch(T){console.error("–û—à–∏–±–∫–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:",T),t(((S=(P=T.response)==null?void 0:P.data)==null?void 0:S.error)||"–û—à–∏–±–∫–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏")}finally{B(!1)}}},A=()=>{i("posts"),_(!0),t(null)},D=()=>{i("permanent"),_(!0),t(null)},U=()=>{_(!1),i(null),n(""),j(1440),t(null)};return e.jsxs(e.Fragment,{children:[x,v,e.jsxs("div",{className:s.moderationPanel,children:[e.jsx("h3",{className:s.title,children:"‚ö†Ô∏è –ú–æ–¥–µ—Ä–∞—Ü–∏—è"}),e.jsxs("div",{className:s.actions,children:[e.jsx("button",{className:`${s.button} ${s.banPostsButton}`,onClick:A,disabled:p,children:"üö´ –ó–∞–ø—Ä–µ—Ç–∏—Ç—å –ø–æ—Å—Ç—ã"}),e.jsx("button",{className:`${s.button} ${s.permanentBanButton}`,onClick:D,disabled:p,children:"‚õî –ó–∞–±–∞–Ω–∏—Ç—å –Ω–∞–≤—Å–µ–≥–¥–∞"}),e.jsx("button",{className:`${s.button} ${s.unbanButton}`,onClick:C,disabled:p,children:"‚úÖ –†–∞–∑–±–∞–Ω–∏—Ç—å"})]}),m&&e.jsx("div",{className:s.modalOverlay,onClick:U,children:e.jsxs("div",{className:s.modal,onClick:b=>b.stopPropagation(),children:[e.jsx("h3",{className:s.modalTitle,children:f==="posts"?"üö´ –ó–∞–ø—Ä–µ—Ç–∏—Ç—å –ø–æ—Å—Ç—ã":"‚õî –ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞"}),q&&e.jsx("div",{className:s.error,children:q}),e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"reason",children:"–ü—Ä–∏—á–∏–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:"}),e.jsx("textarea",{id:"reason",className:s.textarea,value:c,onChange:b=>n(b.target.value),placeholder:"–£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏...",rows:4,disabled:p})]}),f==="posts"&&e.jsxs("div",{className:s.formGroup,children:[e.jsx("label",{htmlFor:"duration",children:"–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–∏–Ω—É—Ç—ã):"}),e.jsx("input",{id:"duration",type:"number",className:s.input,value:g,onChange:b=>j(parseInt(b.target.value)||0),min:"1",disabled:p}),e.jsxs("div",{className:s.durationPresets,children:[e.jsx("button",{className:s.presetButton,onClick:()=>j(60),disabled:p,children:"1 —á–∞—Å"}),e.jsx("button",{className:s.presetButton,onClick:()=>j(1440),disabled:p,children:"1 –¥–µ–Ω—å"}),e.jsx("button",{className:s.presetButton,onClick:()=>j(10080),disabled:p,children:"1 –Ω–µ–¥–µ–ª—è"}),e.jsx("button",{className:s.presetButton,onClick:()=>j(43200),disabled:p,children:"1 –º–µ—Å—è—Ü"})]})]}),e.jsxs("div",{className:s.modalActions,children:[e.jsx("button",{className:`${s.button} ${s.cancelButton}`,onClick:U,disabled:p,children:"–û—Ç–º–µ–Ω–∞"}),e.jsx("button",{className:`${s.button} ${f==="posts"?s.banPostsButton:s.permanentBanButton}`,onClick:f==="posts"?y:I,disabled:p,children:p?"–û–±—Ä–∞–±–æ—Ç–∫–∞...":"–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å"})]})]})})]})]})}const qe="_wall_1v69n_3",Ie="_createPostContainer_1v69n_17",Le="_createPostForm_1v69n_33",Ue="_postInput_1v69n_45",Ae="_submitButton_1v69n_89",De="_postsList_1v69n_135",ke="_loading_1v69n_149",Re="_error_1v69n_151",He="_emptyState_1v69n_177",Ee="_emptyHint_1v69n_205",N={wall:qe,createPostContainer:Ie,createPostForm:Le,postInput:Ue,submitButton:Ae,postsList:De,loading:ke,error:Re,emptyState:He,emptyHint:Ee},Me=({userId:r,isOwnProfile:o=!1})=>{const d=k(),{posts:x,loading:h,error:v}=L(n=>n.wall),[u,m]=l.useState(""),[_,f]=l.useState(!1);l.useEffect(()=>{r&&d(R(r))},[d,r]);const i=async n=>{if(n.preventDefault(),!!u.trim()){f(!0);try{await d(H({postType:"text",content:u.trim()})).unwrap(),m("")}catch(g){console.error("–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞:",g)}finally{f(!1)}}},c=n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),i(n))};return h&&x.length===0?e.jsx("div",{className:N.wall,children:e.jsx("div",{className:N.loading,children:"–ó–∞–≥—Ä—É–∑–∫–∞..."})}):v?e.jsx("div",{className:N.wall,children:e.jsxs("div",{className:N.error,children:["–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–µ–Ω—ã: ",v.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"]})}):e.jsxs("div",{className:N.wall,children:[o&&e.jsx("div",{className:N.createPostContainer,children:e.jsxs("form",{onSubmit:i,className:N.createPostForm,children:[e.jsx("textarea",{className:N.postInput,placeholder:"–ß—Ç–æ —É –≤–∞—Å –Ω–æ–≤–æ–≥–æ?",value:u,onChange:n=>m(n.target.value),onKeyDown:c,rows:3,disabled:_}),e.jsx("button",{type:"submit",className:N.submitButton,disabled:!u.trim()||_,children:_?"–ü—É–±–ª–∏–∫–∞—Ü–∏—è...":"–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å"})]})}),e.jsx("div",{className:N.postsList,children:x.length===0?e.jsxs("div",{className:N.emptyState,children:[e.jsx("p",{children:"–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π –Ω–∞ —Å—Ç–µ–Ω–µ"}),o&&e.jsx("p",{className:N.emptyHint,children:"–î–æ–±–∞–≤—å—Ç–µ —Ñ–∏–ª—å–º –≤ —Å–ø–∏—Å–æ–∫ –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å!"})]}):x.map(n=>e.jsx(W,{post:n,isOwnProfile:o},n.id))})]})},Fe="_profileContainer_27but_1",Oe="_profileHeader_27but_9",Ge="_profileInfo_27but_31",We="_profileName_27but_39",Ke="_wallSection_27but_65",ze="_sectionTitle_27but_79",Je="_errorContainer_27but_303",w={profileContainer:Fe,profileHeader:Oe,profileInfo:Ge,profileName:We,wallSection:Ke,sectionTitle:ze,errorContainer:Je},tt=()=>{const{userId:r}=E(),{user:o,isAuthenticated:d}=L(i=>i.auth),[x,h]=l.useState(null),[v,u]=l.useState(!0),m=(o==null?void 0:o.id)===r,_=(o==null?void 0:o.isAdmin)||!1;l.useEffect(()=>{d&&r&&(async()=>{try{if(u(!0),m){h(o),u(!1);return}const c=await $.get(`/users/${r}`);h(c.data)}catch(c){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è:",c)}finally{u(!1)}})()},[r,d,m,o]);const f=async i=>{console.log("–î–µ–π—Å—Ç–≤–∏–µ –º–æ–¥–µ—Ä–∞—Ü–∏–∏:",i);try{const c=await $.get(`/users/${r}`);h(c.data)}catch(c){console.error("–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è:",c)}};return d?v?e.jsx("div",{className:w.errorContainer,children:e.jsx("p",{children:"–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è..."})}):x?e.jsx(M,{user:o,children:e.jsxs("div",{className:w.profileContainer,children:[!m&&e.jsxs("div",{className:w.profileHeader,children:[e.jsx(F,{user:x,size:"large",showBanIndicator:!0}),e.jsx("div",{className:w.profileInfo,children:e.jsx("h1",{className:w.profileName,children:x.displayName})})]}),_&&!m&&e.jsx(Te,{userId:r,isAdmin:_,onModerationAction:f}),m&&e.jsx(ue,{userId:r}),e.jsxs("div",{className:w.wallSection,children:[e.jsx("h2",{className:w.sectionTitle,children:"–õ–µ–Ω—Ç–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏"}),e.jsx(Me,{userId:r,isOwnProfile:m})]})]})}):e.jsx("div",{className:w.errorContainer,children:e.jsx("p",{children:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω"})}):e.jsx("div",{className:w.errorContainer,children:e.jsx("p",{children:"–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è"})})};export{tt as default};
//# sourceMappingURL=UserProfilePage-B5HE8CRM.js.map
