import{d as k,e as T,A as H,N as $,f as A,r as p,j as e,b as D,a as F,c as b,g as U}from"./index-Djl9NHxl.js";import{U as M,a as G}from"./UserPageLayout-C8vKA2h1.js";import"./mediaSlice-Cc1A5Hw2.js";import"./notificationsSlice-B12J8AxD.js";const z=(t,s)=>t instanceof H?s(t.data||t.message):t instanceof $?s({message:t.message}):s({message:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"}),C=k("wall/fetchWall",async(t,{rejectWithValue:s})=>{try{return(await T.get(`/wall/${t}`)).data}catch(n){return z(n,s)}}),E=k("wall/createPost",async(t,{rejectWithValue:s})=>{try{return(await T.post("/wall",t)).data}catch(n){return z(n,s)}}),L=k("wall/addReaction",async({postId:t,emoji:s},{rejectWithValue:n})=>{try{const o=await T.post(`/wall/${t}/reactions`,{emoji:s});return{postId:t,reaction:o.data}}catch(o){return z(o,n)}});A({name:"wall",initialState:{posts:[],loading:!1,error:null},reducers:{},extraReducers:t=>{t.addCase(C.pending,s=>{s.loading=!0}).addCase(C.fulfilled,(s,n)=>{s.posts=n.payload,s.loading=!1}).addCase(E.fulfilled,(s,n)=>{s.posts.unshift(n.payload)}).addCase(L.fulfilled,(s,n)=>{const o=s.posts.find(c=>c.id===n.payload.postId);o&&o.reactions.push(n.payload.reaction)})}});const V="_reactionPicker_wifv9_3",W="_pickerHeader_wifv9_57",Y="_pickerTitle_wifv9_75",q="_closeButton_wifv9_87",J="_emojiGrid_wifv9_133",K="_emojiButton_wifv9_145",f={reactionPicker:V,pickerHeader:W,pickerTitle:Y,closeButton:q,emojiGrid:J,emojiButton:K},Q=({onSelect:t,onClose:s})=>{const n=p.useRef(null),o=["‚ù§Ô∏è","üëç","üòÇ","üòÆ","üò¢","üò°","üî•","üëè","üéâ","üíØ","ü§î","üòç","ü§©","üòé","ü•≥","üò±","ü§Ø","üëÄ"];p.useEffect(()=>{const i=l=>{n.current&&!n.current.contains(l.target)&&s()};return document.addEventListener("mousedown",i),()=>{document.removeEventListener("mousedown",i)}},[s]),p.useEffect(()=>{const i=l=>{l.key==="Escape"&&s()};return document.addEventListener("keydown",i),()=>{document.removeEventListener("keydown",i)}},[s]);const c=i=>{t(i)};return e.jsxs("div",{className:f.reactionPicker,ref:n,children:[e.jsxs("div",{className:f.pickerHeader,children:[e.jsx("span",{className:f.pickerTitle,children:"–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∞–∫—Ü–∏—é"}),e.jsx("button",{className:f.closeButton,onClick:s,"aria-label":"–ó–∞–∫—Ä—ã—Ç—å",children:"√ó"})]}),e.jsx("div",{className:f.emojiGrid,children:o.map(i=>e.jsx("button",{className:f.emojiButton,onClick:()=>c(i),title:i,children:i},i))})]})},X="_wallPost_1yz1y_3",Z="_postContent_1yz1y_29",O="_textContent_1yz1y_39",ee="_actionText_1yz1y_59",te="_mediaInfo_1yz1y_73",se="_mediaDetails_1yz1y_117",ae="_mediaTitle_1yz1y_133",ne="_mediaType_1yz1y_149",ie="_ratingValue_1yz1y_161",re="_ratingStars_1yz1y_175",oe="_ratingNumber_1yz1y_185",ce="_reviewText_1yz1y_199",le="_postFooter_1yz1y_235",de="_postDate_1yz1y_251",me="_reactionsContainer_1yz1y_263",ue="_reactionsList_1yz1y_275",_e="_reactionBadge_1yz1y_287",pe="_addReactionContainer_1yz1y_321",he="_addReactionButton_1yz1y_329",a={wallPost:X,postContent:Z,textContent:O,actionText:ee,mediaInfo:te,mediaDetails:se,mediaTitle:ae,mediaType:ne,ratingValue:ie,ratingStars:re,ratingNumber:oe,reviewText:ce,postFooter:le,postDate:de,reactionsContainer:me,reactionsList:ue,reactionBadge:_e,addReactionContainer:pe,addReactionButton:he},fe=({post:t,isOwnProfile:s})=>{var I,P;const n=D(),o=F(),c=b(r=>r.auth.user),[i,l]=p.useState(!1),x=async r=>{try{await n(L({postId:t.id,emoji:r})).unwrap(),l(!1)}catch(d){console.error("–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–µ–∞–∫—Ü–∏–∏:",d)}},j=r=>{const d=new Date(r),S=new Date,g=S-d,w=Math.floor(g/6e4),R=Math.floor(g/36e5),B=Math.floor(g/864e5);return w<1?"—Ç–æ–ª—å–∫–æ —á—Ç–æ":w<60?`${w} –º–∏–Ω –Ω–∞–∑–∞–¥`:R<24?`${R} —á –Ω–∞–∑–∞–¥`:B<7?`${B} –¥ –Ω–∞–∑–∞–¥`:d.toLocaleDateString("ru-RU",{day:"numeric",month:"short",year:d.getFullYear()!==S.getFullYear()?"numeric":void 0})},h=()=>{t.tmdbId&&t.mediaType&&o(`/media/${t.mediaType}/${t.tmdbId}`)},N=()=>{switch(t.postType){case"text":return e.jsx("div",{className:a.textContent,children:e.jsx("p",{children:t.content})});case"media_added":return e.jsxs("div",{className:a.mediaAddedContent,children:[e.jsxs("p",{className:a.actionText,children:["üìå –î–æ–±–∞–≤–∏–ª",s?"":"–∞"," –≤ —Å–ø–∏—Å–æ–∫"]}),t.tmdbId&&e.jsx("div",{className:a.mediaInfo,onClick:h,children:e.jsxs("div",{className:a.mediaDetails,children:[e.jsxs("h4",{className:a.mediaTitle,children:[t.mediaType==="movie"?"–§–∏–ª—å–º":"–°–µ—Ä–∏–∞–ª"," (ID: ",t.tmdbId,")"]}),e.jsx("span",{className:a.mediaType,children:t.mediaType==="movie"?"üé¨ –§–∏–ª—å–º":"üì∫ –°–µ—Ä–∏–∞–ª"})]})})]});case"rating":return e.jsxs("div",{className:a.ratingContent,children:[e.jsxs("p",{className:a.actionText,children:["‚≠ê –û—Ü–µ–Ω–∏–ª",s?"":"–∞"]}),t.tmdbId&&e.jsx("div",{className:a.mediaInfo,onClick:h,children:e.jsxs("div",{className:a.mediaDetails,children:[e.jsxs("h4",{className:a.mediaTitle,children:[t.mediaType==="movie"?"–§–∏–ª—å–º":"–°–µ—Ä–∏–∞–ª"," (ID: ",t.tmdbId,")"]}),e.jsxs("div",{className:a.ratingValue,children:[e.jsx("span",{className:a.ratingStars,children:"‚òÖ"}),e.jsxs("span",{className:a.ratingNumber,children:[t.rating,"/10"]})]})]})})]});case"review":return e.jsxs("div",{className:a.reviewContent,children:[e.jsxs("p",{className:a.actionText,children:["‚úçÔ∏è –ù–∞–ø–∏—Å–∞–ª",s?"":"–∞"," –æ—Ç–∑—ã–≤"]}),t.tmdbId&&e.jsx("div",{className:a.mediaInfo,onClick:h,children:e.jsx("div",{className:a.mediaDetails,children:e.jsxs("h4",{className:a.mediaTitle,children:[t.mediaType==="movie"?"–§–∏–ª—å–º":"–°–µ—Ä–∏–∞–ª"," (ID: ",t.tmdbId,")"]})})}),t.content&&e.jsx("div",{className:a.reviewText,children:e.jsx("p",{children:t.content})})]});default:return null}},u=((I=t.reactions)==null?void 0:I.reduce((r,d)=>(r[d.emoji]||(r[d.emoji]={emoji:d.emoji,count:0,users:[]}),r[d.emoji].count++,r[d.emoji].users.push(d.userId),r),{}))||{},y=Object.values(u),v=(P=t.reactions)==null?void 0:P.find(r=>r.userId===(c==null?void 0:c.id));return e.jsxs("div",{className:a.wallPost,children:[e.jsx("div",{className:a.postContent,children:N()}),e.jsxs("div",{className:a.postFooter,children:[e.jsx("span",{className:a.postDate,children:j(t.createdAt)}),e.jsxs("div",{className:a.reactionsContainer,children:[y.length>0&&e.jsx("div",{className:a.reactionsList,children:y.map(r=>e.jsxs("span",{className:a.reactionBadge,title:`${r.count} ${r.count===1?"—Ä–µ–∞–∫—Ü–∏—è":"—Ä–µ–∞–∫—Ü–∏–π"}`,children:[r.emoji," ",r.count]},r.emoji))}),!s&&c&&e.jsxs("div",{className:a.addReactionContainer,children:[e.jsx("button",{className:a.addReactionButton,onClick:()=>l(!i),title:v?"–ò–∑–º–µ–Ω–∏—Ç—å —Ä–µ–∞–∫—Ü–∏—é":"–î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∞–∫—Ü–∏—é",children:v?v.emoji:"üòä"}),i&&e.jsx(Q,{onSelect:x,onClose:()=>l(!1)})]})]})]})]})},je="_wall_ijzek_3",xe="_createPostContainer_ijzek_17",ye="_createPostForm_ijzek_33",Ne="_postInput_ijzek_45",ve="_submitButton_ijzek_89",ge="_postsList_ijzek_135",we="_loading_ijzek_149",Ce="_error_ijzek_151",ke="_emptyState_ijzek_177",Te="_emptyHint_ijzek_205",m={wall:je,createPostContainer:xe,createPostForm:ye,postInput:Ne,submitButton:ve,postsList:ge,loading:we,error:Ce,emptyState:ke,emptyHint:Te},be=({userId:t,isOwnProfile:s=!1})=>{const n=D(),{posts:o,loading:c,error:i}=b(u=>u.wall),[l,x]=p.useState(""),[j,h]=p.useState(!1);p.useEffect(()=>{t&&n(C(t))},[n,t]);const N=async u=>{if(u.preventDefault(),!!l.trim()){h(!0);try{await n(E({postType:"text",content:l.trim()})).unwrap(),x("")}catch(y){console.error("–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞:",y)}finally{h(!1)}}};return c&&o.length===0?e.jsx("div",{className:m.wall,children:e.jsx("div",{className:m.loading,children:"–ó–∞–≥—Ä—É–∑–∫–∞..."})}):i?e.jsx("div",{className:m.wall,children:e.jsxs("div",{className:m.error,children:["–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–µ–Ω—ã: ",i.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"]})}):e.jsxs("div",{className:m.wall,children:[s&&e.jsx("div",{className:m.createPostContainer,children:e.jsxs("form",{onSubmit:N,className:m.createPostForm,children:[e.jsx("textarea",{className:m.postInput,placeholder:"–ß—Ç–æ —É –≤–∞—Å –Ω–æ–≤–æ–≥–æ?",value:l,onChange:u=>x(u.target.value),rows:3,disabled:j}),e.jsx("button",{type:"submit",className:m.submitButton,disabled:!l.trim()||j,children:j?"–ü—É–±–ª–∏–∫–∞—Ü–∏—è...":"–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å"})]})}),e.jsx("div",{className:m.postsList,children:o.length===0?e.jsxs("div",{className:m.emptyState,children:[e.jsx("p",{children:"–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π –Ω–∞ —Å—Ç–µ–Ω–µ"}),s&&e.jsx("p",{className:m.emptyHint,children:"–î–æ–±–∞–≤—å—Ç–µ —Ñ–∏–ª—å–º –≤ —Å–ø–∏—Å–æ–∫ –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å!"})]}):o.map(u=>e.jsx(fe,{post:u,isOwnProfile:s},u.id))})]})},ze="_profileContainer_27but_1",Ie="_profileHeader_27but_9",Pe="_profileInfo_27but_31",Se="_profileName_27but_39",Re="_profileUsername_27but_53",Be="_wallSection_27but_65",De="_sectionTitle_27but_79",Ee="_errorContainer_27but_303",_={profileContainer:ze,profileHeader:Ie,profileInfo:Pe,profileName:Se,profileUsername:Re,wallSection:Be,sectionTitle:De,errorContainer:Ee},Fe=()=>{const{userId:t}=U(),{user:s,isAuthenticated:n}=b(i=>i.auth),o=(s==null?void 0:s.id)===t,c=o?s:null;return n?c?e.jsx(M,{user:s,children:e.jsxs("div",{className:_.profileContainer,children:[e.jsxs("div",{className:_.profileHeader,children:[e.jsx(G,{user:c,size:"large"}),e.jsxs("div",{className:_.profileInfo,children:[e.jsx("h1",{className:_.profileName,children:c.displayName}),c.telegramUsername&&e.jsxs("p",{className:_.profileUsername,children:["@",c.telegramUsername]})]})]}),e.jsxs("div",{className:_.wallSection,children:[e.jsx("h2",{className:_.sectionTitle,children:"–õ–µ–Ω—Ç–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏"}),e.jsx(be,{userId:t,isOwnProfile:o})]})]})}):e.jsx("div",{className:_.errorContainer,children:e.jsx("p",{children:"–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è..."})}):e.jsx("div",{className:_.errorContainer,children:e.jsx("p",{children:"–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è"})})};export{Fe as default};
//# sourceMappingURL=UserProfilePage-e_jb8Hmo.js.map
