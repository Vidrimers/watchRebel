{"version":3,"file":"notificationsSlice-B12J8AxD.js","sources":["../../src/store/slices/notificationsSlice.js"],"sourcesContent":["import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\r\nimport api, { APIError, NetworkError } from '../../services/api';\r\n\r\n// Вспомогательная функция для обработки ошибок\r\nconst handleError = (error, rejectWithValue) => {\r\n  if (error instanceof APIError) {\r\n    return rejectWithValue(error.data || error.message);\r\n  } else if (error instanceof NetworkError) {\r\n    return rejectWithValue({ message: error.message });\r\n  }\r\n  return rejectWithValue({ message: 'Неизвестная ошибка' });\r\n};\r\n\r\nexport const fetchNotifications = createAsyncThunk(\r\n  'notifications/fetchNotifications',\r\n  async (_, { rejectWithValue }) => {\r\n    try {\r\n      const response = await api.get('/notifications');\r\n      return response.data;\r\n    } catch (error) {\r\n      return handleError(error, rejectWithValue);\r\n    }\r\n  }\r\n);\r\n\r\nexport const markAsRead = createAsyncThunk(\r\n  'notifications/markAsRead',\r\n  async (notificationId, { rejectWithValue }) => {\r\n    try {\r\n      await api.put(`/notifications/${notificationId}/read`);\r\n      return notificationId;\r\n    } catch (error) {\r\n      return handleError(error, rejectWithValue);\r\n    }\r\n  }\r\n);\r\n\r\nconst notificationsSlice = createSlice({\r\n  name: 'notifications',\r\n  initialState: {\r\n    notifications: [],\r\n    unreadCount: 0,\r\n    loading: false\r\n  },\r\n  reducers: {},\r\n  extraReducers: (builder) => {\r\n    builder\r\n      .addCase(fetchNotifications.fulfilled, (state, action) => {\r\n        state.notifications = action.payload;\r\n        state.unreadCount = action.payload.filter(n => !n.isRead).length;\r\n      })\r\n      .addCase(markAsRead.fulfilled, (state, action) => {\r\n        const notification = state.notifications.find(n => n.id === action.payload);\r\n        if (notification) {\r\n          notification.isRead = true;\r\n          state.unreadCount = Math.max(0, state.unreadCount - 1);\r\n        }\r\n      });\r\n  }\r\n});\r\n\r\nexport default notificationsSlice.reducer;\r\n"],"names":["handleError","error","rejectWithValue","APIError","NetworkError","fetchNotifications","createAsyncThunk","_","api","markAsRead","notificationId","createSlice","builder","state","action","n","notification"],"mappings":"oEAIA,MAAMA,EAAc,CAACC,EAAOC,IACtBD,aAAiBE,EACZD,EAAgBD,EAAM,MAAQA,EAAM,OAAO,EACzCA,aAAiBG,EACnBF,EAAgB,CAAE,QAASD,EAAM,OAAO,CAAE,EAE5CC,EAAgB,CAAE,QAAS,oBAAoB,CAAE,EAG7CG,EAAqBC,EAChC,mCACA,MAAOC,EAAG,CAAE,gBAAAL,KAAsB,CAChC,GAAI,CAEF,OADiB,MAAMM,EAAI,IAAI,gBAAgB,GAC/B,IAClB,OAASP,EAAO,CACd,OAAOD,EAAYC,EAAOC,CAAe,CAC3C,CACF,CACF,EAEaO,EAAaH,EACxB,2BACA,MAAOI,EAAgB,CAAE,gBAAAR,KAAsB,CAC7C,GAAI,CACF,aAAMM,EAAI,IAAI,kBAAkBE,CAAc,OAAO,EAC9CA,CACT,OAAST,EAAO,CACd,OAAOD,EAAYC,EAAOC,CAAe,CAC3C,CACF,CACF,EAE2BS,EAAY,CACrC,KAAM,gBACN,aAAc,CACZ,cAAe,CAAA,EACf,YAAa,EACb,QAAS,EACb,EACE,SAAU,CAAA,EACV,cAAgBC,GAAY,CAC1BA,EACG,QAAQP,EAAmB,UAAW,CAACQ,EAAOC,IAAW,CACxDD,EAAM,cAAgBC,EAAO,QAC7BD,EAAM,YAAcC,EAAO,QAAQ,OAAOC,GAAK,CAACA,EAAE,MAAM,EAAE,MAC5D,CAAC,EACA,QAAQN,EAAW,UAAW,CAACI,EAAOC,IAAW,CAChD,MAAME,EAAeH,EAAM,cAAc,KAAKE,GAAKA,EAAE,KAAOD,EAAO,OAAO,EACtEE,IACFA,EAAa,OAAS,GACtBH,EAAM,YAAc,KAAK,IAAI,EAAGA,EAAM,YAAc,CAAC,EAEzD,CAAC,CACL,CACF,CAAC"}